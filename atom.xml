<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>破而后立</title>
  <subtitle>凡事破必有一立</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://jackalope.cn/"/>
  <updated>2016-10-14T10:41:44.636Z</updated>
  <id>http://jackalope.cn/</id>
  
  <author>
    <name>Zweig Chen</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>flume-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/10/14/flume-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/10/14/flume-trouble-shooting/</id>
    <published>2016-10-14T10:26:51.000Z</published>
    <updated>2016-10-14T10:41:44.636Z</updated>
    
    <content type="html">&lt;p&gt;记录使用Flume过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;java-io-IOException-Bad-response-ERROR-for-block&quot;&gt;&lt;a href=&quot;#java-io-IOException-Bad-response-ERROR-for-block&quot; class=&quot;headerlink&quot; title=&quot;java.io.IOException: Bad response ERROR for block&quot;&gt;&lt;/a&gt;java.io.IOException: Bad response ERROR for block&lt;/h1&gt;&lt;p&gt;flume处理日志时，偶尔报出如下错误:&lt;br&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;gdata &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;33&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;01&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;133&lt;/span&gt; (ResponseProcessor &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; block BP-&lt;span class=&quot;number&quot;&gt;45131683&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;16.6&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_1288600226_214984186) [WARN - org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DFSOutputStream&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$DataStr&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;eamer&lt;span class=&quot;variable&quot;&gt;$ResponseProcessor&lt;/span&gt;.run(DFSOutputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;774&lt;/span&gt;)] DFSOutputStream ResponseProcessor exception  &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; block BP-&lt;span class=&quot;number&quot;&gt;45131683&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;16.6&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_1288600226_214984186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;java&lt;span class=&quot;selector-class&quot;&gt;.io&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.IOException&lt;/span&gt;: Bad response ERROR &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; block BP-&lt;span class=&quot;number&quot;&gt;45131683&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;16.6&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_1288600226_214984186 from datanode &lt;span class=&quot;number&quot;&gt;10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.71&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DFSOutputStream&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$DataStreamer&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$ResponseProcessor&lt;/span&gt;.run(DFSOutputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;732&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gdata &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;33&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;01&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;137&lt;/span&gt; (DataStreamer &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; file /data/flume/event_session/day=&lt;span class=&quot;number&quot;&gt;20161013&lt;/span&gt;/uptime=&lt;span class=&quot;number&quot;&gt;2016101307&lt;/span&gt;/event-session.&lt;span class=&quot;number&quot;&gt;1476325736178&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.tmp&lt;/span&gt; block BP-&lt;span class=&quot;number&quot;&gt;45131683&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;16.6&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;14309&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;14429099&lt;/span&gt;:blk_1288600226_214984186) [WARN - org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DFSOutputStream&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$DataStreamer&lt;/span&gt;.setupPipelineForAppendOrRecovery(DFSOutputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1013&lt;/span&gt;)] Error Recovery &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; bl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ock BP-&lt;span class=&quot;number&quot;&gt;45131683&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;16.6&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_1288600226_214984186 &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; pipeline &lt;span class=&quot;number&quot;&gt;10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.103&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.71&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.35&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;: bad datanode &lt;span class=&quot;number&quot;&gt;10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.71&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;查看对应datanode —— 10.10.10.71上的日志：&lt;br&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;33&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;01&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;130&lt;/span&gt; INFO org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.server&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datanode&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DataNode&lt;/span&gt;: Exception &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; BP-&lt;span class=&quot;number&quot;&gt;45131683&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;16.6&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_1288600226_214984186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;java&lt;span class=&quot;selector-class&quot;&gt;.net&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SocketTimeoutException&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;60000&lt;/span&gt; millis timeout while waiting &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; channel to be ready &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; read. ch : java&lt;span class=&quot;selector-class&quot;&gt;.nio&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.channels&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SocketChannel&lt;/span&gt;[connected local=/&lt;span class=&quot;number&quot;&gt;10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.71&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt; rem&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ote=/&lt;span class=&quot;number&quot;&gt;10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;10.103&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;46888&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.net&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SocketIOWithTimeout&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.doIO&lt;/span&gt;(SocketIOWithTimeout&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;164&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.net&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SocketInputStream&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.read&lt;/span&gt;(SocketInputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;161&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.net&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SocketInputStream&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.read&lt;/span&gt;(SocketInputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;131&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.io&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BufferedInputStream&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.fill&lt;/span&gt;(BufferedInputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;235&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.io&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BufferedInputStream&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.read1&lt;/span&gt;(BufferedInputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;275&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.io&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BufferedInputStream&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.read&lt;/span&gt;(BufferedInputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;334&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.io&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DataInputStream&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.read&lt;/span&gt;(DataInputStream&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;149&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.io&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.IOUtils&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.readFully&lt;/span&gt;(IOUtils&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;192&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.protocol&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datatransfer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.PacketReceiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.doReadFully&lt;/span&gt;(PacketReceiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;213&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.protocol&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datatransfer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.PacketReceiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.doRead&lt;/span&gt;(PacketReceiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;134&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.protocol&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datatransfer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.PacketReceiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.receiveNextPacket&lt;/span&gt;(PacketReceiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;109&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.server&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datanode&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BlockReceiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.receivePacket&lt;/span&gt;(BlockReceiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;435&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.server&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datanode&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BlockReceiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.receiveBlock&lt;/span&gt;(BlockReceiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;693&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.server&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datanode&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DataXceiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.writeBlock&lt;/span&gt;(DataXceiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;569&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.protocol&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datatransfer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Receiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.opWriteBlock&lt;/span&gt;(Receiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;115&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.protocol&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datatransfer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Receiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.processOp&lt;/span&gt;(Receiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;68&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hdfs&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.server&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.datanode&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DataXceiver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(DataXceiver&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;221&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.lang&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Thread&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(Thread&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;722&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;显示&lt;code&gt;60000 millis timeout while waiting for channel to be ready for read&lt;/code&gt;，该问题是由于datanode rpc连接都被占用，导致客户端请求超时。&lt;br&gt;因此在hdfs-site.xml中加大datanode的rpc连接数：&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;dfs.datanode.handler.count&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;10&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;Callable-timed-out-after-10000-ms&quot;&gt;&lt;a href=&quot;#Callable-timed-out-after-10000-ms&quot; class=&quot;headerlink&quot; title=&quot;Callable timed out after 10000 ms&quot;&gt;&lt;/a&gt;Callable timed out after 10000 ms&lt;/h1&gt;&lt;p&gt;忘了截取日志，因此摘抄自如下网页：&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/wsscy2004/article/details/22179361&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/wsscy2004/article/details/22179361&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;解决办法：&quot;&gt;&lt;a href=&quot;#解决办法：&quot; class=&quot;headerlink&quot; title=&quot;解决办法：&quot;&gt;&lt;/a&gt;解决办法：&lt;/h2&gt;&lt;p&gt;修改flume配置文件，添加配置hdfs.callTimeout = 60000(该值默认为10000)&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用Flume过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;java-io-IOException-Bad-response-ERROR-for-block&quot;&gt;&lt;a href=&quot;#java-io-IOException-Bad-response-ERROR
    
    </summary>
    
      <category term="Flume" scheme="http://jackalope.cn/categories/Flume/"/>
    
    
      <category term="Flume" scheme="http://jackalope.cn/tags/Flume/"/>
    
  </entry>
  
  <entry>
    <title>sqoop-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/10/14/spring-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/10/14/spring-trouble-shooting/</id>
    <published>2016-10-14T09:37:51.000Z</published>
    <updated>2017-01-20T03:21:19.265Z</updated>
    
    <content type="html">&lt;p&gt;记录使用Spring过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;NoClassDefFoundError-org-apache-hadoop-conf-Configuration-DeprecationDelta&quot;&gt;&lt;a href=&quot;#NoClassDefFoundError-org-apache-hadoop-conf-Configuration-DeprecationDelta&quot; class=&quot;headerlink&quot; title=&quot;NoClassDefFoundError: org/apache/hadoop/conf/Configuration$DeprecationDelta&quot;&gt;&lt;/a&gt;NoClassDefFoundError: org/apache/hadoop/conf/Configuration$DeprecationDelta&lt;/h1&gt;&lt;p&gt;使用spring-data-hadoop-hbase时遇到如下错误：&lt;br&gt;&lt;code&gt;Exception in thread &amp;quot;main&amp;quot; java.lang.NoClassDefFoundError: org/apache/hadoop/conf/Configuration$DeprecationDelta&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;原因：spring-data-hadoop-hbase版本为2.2.0，其中使用的hadoop-hdfs版本为2.6.0，因此出现如上错误。&lt;/p&gt;
&lt;p&gt;解决办法：使用同版本的hadoop包。&lt;/p&gt;
&lt;p&gt;PS:若遇到错误：org.eclipse.jdt.internal.compiler.CompilationResult.getProblems，这是由于jsp解析包依赖冲突所致，将其从hadoop/hive/hbase等相关的包中exclude掉即可。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用Spring过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;NoClassDefFoundError-org-apache-hadoop-conf-Configuration-DeprecationDelta&quot;&gt;&lt;a href=&quot;#NoClassDefF
    
    </summary>
    
      <category term="spring" scheme="http://jackalope.cn/categories/spring/"/>
    
    
      <category term="spring spring-data hadoop" scheme="http://jackalope.cn/tags/spring-spring-data-hadoop/"/>
    
  </entry>
  
  <entry>
    <title>sqoop-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/10/14/sqoop-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/10/14/sqoop-trouble-shooting/</id>
    <published>2016-10-14T09:37:51.000Z</published>
    <updated>2017-01-20T03:09:47.720Z</updated>
    
    <content type="html">&lt;p&gt;记录使用sqoop过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;p&gt;常用命令示例：&lt;br&gt;导入HDFS：&lt;br&gt;&lt;code&gt;bin/sqoop import --connect jdbc:mysql://10.10.10.84:3306/test --table czw_test_distinct --username ---------- --password ---------- --target-dir /tmp/testSqoop --driver com.mysql.jdbc.Driver --split-by a&lt;/code&gt;&lt;br&gt;导入Hive:&lt;br&gt;&lt;code&gt;bin/sqoop import --connect jdbc:mysql://10.10.10.84:3306/test --table czw_test_distinct --username ---------- --password ---------- --hive-import --driver com.mysql.jdbc.Driver --split-by a&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;导出(hive -&amp;gt; mysql):&lt;br&gt;&lt;code&gt;bin/sqoop export --connect jdbc:mysql://10.10.10.84:3306/test --table czw_test_distinct --username ---------- --password ---------- --driver com.mysql.jdbc.Driver --export-dir /user/hive/warehouse/czw_test_distinct --input-fields-terminated-by &amp;#39;\001&amp;#39;&lt;/code&gt;&lt;br&gt;或(hdfs -&amp;gt; mysql)：&lt;br&gt;&lt;code&gt;bin/sqoop export --connect jdbc:mysql://10.10.10.84:3306/test --table czw_test_distinct --username ---------- --password ---------- --driver com.mysql.jdbc.Driver --export-dir /tmp/testSqoop --input-fields-terminated-by &amp;#39;,&amp;#39;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;导入rcfile表&lt;br&gt;&lt;code&gt;bin/sqoop import --connect jdbc:mysql://10.10.10.84:3306/test --table test_sqoop_rcfile_to_mysql --username ---------- --password ---------- --driver com.mysql.jdbc.Driver --hcatalog-table test_sqoop_rcfile_to_mysql --split-by app_id&lt;/code&gt;&lt;br&gt;导出rcfile表&lt;br&gt;&lt;code&gt;bin/sqoop export --connect jdbc:mysql://10.10.10.84:3306/test --table test_sqoop_rcfile_to_mysql --username ---------- --password ---------- --driver com.mysql.jdbc.Driver --hcatalog-table test_sqoop_rcfile_to_mysql&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;No-columns-to-generate-for-ClassWriter&quot;&gt;&lt;a href=&quot;#No-columns-to-generate-for-ClassWriter&quot; class=&quot;headerlink&quot; title=&quot;No columns to generate for ClassWriter&quot;&gt;&lt;/a&gt;No columns to generate for ClassWriter&lt;/h1&gt;&lt;p&gt;执行如下命令导入mysql数据到hadoop：&lt;br&gt;&lt;code&gt;bin/sqoop import --connect jdbc:mysql://10.10.10.84:3306/test --table czw_test_distinct --username ---------- --password ---------- --target-dir /tmp/testSqoop&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;出现如下错误&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;28&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;27&lt;/span&gt; ERROR manager&lt;span class=&quot;selector-class&quot;&gt;.SqlManager&lt;/span&gt;: Error reading from database: java&lt;span class=&quot;selector-class&quot;&gt;.sql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SQLException&lt;/span&gt;: Streaming result set com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RowDataDynamic&lt;/span&gt;@&lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;aa8801 is still active. No statements may be issued when any streaming result sets are open and &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; use on &lt;span class=&quot;selector-tag&quot;&gt;a&lt;/span&gt; given connection. Ensure that you have called .close() on any active streaming result sets before attempting more queries.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;java&lt;span class=&quot;selector-class&quot;&gt;.sql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SQLException&lt;/span&gt;: Streaming result set com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RowDataDynamic&lt;/span&gt;@&lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;aa8801 is still active. No statements may be issued when any streaming result sets are open and &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; use on &lt;span class=&quot;selector-tag&quot;&gt;a&lt;/span&gt; given connection. Ensure that you have called .close() on any active streaming result sets before attempting more queries.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SQLError&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.createSQLException&lt;/span&gt;(SQLError&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;930&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.MysqlIO&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.checkForOutstandingStreamingData&lt;/span&gt;(MysqlIO&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2646&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.MysqlIO&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sendCommand&lt;/span&gt;(MysqlIO&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1861&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.MysqlIO&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqlQueryDirect&lt;/span&gt;(MysqlIO&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2101&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ConnectionImpl&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.execSQL&lt;/span&gt;(ConnectionImpl&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2548&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ConnectionImpl&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.execSQL&lt;/span&gt;(ConnectionImpl&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2477&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.StatementImpl&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.executeQuery&lt;/span&gt;(StatementImpl&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1422&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ConnectionImpl&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getMaxBytesPerChar&lt;/span&gt;(ConnectionImpl&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2945&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Field&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getMaxBytesPerCharacter&lt;/span&gt;(Field&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;582&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at com&lt;span class=&quot;selector-class&quot;&gt;.mysql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.jdbc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ResultSetMetaData&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getPrecision&lt;/span&gt;(ResultSetMetaData&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;441&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.manager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SqlManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getColumnInfoForRawQuery&lt;/span&gt;(SqlManager&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;286&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.manager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SqlManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getColumnTypesForRawQuery&lt;/span&gt;(SqlManager&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;241&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.manager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SqlManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getColumnTypes&lt;/span&gt;(SqlManager&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;227&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.manager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ConnManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getColumnTypes&lt;/span&gt;(ConnManager&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;295&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.orm&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ClassWriter&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getColumnTypes&lt;/span&gt;(ClassWriter&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1833&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.orm&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ClassWriter&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.generate&lt;/span&gt;(ClassWriter&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1645&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.tool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.CodeGenTool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.generateORM&lt;/span&gt;(CodeGenTool&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;107&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.tool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ImportTool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.importTable&lt;/span&gt;(ImportTool&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;478&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.tool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ImportTool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(ImportTool&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;605&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;143&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.util&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ToolRunner&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(ToolRunner&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;70&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runSqoop&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;179&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runTool&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;218&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runTool&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;227&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.main&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;236&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;28&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;27&lt;/span&gt; ERROR tool&lt;span class=&quot;selector-class&quot;&gt;.ImportTool&lt;/span&gt;: Encountered IOException running import job: java&lt;span class=&quot;selector-class&quot;&gt;.io&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.IOException&lt;/span&gt;: No &lt;span class=&quot;attribute&quot;&gt;columns&lt;/span&gt; to generate for ClassWriter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.orm&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ClassWriter&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.generate&lt;/span&gt;(ClassWriter&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1651&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.tool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.CodeGenTool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.generateORM&lt;/span&gt;(CodeGenTool&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;107&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.tool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ImportTool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.importTable&lt;/span&gt;(ImportTool&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;478&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.tool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ImportTool&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(ImportTool&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;605&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;143&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.util&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ToolRunner&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(ToolRunner&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;70&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runSqoop&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;179&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runTool&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;218&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runTool&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;227&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Sqoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.main&lt;/span&gt;(Sqoop&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;236&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;解决办法：增加参数&lt;code&gt;--driver com.mysql.jdbc.Driver&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PS: 另需注意mysql java驱动包的版本为5.1.31以上。&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;No-primary-key-could-be-found&quot;&gt;&lt;a href=&quot;#No-primary-key-could-be-found&quot; class=&quot;headerlink&quot; title=&quot;No primary key could be found&quot;&gt;&lt;/a&gt;No primary key could be found&lt;/h1&gt;&lt;p&gt;遇到错误如下：&lt;/p&gt;
&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;16/11/28 14:39:03 &lt;span class=&quot;keyword&quot;&gt;ERROR&lt;/span&gt; tool.ImportTool: &lt;span class=&quot;keyword&quot;&gt;Error&lt;/span&gt; during import: &lt;span class=&quot;keyword&quot;&gt;No&lt;/span&gt; primary key could be found &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt; czw_test_distinct. Please specify &lt;span class=&quot;keyword&quot;&gt;one&lt;/span&gt; with --&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;-&lt;span class=&quot;keyword&quot;&gt;by&lt;/span&gt; or perform a sequential import with &#39;-&lt;span class=&quot;keyword&quot;&gt;m&lt;/span&gt; 1&#39;.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;原因：mysql数据库的表中需要有个主键，如果没有主键的话需要手动选取一个合适的拆分字段，如下:&lt;br&gt;&lt;code&gt;bin/sqoop import --connect jdbc:mysql://10.10.10.84:3306/test --table czw_test_distinct --username ---------- --password ---------- --target-dir /tmp/testSqoop --driver com.mysql.jdbc.Driver --split-by a&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意：主键空的数据无法导入&lt;/code&gt;，如：&lt;br&gt;原表：&lt;br&gt;a    b    c&lt;br&gt;a1&lt;br&gt;\N    b1    \N&lt;br&gt;\N    \N    c1&lt;br&gt;a1    b1    c1&lt;br&gt;导入后：&lt;br&gt;a1,,&lt;br&gt;a1,b1,c1&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用sqoop过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;p&gt;常用命令示例：&lt;br&gt;导入HDFS：&lt;br&gt;&lt;code&gt;bin/sqoop import --connect jdbc:mysql://10.10.10.84:3306/test --table czw_t
    
    </summary>
    
      <category term="sqoop" scheme="http://jackalope.cn/categories/sqoop/"/>
    
    
      <category term="sqoop" scheme="http://jackalope.cn/tags/sqoop/"/>
    
  </entry>
  
  <entry>
    <title>spark-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/10/14/spark-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/10/14/spark-trouble-shooting/</id>
    <published>2016-10-14T09:37:51.000Z</published>
    <updated>2017-01-20T03:35:24.473Z</updated>
    
    <content type="html">&lt;p&gt;记录使用Spark过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;java-lang-IllegalArgumentException-Size-exceeds-Integer-MAX-VALUE&quot;&gt;&lt;a href=&quot;#java-lang-IllegalArgumentException-Size-exceeds-Integer-MAX-VALUE&quot; class=&quot;headerlink&quot; title=&quot;java.lang.IllegalArgumentException: Size exceeds Integer.MAX_VALUE&quot;&gt;&lt;/a&gt;java.lang.IllegalArgumentException: Size exceeds Integer.MAX_VALUE&lt;/h1&gt;&lt;p&gt;执行Spark任务时，抛出如下异常：&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;45&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt; INFO client.AppClient&lt;span class=&quot;variable&quot;&gt;$ClientEndpoint&lt;/span&gt;: Executor updated: app-&lt;span class=&quot;number&quot;&gt;20161216&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;39&lt;/span&gt; INFO storage&lt;span class=&quot;selector-class&quot;&gt;.BlockManagerInfo&lt;/span&gt;: Added rdd_14_0 on disk on bis-newdatanode-s2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;b-&lt;span class=&quot;number&quot;&gt;75&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;54113&lt;/span&gt; (size: &lt;span class=&quot;number&quot;&gt;7.5&lt;/span&gt; GB)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;39&lt;/span&gt; WARN scheduler&lt;span class=&quot;selector-class&quot;&gt;.TaskSetManager&lt;/span&gt;: Lost task &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; stage &lt;span class=&quot;number&quot;&gt;3.0&lt;/span&gt; (TID &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;, bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;75&lt;/span&gt;): java&lt;span class=&quot;selector-class&quot;&gt;.lang&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.IllegalArgumentException&lt;/span&gt;: Size exceeds Integer&lt;span class=&quot;selector-class&quot;&gt;.MAX_VALUE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at sun&lt;span class=&quot;selector-class&quot;&gt;.nio&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ch&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.FileChannelImpl&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.map&lt;/span&gt;(FileChannelImpl&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;789&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.storage&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DiskStore&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$getBytes&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;.apply(DiskStore&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;127&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.storage&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DiskStore&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$getBytes&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;.apply(DiskStore&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;115&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.util&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Utils&lt;/span&gt;$.tryWithSafeFinally(Utils&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1250&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.storage&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DiskStore&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getBytes&lt;/span&gt;(DiskStore&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;129&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.storage&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.DiskStore&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getBytes&lt;/span&gt;(DiskStore&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;136&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.storage&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BlockManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.doGetLocal&lt;/span&gt;(BlockManager&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;503&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.storage&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BlockManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getLocal&lt;/span&gt;(BlockManager&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;420&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.storage&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.BlockManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.get&lt;/span&gt;(BlockManager&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;625&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.CacheManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.putInBlockManager&lt;/span&gt;(CacheManager&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;154&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.CacheManager&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getOrCompute&lt;/span&gt;(CacheManager&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;78&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.rdd&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RDD&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.iterator&lt;/span&gt;(RDD&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;268&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.rdd&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.MapPartitionsRDD&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.compute&lt;/span&gt;(MapPartitionsRDD&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;38&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.rdd&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RDD&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.computeOrReadCheckpoint&lt;/span&gt;(RDD&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;306&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.rdd&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RDD&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.iterator&lt;/span&gt;(RDD&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;270&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;原因：由于spark存在限制“2GB limit in spark for blocks”，详见：&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-1476，因此考虑rdd重新分区如下：`itemRdd.repartition(100)`，问题解决。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://issues.apache.org/jira/browse/SPARK-1476，因此考虑rdd重新分区如下：`itemRdd.repartition(100)`，问题解决。&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;java-lang-IllegalArgumentException-requirement-failed&quot;&gt;&lt;a href=&quot;#java-lang-IllegalArgumentException-requirement-failed&quot; class=&quot;headerlink&quot; title=&quot;java.lang.IllegalArgumentException: requirement failed&quot;&gt;&lt;/a&gt;java.lang.IllegalArgumentException: requirement failed&lt;/h1&gt;&lt;p&gt;使用KMeans算法进行评估时，出现如下错误：&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;40&lt;/span&gt; WARN scheduler&lt;span class=&quot;selector-class&quot;&gt;.TaskSetManager&lt;/span&gt;: Lost task &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; stage &lt;span class=&quot;number&quot;&gt;50.0&lt;/span&gt; (TID &lt;span class=&quot;number&quot;&gt;2418&lt;/span&gt;, bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;59&lt;/span&gt;): java&lt;span class=&quot;selector-class&quot;&gt;.lang&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.IllegalArgumentException&lt;/span&gt;: requirement failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala.Predef$.require(Predef&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;221&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.util&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.MLUtils&lt;/span&gt;$.fastSquaredDistance(MLUtils&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;330&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.clustering&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.KMeans&lt;/span&gt;$.fastSquaredDistance(KMeans&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;595&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.clustering&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.KMeans&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$findClosest&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.apply(KMeans&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;569&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.clustering&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.KMeans&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$findClosest&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.apply(KMeans&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;563&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mutable&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ArraySeq&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.foreach&lt;/span&gt;(ArraySeq&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;73&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.clustering&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.KMeans&lt;/span&gt;$.findClosest(KMeans&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;563&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.clustering&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.KMeans&lt;/span&gt;$.pointCost(KMeans&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;586&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.clustering&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.KMeansModel&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$computeCost&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.apply(KMeansModel&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;88&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mllib&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.clustering&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.KMeansModel&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$computeCost&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.apply(KMeansModel&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;88&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Iterator&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anon&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;.next(Iterator&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;328&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Iterator&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$class&lt;/span&gt;.foreach(Iterator&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;727&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.AbstractIterator&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.foreach&lt;/span&gt;(Iterator&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1157&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.TraversableOnce&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$class&lt;/span&gt;.foldLeft(TraversableOnce&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;144&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.AbstractIterator&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.foldLeft&lt;/span&gt;(Iterator&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1157&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.TraversableOnce&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$class&lt;/span&gt;.fold(TraversableOnce&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;199&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at scala&lt;span class=&quot;selector-class&quot;&gt;.collection&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.AbstractIterator&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.fold&lt;/span&gt;(Iterator&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1157&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.rdd&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RDD&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$fold&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;.apply(RDD&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1086&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.rdd&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RDD&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$fold&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;.apply(RDD&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1086&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SparkContext&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;.apply(SparkContext&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1951&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SparkContext&lt;/span&gt;$&lt;span class=&quot;variable&quot;&gt;$anonfun&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;.apply(SparkContext&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1951&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.scheduler&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ResultTask&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runTask&lt;/span&gt;(ResultTask&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;66&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.scheduler&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Task&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(Task&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;89&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.executor&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Executor&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$TaskRunner&lt;/span&gt;.run(Executor&lt;span class=&quot;selector-class&quot;&gt;.scala&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;214&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.util&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.concurrent&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ThreadPoolExecutor&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.runWorker&lt;/span&gt;(ThreadPoolExecutor&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1110&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.util&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.concurrent&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ThreadPoolExecutor&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$Worker&lt;/span&gt;.run(ThreadPoolExecutor&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;603&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at java&lt;span class=&quot;selector-class&quot;&gt;.lang&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.Thread&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.run&lt;/span&gt;(Thread&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;722&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;原因：检查代码发现是进行评估的数据特征数与训练模型不一致，从而产生这种错误，但&lt;code&gt;不可排除其他原因也产生该错误&lt;/code&gt;，该错误提示为参数非法，因此需&lt;code&gt;检查自己的代码&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id=&quot;RDD分区不能均匀地分发到各个executor上&quot;&gt;&lt;a href=&quot;#RDD分区不能均匀地分发到各个executor上&quot; class=&quot;headerlink&quot; title=&quot;RDD分区不能均匀地分发到各个executor上&quot;&gt;&lt;/a&gt;RDD分区不能均匀地分发到各个executor上&lt;/h1&gt;&lt;p&gt;RDD分区不能均匀地分发到各个executor上，未截取运行日志和截图，在网上找到个类似的问题：&lt;a href=&quot;http://apache-spark-developers-list.1001551.n3.nabble.com/RDD-Partitions-not-distributed-evenly-to-executors-td16988.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RDD Partitions not distributed evenly to executors&lt;/a&gt;&lt;br&gt;未找到正式的解决办法，通过加大分区数量暂时规避了此问题。&lt;/p&gt;
&lt;h1 id=&quot;spark-ContextCleaner-Error-cleaning-broadcast&quot;&gt;&lt;a href=&quot;#spark-ContextCleaner-Error-cleaning-broadcast&quot; class=&quot;headerlink&quot; title=&quot;spark.ContextCleaner: Error cleaning broadcast&quot;&gt;&lt;/a&gt;spark.ContextCleaner: Error cleaning broadcast&lt;/h1&gt;&lt;p&gt;不明原因，未找到正式的解决办法，通过加大分区数量暂时规避了此问题。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用Spark过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;java-lang-IllegalArgumentException-Size-exceeds-Integer-MAX-VALUE&quot;&gt;&lt;a href=&quot;#java-lang-IllegalArgu
    
    </summary>
    
      <category term="spark" scheme="http://jackalope.cn/categories/spark/"/>
    
    
      <category term="spark" scheme="http://jackalope.cn/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>shell-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/10/14/shell-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/10/14/shell-trouble-shooting/</id>
    <published>2016-10-14T09:37:51.000Z</published>
    <updated>2016-10-14T10:27:50.899Z</updated>
    
    <content type="html">&lt;p&gt;记录写shell时遇到的问题、原因及解决办法&lt;/p&gt;
&lt;h1 id=&quot;ssh引起的while循环只执行一次&quot;&gt;&lt;a href=&quot;#ssh引起的while循环只执行一次&quot; class=&quot;headerlink&quot; title=&quot;ssh引起的while循环只执行一次&quot;&gt;&lt;/a&gt;ssh引起的while循环只执行一次&lt;/h1&gt;&lt;p&gt;有脚本如下：&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;read&lt;/span&gt; time&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$time&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ssh 10.10.10.111 &lt;span class=&quot;string&quot;&gt;&quot;hostname&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;done&lt;/span&gt; &amp;lt; test.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;test.txt中的内容是：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;我期望的结果是到10.10.10.111上执行5次hostname命令，但是，运行该脚本仅可执行一次，如下：&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bis-newdatanode&lt;span class=&quot;_&quot;&gt;-s&lt;/span&gt;2b-80&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;原因&quot;&gt;&lt;a href=&quot;#原因&quot; class=&quot;headerlink&quot; title=&quot;原因&quot;&gt;&lt;/a&gt;原因&lt;/h2&gt;&lt;p&gt;ssh会读取所有标准输入，如下脚本可以查看ssh中的输入：&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;read&lt;/span&gt; time&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ssh 10.10.10.111 &lt;span class=&quot;string&quot;&gt;&quot;cat&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;done&lt;/span&gt; &amp;lt; test.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;结果如下：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;1已被while读取，所以cat出来还有2、3、4、5，而后while再次读取的时候标准输入已经没有内容，因此while循环只执行了一次便退出。&lt;/p&gt;
&lt;h2 id=&quot;解决方法&quot;&gt;&lt;a href=&quot;#解决方法&quot; class=&quot;headerlink&quot; title=&quot;解决方法&quot;&gt;&lt;/a&gt;解决方法&lt;/h2&gt;&lt;p&gt;查看man ssh，可以得到如下信息：&lt;br&gt;&lt;figure class=&quot;highlight livecodeserver&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-n      Redirects &lt;span class=&quot;keyword&quot;&gt;stdin&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;from&lt;/span&gt; /dev/&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt; (actually, prevents reading &lt;span class=&quot;built_in&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;stdin&lt;/span&gt;).  This must be used when ssh is run &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; background.  A common&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        trick is &lt;span class=&quot;built_in&quot;&gt;to&lt;/span&gt; use this &lt;span class=&quot;built_in&quot;&gt;to&lt;/span&gt; run X11 programs &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;remote&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;machine&lt;/span&gt;.  &lt;span class=&quot;title&quot;&gt;For&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;example&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;ssh&lt;/span&gt; -&lt;span class=&quot;title&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;shadows&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;cs&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;hut&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;fi&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;emacs&lt;/span&gt; &amp;amp; &lt;span class=&quot;title&quot;&gt;will&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;an&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;emacs&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;shad&lt;/span&gt;-&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ows.cs.hut.fi, &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; X11 connection will be automatically forwarded over &lt;span class=&quot;keyword&quot;&gt;an&lt;/span&gt; encrypted channel.  The ssh program will be &lt;span class=&quot;built_in&quot;&gt;put&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        background.  (This does &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; work &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ssh needs &lt;span class=&quot;built_in&quot;&gt;to&lt;/span&gt; ask &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;a&lt;/span&gt; password &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; passphrase; see also &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; -f option.)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;重定向标准输入为/dev/null，可以防止ssh从标准输入中读取数据。&lt;br&gt;因此在ssh后加上-n参数就可以了，如下：&lt;br&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;ssh&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;-n&lt;/span&gt; 10&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.111&lt;/span&gt; &quot;&lt;span class=&quot;selector-tag&quot;&gt;hostname&lt;/span&gt;&quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录写shell时遇到的问题、原因及解决办法&lt;/p&gt;
&lt;h1 id=&quot;ssh引起的while循环只执行一次&quot;&gt;&lt;a href=&quot;#ssh引起的while循环只执行一次&quot; class=&quot;headerlink&quot; title=&quot;ssh引起的while循环只执行一次&quot;&gt;&lt;/a&gt;ss
    
    </summary>
    
      <category term="shell" scheme="http://jackalope.cn/categories/shell/"/>
    
    
      <category term="shell" scheme="http://jackalope.cn/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>hive-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/09/27/hive-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/09/27/hive-trouble-shooting/</id>
    <published>2016-09-27T06:44:02.000Z</published>
    <updated>2016-10-14T10:28:30.099Z</updated>
    
    <content type="html">&lt;p&gt;记录使用Hive过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;HiveServer提交任务时报出GC-overhead-limit-exceeded&quot;&gt;&lt;a href=&quot;#HiveServer提交任务时报出GC-overhead-limit-exceeded&quot; class=&quot;headerlink&quot; title=&quot;HiveServer提交任务时报出GC overhead limit exceeded&quot;&gt;&lt;/a&gt;HiveServer提交任务时报出GC overhead limit exceeded&lt;/h1&gt;&lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h2&gt;&lt;p&gt;由kettle连接HiveServer，查看hive.log可以看到已经接收到任务，但随即立即报出错误如下：&lt;br&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;08&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;09&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;04&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;671&lt;/span&gt; ERROR [pool-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;-thread-&lt;span class=&quot;number&quot;&gt;106&lt;/span&gt;]: ql&lt;span class=&quot;selector-class&quot;&gt;.Driver&lt;/span&gt; (SessionState&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:printError(&lt;span class=&quot;number&quot;&gt;545&lt;/span&gt;)) - FAILED: Execution Error, return &lt;span class=&quot;selector-tag&quot;&gt;code&lt;/span&gt; -&lt;span class=&quot;number&quot;&gt;101&lt;/span&gt; from org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hive&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.exec&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.mr&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.MapRedTask&lt;/span&gt;. GC overhead limit exceeded&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;且没有打印出堆栈信息。&lt;/p&gt;
&lt;p&gt;##　原因&lt;br&gt;由GC overhead limit exceeded可知，是由于花费了大量的时间进行垃圾回收所致，原文如下：&lt;br&gt;&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; too much &lt;span class=&quot;built_in&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; being spent &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; garbage collection: &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; more than &lt;span class=&quot;number&quot;&gt;98&lt;/span&gt;% &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; total &lt;span class=&quot;built_in&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; spent &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; garbage collection &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;less than&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;% &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; heap &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; recovered, an OutOfMemoryError will be thrown&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;简单来说，就是内存不够，导致了大量GC，而JVM中实际上需要使用很多内存，从来垃圾回收之后并不能释放很多空间，如此反复。&lt;/p&gt;
&lt;p&gt;查看hive中的源码，ql.Driver类中的execute方法启动任务，如下：&lt;br&gt;&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;TaskRunner runner = launchTask(task, queryId, noName, &lt;span class=&quot;keyword&quot;&gt;jobname, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;jobs, &lt;/span&gt;driverCxt)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;launchTask方法中新建了一个TaskRunner对象，并运行，如下：&lt;br&gt;&lt;figure class=&quot;highlight dns&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;TaskRunner tskRun = new TaskRunner(tsk, tskRes)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tskRun.runSequential()&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;TaskRunner的runSequential方法启动任务，并设置返回值。&lt;br&gt;&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Launches a task, and sets its exit value in the result variable.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;runSequential&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; exitVal = &lt;span class=&quot;number&quot;&gt;-101&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    exitVal = tsk.executeTask();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tsk.getException() == &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      tsk.setException(t);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    t.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  result.setExitVal(exitVal, tsk.getException());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;由此可见，在hiveServer启动任务时，便已报错，任务尚未发送到Hadoop，因此考虑调整HiveServer的内存大小。&lt;/p&gt;
&lt;h2 id=&quot;解决办法&quot;&gt;&lt;a href=&quot;#解决办法&quot; class=&quot;headerlink&quot; title=&quot;解决办法&quot;&gt;&lt;/a&gt;解决办法&lt;/h2&gt;&lt;p&gt;在&lt;code&gt;hive-env.sh&lt;/code&gt;中设置&lt;code&gt;export HADOOP_HEAPSIZE=1024&lt;/code&gt;&lt;br&gt;或在&lt;code&gt;hadoop-env.sh&lt;/code&gt;中设置&lt;code&gt;export HADOOP_CLIENT_OPTS=&amp;quot;-Xmx1024m $HADOOP_CLIENT_OPTS&amp;quot;&lt;/code&gt;&lt;br&gt;&lt;code&gt;注意，该设置会影响其他hadoop客户端命令&lt;/code&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用Hive过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;HiveServer提交任务时报出GC-overhead-limit-exceeded&quot;&gt;&lt;a href=&quot;#HiveServer提交任务时报出GC-overhead-limit-exceeded&quot;
    
    </summary>
    
      <category term="hive" scheme="http://jackalope.cn/categories/hive/"/>
    
    
      <category term="hive" scheme="http://jackalope.cn/tags/hive/"/>
    
  </entry>
  
  <entry>
    <title>hbase-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/09/27/hbase-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/09/27/hbase-trouble-shooting/</id>
    <published>2016-09-27T06:42:53.000Z</published>
    <updated>2016-10-24T06:32:56.666Z</updated>
    
    <content type="html">&lt;p&gt;记录使用HBase过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;HBase元数据修复&quot;&gt;&lt;a href=&quot;#HBase元数据修复&quot; class=&quot;headerlink&quot; title=&quot;HBase元数据修复&quot;&gt;&lt;/a&gt;HBase元数据修复&lt;/h1&gt;&lt;p&gt;HBase中出现好几张表都读取报错的情况，表现为提示如下错误：&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Mon Sep &lt;span class=&quot;number&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;34&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;49&lt;/span&gt; CST &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;, org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.client&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RpcRetryingCaller&lt;/span&gt;@&lt;span class=&quot;number&quot;&gt;7293&lt;/span&gt;da04, org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.NotServingRegionException&lt;/span&gt;: org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.NotServingRegionException&lt;/span&gt;: Region BASE_USER_ACC,&lt;span class=&quot;number&quot;&gt;20160705688835318555647&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1470888379980&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.fd89999e1f6fb506fa69fee69837d47b&lt;/span&gt;. is not online&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.regionserver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.HRegionServer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getRegionByEncodedName&lt;/span&gt;(HRegionServer&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2612&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.regionserver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.HRegionServer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.getRegion&lt;/span&gt;(HRegionServer&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4003&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.regionserver&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.HRegionServer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.scan&lt;/span&gt;(HRegionServer&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3002&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.protobuf&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.generated&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ClientProtos&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$ClientService&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;.callBlockingMethod(ClientProtos&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;26929&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ipc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RpcServer&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.call&lt;/span&gt;(RpcServer&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2185&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hbase&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.ipc&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.RpcServer&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$Handler&lt;/span&gt;.run(RpcServer&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1889&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;重启HBase后，问题依旧。&lt;br&gt;使用命令：&lt;code&gt;hbase hbck BASE_USER_INFO_MERGE&lt;/code&gt;，对该表进行一致性检查，结果如下：&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Summary:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  hbase:meta &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; okay.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; regions: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Deployed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;:  bis-hadoop-datanode-s2d&lt;span class=&quot;number&quot;&gt;-136&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474869133049&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Table BASE_USER_INFO_MERGE &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; inconsistent.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; regions: &lt;span class=&quot;number&quot;&gt;76&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Deployed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;:  bis-hadoop-datanode-s&lt;span class=&quot;number&quot;&gt;-01&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474869134748&lt;/span&gt; bis-hadoop-datanode-s&lt;span class=&quot;number&quot;&gt;-02&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474869134770&lt;/span&gt; ...... bis-newdatawork-s2c&lt;span class=&quot;number&quot;&gt;-126&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474869134031&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt; inconsistencies detected.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Status: INCONSISTENT&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;存在不一致的情况，进一步查看一致性检查的输出日志，发现提示有一些错误如下：&lt;/p&gt;
&lt;figure class=&quot;highlight puppet&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ERROR: &lt;span class=&quot;keyword&quot;&gt;Region&lt;/span&gt; &amp;#123; &lt;span class=&quot;attr&quot;&gt;meta&lt;/span&gt; =&amp;gt; BASE_USER_INFO_MERGE,&lt;span class=&quot;number&quot;&gt;86188803131181&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1472665253414.0&lt;/span&gt;c9057eab1d7da58f2d44bfab641dada., &lt;span class=&quot;attr&quot;&gt;hdfs&lt;/span&gt; =&amp;gt; hdfs://webcluster/hbase/data/&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;/BASE_USER_INF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;O_MERGE/0c9057eab1d7da58f2d44bfab641dada, &lt;span class=&quot;attr&quot;&gt;deployed&lt;/span&gt; =&amp;gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;deployed&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;any&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: &lt;span class=&quot;keyword&quot;&gt;Region&lt;/span&gt; &amp;#123; &lt;span class=&quot;attr&quot;&gt;meta&lt;/span&gt; =&amp;gt; BASE_USER_INFO_MERGE,&lt;span class=&quot;number&quot;&gt;860920020927537&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1472665222872.1&lt;/span&gt;acfd28e4be4fb26da89c3db11d83436., &lt;span class=&quot;attr&quot;&gt;hdfs&lt;/span&gt; =&amp;gt; hdfs://webcluster/hbase/data/&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;/BASE_USER_IN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FO_MERGE/&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;acfd28e4be4fb26da89c3db11d83436, &lt;span class=&quot;attr&quot;&gt;deployed&lt;/span&gt; =&amp;gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;deployed&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;any&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: &lt;span class=&quot;keyword&quot;&gt;Region&lt;/span&gt; &amp;#123; &lt;span class=&quot;attr&quot;&gt;meta&lt;/span&gt; =&amp;gt; BASE_USER_INFO_MERGE,&lt;span class=&quot;number&quot;&gt;94&lt;/span&gt;de2654afe507bd,&lt;span class=&quot;number&quot;&gt;1473448496650.2807&lt;/span&gt;f8fa14d34f7d997b571c00000366., &lt;span class=&quot;attr&quot;&gt;hdfs&lt;/span&gt; =&amp;gt; hdfs://webcluster/hbase/data/&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;/BASE_USER_I&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NFO_MERGE/&lt;span class=&quot;number&quot;&gt;2807&lt;/span&gt;f8fa14d34f7d997b571c00000366, &lt;span class=&quot;attr&quot;&gt;deployed&lt;/span&gt; =&amp;gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;deployed&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;any&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: &lt;span class=&quot;keyword&quot;&gt;Region&lt;/span&gt; &amp;#123; &lt;span class=&quot;attr&quot;&gt;meta&lt;/span&gt; =&amp;gt; BASE_USER_INFO_MERGE,&lt;span class=&quot;number&quot;&gt;862029023490010&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1472665253414.39&lt;/span&gt;df136d1fb6eda60bbd06d0150f4f01., &lt;span class=&quot;attr&quot;&gt;hdfs&lt;/span&gt; =&amp;gt; hdfs://webcluster/hbase/data/&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;/BASE_USER_IN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FO_MERGE/&lt;span class=&quot;number&quot;&gt;39&lt;/span&gt;df136d1fb6eda60bbd06d0150f4f01, &lt;span class=&quot;attr&quot;&gt;deployed&lt;/span&gt; =&amp;gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;deployed&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;any&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: &lt;span class=&quot;keyword&quot;&gt;Region&lt;/span&gt; &amp;#123; &lt;span class=&quot;attr&quot;&gt;meta&lt;/span&gt; =&amp;gt; BASE_USER_INFO_MERGE,fa7df192ea2395ad,&lt;span class=&quot;number&quot;&gt;1472871226021.59&lt;/span&gt;bc8c67cc00216964a36188d10223e&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;., &lt;span class=&quot;attr&quot;&gt;hdfs&lt;/span&gt; =&amp;gt; hdfs://webcluster/hbase/data/&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;/BASE_USER_I&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NFO_MERGE/&lt;span class=&quot;number&quot;&gt;59&lt;/span&gt;bc8c67cc00216964a36188d10223e&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;attr&quot;&gt;deployed&lt;/span&gt; =&amp;gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;deployed&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;any&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2016-09-27 14:31:43,978 DEBUG [main] util.HBaseFsck: There are 82 region info entries&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2016-09-27 14:31:44,685 INFO  [main] util.HBaseFsck: Handling overlap merges in parallel. set hbasefsck.overlap.merge.parallel to false to run serially.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: There is a hole in the region chain between 860920020927537 and 861060011050756.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: There is a hole in the region chain between 86188803131181 and 862222012466956.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: There is a hole in the region chain between 94de2654afe507bd and 9f2bdf5.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR: Last region should end with an empty key. You need to create a new region and regioninfo in HDFS to plug the hole.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;错误提示为：该表存在一些region未分配到任何regionserver上，且该表存在空洞，即region不连续的情况。&lt;br&gt;于是，进一步执行命令修复空洞：&lt;code&gt;hbase hbck -repairHoles BASE_USER_INFO_MERGE&lt;/code&gt;，可以看到类似如下输出：&lt;/p&gt;
&lt;figure class=&quot;highlight puppet&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ERROR: &lt;span class=&quot;keyword&quot;&gt;Region&lt;/span&gt; &amp;#123; &lt;span class=&quot;attr&quot;&gt;meta&lt;/span&gt; =&amp;gt; BASE_USER_INFO_MERGE,&lt;span class=&quot;number&quot;&gt;862029023490010&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1472665253414.39&lt;/span&gt;df136d1fb6eda60bbd06d0150f4f01., &lt;span class=&quot;attr&quot;&gt;hdfs&lt;/span&gt; =&amp;gt; hdfs://webcluster/hbase/data/&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;/BASE_USER_IN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FO_MERGE/&lt;span class=&quot;number&quot;&gt;39&lt;/span&gt;df136d1fb6eda60bbd06d0150f4f01, &lt;span class=&quot;attr&quot;&gt;deployed&lt;/span&gt; =&amp;gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;deployed&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;any&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Trying to fix unassigned region...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然而，最后的修复结果：&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Summary:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  hbase:meta &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; okay.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; regions: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Deployed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;:  bis-hadoop-datanode-s2d&lt;span class=&quot;number&quot;&gt;-136&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474869133049&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Table BASE_USER_INFO_MERGE &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; inconsistent.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; regions: &lt;span class=&quot;number&quot;&gt;76&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Deployed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;:  ......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt; inconsistencies detected.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;问题依旧，尝试在HBase中删除一个分区的元数据记录：&lt;code&gt;deleteall &amp;#39;hbase:meta&amp;#39;, &amp;#39;BASE_USER_INFO_MERGE,86188803131181,1472665253414.0c9057eab1d7da58f2d44bfab641dada.&amp;#39;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后，再重新生成：&lt;code&gt;hbase hbck -fixMeta BASE_USER_INFO_MERGE&lt;/code&gt;，此时，元数据重新生成后，该region处于&lt;code&gt;not deployed&lt;/code&gt;状态，再执行命令将该region重新分配：&lt;code&gt;hbase hbck -fixAssignments BASE_USER_INFO_MERGE&lt;/code&gt;，然而，却无法重新分配该region，无奈，只得删除其元数据及HDFS上的相关文件，之后再重新生成元数据，并修补空洞。&lt;br&gt;如下：&lt;br&gt;&lt;figure class=&quot;highlight nginx&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;deleteall&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;hbase:meta&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;BASE_USER_INFO_MERGE,860920020927537,1472665222872.1acfd28e4be4fb26da89c3db11d83436.&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight dts&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hdfs dfs -rm -r -skipTrash &lt;span class=&quot;meta-keyword&quot;&gt;/hbase/&lt;/span&gt;data&lt;span class=&quot;meta-keyword&quot;&gt;/default/&lt;/span&gt;BASE_USER_INFO_MERGE/&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;acfd28e4be4fb26da89c3db11d83436&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight nginx&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;hbase&lt;/span&gt; hbck -repairHoles BASE_USER_INFO_MERGE&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最后再检查一致性&lt;code&gt;hbase hbck BASE_USER_INFO_MERGE&lt;/code&gt;：&lt;br&gt;&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Summary:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  hbase:meta &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; okay.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; regions: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Deployed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;:  bis-hadoop-datanode-s2d&lt;span class=&quot;number&quot;&gt;-136&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474869133049&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  BASE_USER_INFO_MERGE &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; okay.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; regions: &lt;span class=&quot;number&quot;&gt;81&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Deployed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt;:  ......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; inconsistencies detected.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Status: OK&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;hbase-regionserver异常退出&quot;&gt;&lt;a href=&quot;#hbase-regionserver异常退出&quot; class=&quot;headerlink&quot; title=&quot;hbase regionserver异常退出&quot;&gt;&lt;/a&gt;hbase regionserver异常退出&lt;/h1&gt;&lt;p&gt;部分hbase regionserver异常退出，摘取部分日志如下：&lt;br&gt;&lt;figure class=&quot;highlight dns&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-11&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;57:36,917&lt;/span&gt; WARN  [regionserver60020] util.Sleeper: We slept &lt;span class=&quot;number&quot;&gt;38237m&lt;/span&gt;s instead of &lt;span class=&quot;number&quot;&gt;3000m&lt;/span&gt;s, this is likely due to a long garbage collecting pause and it&#39;s usually bad, see http://hbase.apache.org/book.html#trouble.rs.runtime.zkexpired&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-11&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;57:36,914&lt;/span&gt; WARN  [JvmPauseMonitor] util.JvmPauseMonitor: Detected pause in JVM or host machine (eg GC): pause of approximately &lt;span class=&quot;number&quot;&gt;37257m&lt;/span&gt;s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GC pool &#39;ParNew&#39; had collection(s): count=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; time=&lt;span class=&quot;number&quot;&gt;37664m&lt;/span&gt;s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-11&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;57:36,913&lt;/span&gt; WARN  [ResponseProcessor for block BP-&lt;span class=&quot;number&quot;&gt;45131683-16&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;6.10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_12868736&lt;span class=&quot;number&quot;&gt;59_213203810&lt;/span&gt;] hdfs.DFSClient: DFSOutputStream ResponseProcessor exce&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ption  for block BP-&lt;span class=&quot;number&quot;&gt;45131683-16&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;6.10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_12868736&lt;span class=&quot;number&quot;&gt;59_213203810&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;java.io.EOFException: Premature EOF: no length prefix available&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org.apache.hadoop.hdfs.protocolPB.PBHelper.vintPrefixed(PBHelper.java:&lt;span class=&quot;number&quot;&gt;1492&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org.apache.hadoop.hdfs.protocol.datatransfer.PipelineAck.readFields(PipelineAck.java:&lt;span class=&quot;number&quot;&gt;116&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer$ResponseProcessor.run(DFSOutputStream.java:&lt;span class=&quot;number&quot;&gt;721&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-11&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;57:36,913&lt;/span&gt; WARN  [regionserver60020.periodicFlusher] util.Sleeper: We slept &lt;span class=&quot;number&quot;&gt;39267m&lt;/span&gt;s instead of &lt;span class=&quot;number&quot;&gt;10000m&lt;/span&gt;s, this is likely due to a long garbage collecting pause and it&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&#39;s usually bad, see http://hbase.apache.org/book.html#trouble.rs.runtime.zkexpired&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-11&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;57:36,925&lt;/span&gt; WARN  [DataStreamer for file /hbase/WALs/bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;72,60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474425646831&lt;/span&gt;/bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;72%2C60020&lt;/span&gt;%&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;C14&lt;span class=&quot;number&quot;&gt;74425646831&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;1476182840215&lt;/span&gt; block BP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&lt;span class=&quot;number&quot;&gt;45131683-16&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;6.10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_12868736&lt;span class=&quot;number&quot;&gt;59_213203810&lt;/span&gt;] hdfs.DFSClient: Error Recovery for block BP-&lt;span class=&quot;number&quot;&gt;45131683-16&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;6.10.141&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;1430914429099&lt;/span&gt;:blk_12868736&lt;span class=&quot;number&quot;&gt;59_213203810&lt;/span&gt; in pipeline&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;number&quot;&gt;10.10.10.103&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;10.10.10.50&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;10.10.10.147&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;: bad datanode &lt;span class=&quot;number&quot;&gt;10.10.10.103&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50010&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-11&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;57:36,934&lt;/span&gt; FATAL [regionserver60020] regionserver.HRegionServer: ABORTING region server bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;72,60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1474425646831&lt;/span&gt;: org.apache.hadoop.hbase.YouAreDe&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;adException: Server REPORT rejected&lt;span class=&quot;comment&quot;&gt;; currently processing bis-newdatanode-s2b-72,60020,1474425646831 as dead server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;同时在gc.log中可以看到：&lt;br&gt;&lt;figure class=&quot;highlight dns&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10-12T15:25&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;43.201+0800&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1774.137&lt;/span&gt;: [GC &lt;span class=&quot;number&quot;&gt;1622131&lt;/span&gt;K-&amp;gt;&lt;span class=&quot;number&quot;&gt;787661&lt;/span&gt;K(&lt;span class=&quot;number&quot;&gt;4089472&lt;/span&gt;K), &lt;span class=&quot;number&quot;&gt;16.5654980&lt;/span&gt; secs]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10-12T15:26&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;49&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;921+0800&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1840.857&lt;/span&gt;: [GC &lt;span class=&quot;number&quot;&gt;1626573&lt;/span&gt;K-&amp;gt;&lt;span class=&quot;number&quot;&gt;809761&lt;/span&gt;K(&lt;span class=&quot;number&quot;&gt;4089472&lt;/span&gt;K), &lt;span class=&quot;number&quot;&gt;0.2250050&lt;/span&gt; secs]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10-12T15:27&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;58&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;027+0800&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1908.963&lt;/span&gt;: [GC &lt;span class=&quot;number&quot;&gt;1648673&lt;/span&gt;K-&amp;gt;&lt;span class=&quot;number&quot;&gt;818686&lt;/span&gt;K(&lt;span class=&quot;number&quot;&gt;4089472&lt;/span&gt;K), &lt;span class=&quot;number&quot;&gt;35.9152720&lt;/span&gt; secs]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;从第一部分日志和gc.log，可以看出是垃圾回收耗时太长引起regionserver与zookeeper连接超时，从而被认作是一个死节点，并中断（ABORTING）该regionserver。&lt;/p&gt;
&lt;h2 id=&quot;解决办法&quot;&gt;&lt;a href=&quot;#解决办法&quot; class=&quot;headerlink&quot; title=&quot;解决办法&quot;&gt;&lt;/a&gt;解决办法&lt;/h2&gt;&lt;p&gt;首先根据日志提示，查看&lt;a href=&quot;http://hbase.apache.org/book.html#trouble.rs.runtime.zkexpired，其中的建议如下：&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://hbase.apache.org/book.html#trouble.rs.runtime.zkexpired，其中的建议如下：&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Make sure you give plenty of RAM (in hbase-env.sh), the default of 1GB won’t be able to sustain long running imports.&lt;/li&gt;
&lt;li&gt;Make sure you don’t swap, the JVM never behaves well under swapping.&lt;/li&gt;
&lt;li&gt;Make sure you are not CPU starving the RegionServer thread. For example, if you are running a MapReduce job using 6 CPU-intensive tasks on a machine with 4 cores, you are probably starving the RegionServer enough to create longer garbage collection pauses.&lt;/li&gt;
&lt;li&gt;Increase the ZooKeeper session timeout&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;简单翻译一下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;确保有足够的内存&lt;/li&gt;
&lt;li&gt;禁用swap&lt;/li&gt;
&lt;li&gt;确保有足够的CPU可供regionserver使用&lt;/li&gt;
&lt;li&gt;增大zookeeper会话超时时间&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其中关于增大zookeeper会话超时时间，官网给出了如下配置：&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;If you wish to increase the session timeout, add the following to your hbase-site.xml to increase the timeout from the default of 60 seconds to 120 seconds.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;zookeeper.session.timeout&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;1200000&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--这里应该是多写了一个0--&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;hbase.zookeeper.property.tickTime&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;6000&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然而在hbase-site.xml中配置了该参数重启集群后，并未生效，查看日志：&lt;br&gt;&lt;figure class=&quot;highlight dns&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-13&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55:22,599&lt;/span&gt; INFO  [SplitLogWorker-bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;60,60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1476345314703&lt;/span&gt;-SendThread(bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;58&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2181&lt;/span&gt;)] zookeeper.ClientCnxn: Opening socket connection&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; to server bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;58/10.10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;73&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2181&lt;/span&gt;. Will not attempt to authenticate using SASL (unknown error)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-13&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55:22,603&lt;/span&gt; INFO  [SplitLogWorker-bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;60,60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1476345314703&lt;/span&gt;-SendThread(bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;58&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2181&lt;/span&gt;)] zookeeper.ClientCnxn: Socket connection establi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;shed to bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;58/10.10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;73&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2181&lt;/span&gt;, initiating session&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016-10-13&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55:22,605&lt;/span&gt; INFO  [SplitLogWorker-bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;60,60020&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1476345314703&lt;/span&gt;-SendThread(bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;58&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2181&lt;/span&gt;)] zookeeper.ClientCnxn: Session establishment com&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;plete on server bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;58/10.10.10&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;73&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2181&lt;/span&gt;, sessionid = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;x757bc&lt;span class=&quot;number&quot;&gt;4782260012&lt;/span&gt;, negotiated timeout = &lt;span class=&quot;number&quot;&gt;40000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;显示其最大超时时间仍旧为40000ms，究其原因，是zookeeper服务端的启动时，会设置最大超时时间，其算法如下：&lt;br&gt;&lt;figure class=&quot;highlight aspectj&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getMinSessionTimeout&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; minSessionTimeout == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt; ? tickTime * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; : minSessionTimeout; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getMaxSessionTimeout&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; maxSessionTimeout == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt; ? tickTime * &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt; : maxSessionTimeout; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;默认情况，tickTime=2sec，那么minSessionTimeout 和 maxSessionTimeout 分别是4sec和40sec。&lt;/p&gt;
&lt;p&gt;在zoo.cfg中添加配置：&lt;br&gt;&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;maxSessionTimeout&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;300000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;重启，查看zookeeper输出：&lt;br&gt;&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2016-10-14 &lt;span class=&quot;attribute&quot;&gt;09&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;963&lt;/span&gt; [&lt;span class=&quot;attribute&quot;&gt;myid&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] - INFO  [&lt;span class=&quot;attribute&quot;&gt;main&lt;/span&gt;:QuorumPeer&lt;span class=&quot;variable&quot;&gt;@959&lt;/span&gt;] - tickTime set to &lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;09&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;964&lt;/span&gt; [&lt;span class=&quot;attribute&quot;&gt;myid&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] - INFO  [&lt;span class=&quot;attribute&quot;&gt;main&lt;/span&gt;:QuorumPeer&lt;span class=&quot;variable&quot;&gt;@979&lt;/span&gt;] - minSessionTimeout set to -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;09&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;964&lt;/span&gt; [&lt;span class=&quot;attribute&quot;&gt;myid&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] - INFO  [&lt;span class=&quot;attribute&quot;&gt;main&lt;/span&gt;:QuorumPeer&lt;span class=&quot;variable&quot;&gt;@990&lt;/span&gt;] - maxSessionTimeout set to &lt;span class=&quot;number&quot;&gt;300000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;至此，问题解决。&lt;/p&gt;
&lt;h2 id=&quot;野蛮的解决办法&quot;&gt;&lt;a href=&quot;#野蛮的解决办法&quot; class=&quot;headerlink&quot; title=&quot;野蛮的解决办法&quot;&gt;&lt;/a&gt;野蛮的解决办法&lt;/h2&gt;&lt;p&gt;所谓野蛮，即不去深究zk租约超期的具体原因，而是在遇到这种情况而导致regionserver中断时，直接重新启动regionserver。&lt;br&gt;具体措施为在配置文件&lt;code&gt;hbase-site.xml&lt;/code&gt;中添加配置如下：&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;hbase.regionserver.restart.on.zk.expire&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;value&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;description&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Zookeeper session expired will force regionserver exit.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Enable this will make the regionserver restart.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;description&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用HBase过程中遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;HBase元数据修复&quot;&gt;&lt;a href=&quot;#HBase元数据修复&quot; class=&quot;headerlink&quot; title=&quot;HBase元数据修复&quot;&gt;&lt;/a&gt;HBase元数据修复&lt;/h1&gt;&lt;p&gt;HBas
    
    </summary>
    
      <category term="HBase" scheme="http://jackalope.cn/categories/HBase/"/>
    
    
      <category term="HBase" scheme="http://jackalope.cn/tags/HBase/"/>
    
  </entry>
  
  <entry>
    <title>ALS矩阵分解算法</title>
    <link href="http://jackalope.cn/2016/09/23/spark-ml-als/"/>
    <id>http://jackalope.cn/2016/09/23/spark-ml-als/</id>
    <published>2016-09-23T00:50:52.000Z</published>
    <updated>2017-01-20T10:28:32.598Z</updated>
    
    <content type="html">&lt;h1 id=&quot;阿基米德项目ALS矩阵分解算法应用案例&quot;&gt;&lt;a href=&quot;#阿基米德项目ALS矩阵分解算法应用案例&quot; class=&quot;headerlink&quot; title=&quot;阿基米德项目ALS矩阵分解算法应用案例&quot;&gt;&lt;/a&gt;阿基米德项目ALS矩阵分解算法应用案例&lt;/h1&gt;&lt;p&gt;原文地址：&lt;br&gt;&lt;a href=&quot;https://github.com/ceys/jdml/wiki/ALS&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;阿基米德项目ALS矩阵分解算法应用案例&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.cnblogs.com/lengyue365/p/5689219.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;格式比较好的&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;算法描述&quot;&gt;&lt;a href=&quot;#算法描述&quot; class=&quot;headerlink&quot; title=&quot;算法描述&quot;&gt;&lt;/a&gt;算法描述&lt;/h2&gt;&lt;h3 id=&quot;原理&quot;&gt;&lt;a href=&quot;#原理&quot; class=&quot;headerlink&quot; title=&quot;原理&quot;&gt;&lt;/a&gt;原理&lt;/h3&gt;&lt;h4 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h4&gt;&lt;p&gt;ALS的矩阵分解算法常应用于推荐系统中，将用户(user)对商品(item)的评分矩阵，分解为用户对商品隐含特征的偏好矩阵，和商品在隐含特征上的映射矩阵。与传统的矩阵分解SVD方法来分解矩阵R($R\in \mathbb{R}^{m\times n}$)不同的是，ALS(alternating least squares)希望找到两个低维矩阵，以 $\tilde{R} = XY$ 来逼近矩阵R，其中 ，$X\in \mathbb{R}^{m\times d}$，$Y\in \mathbb{R}^{d\times n}$，d 表示降维后的维度，一般 d&amp;lt;&amp;lt;r，r表示矩阵 R 的秩，$r&amp;lt;&amp;lt;min(m,n)$。&lt;/p&gt;
&lt;h4 id=&quot;目标函数&quot;&gt;&lt;a href=&quot;#目标函数&quot; class=&quot;headerlink&quot; title=&quot;目标函数&quot;&gt;&lt;/a&gt;目标函数&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;为了找到低维矩阵X,Y最大程度地逼近矩分矩阵R，最小化下面的平方误差损失函数。&lt;br&gt;&lt;code&gt;$$L(X,Y) = \sum_{u,i}(r_{ui} - x_{u}^{T}y_{i})^{2}......(1)$$&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;为防止过拟合给公式 (1) 加上正则项，公式改下为： &lt;code&gt;$$L(X,Y) = \sum_{u,i}(r_{ui} - x_{u}^{T}y_{i})^{2} + \lambda (\left | x_{u}\right |^{2} +　\left | y_{i}\right |^{2})......(2)$$&lt;/code&gt;&lt;br&gt;其中$x&lt;em&gt;{u}\in \mathbb{R}^{d}，y&lt;/em&gt;{i}\in \mathbb{R}^{d}$，$1\leqslant u\leqslant m$，$1\leqslant i\leqslant n$，$\lambda$是正则项的系数。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;模型求解&quot;&gt;&lt;a href=&quot;#模型求解&quot; class=&quot;headerlink&quot; title=&quot;模型求解&quot;&gt;&lt;/a&gt;模型求解&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;固定Y，对$x&lt;em&gt;{u}$ 求导 $\frac{\partial L(X,Y)}{\partial x&lt;/em&gt;{u}} = 0$，得到求解$x&lt;em&gt;{u}$的公式&lt;br&gt;`$$x&lt;/em&gt;{u} = (Y^{T}Y + \lambda I )^{-1}Y^{T}r(u)……(3)$$`&lt;/li&gt;
&lt;li&gt;同理固定X,可得到求解$y&lt;em&gt;{i}$的公式&lt;br&gt;`$$y&lt;/em&gt;{i} = (X^{T}X + \lambda I )^{-1}X^{T}r(i)……(4)$$`&lt;br&gt;其中，$r&lt;em&gt;{u}\in \mathbb{R}^{n}$,$r&lt;/em&gt;{i}\in \mathbb{R}^{m}$,I表示一个d * d的单位矩阵。&lt;/li&gt;
&lt;li&gt;基于公式(3)、(4)，首先随机初始化矩阵X，然后利用公式(3)更新Y，接着用公式(4)更新X，直到计算出的RMSE(均方根误差)值收敛或迭代次数足够多而结束迭代为止。&lt;br&gt;其中，$\tilde{R} = XY$，$RMSE = \sqrt{\frac{\sum (R - \tilde{R})^{2}}{N}}$&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;ALS-WR模型&quot;&gt;&lt;a href=&quot;#ALS-WR模型&quot; class=&quot;headerlink&quot; title=&quot;ALS-WR模型&quot;&gt;&lt;/a&gt;ALS-WR模型&lt;/h4&gt;&lt;p&gt;以上模型适用于用户对商品的有明确的评分矩阵的场景，然而很多情况下用户没有明确的反馈对商品的偏好，而是通过一些行为隐式的反馈。比如对商品的购买次数、对电视节目收看的次数或者时长，这时我们可以推测次数越多，看得时间越长，用户的偏好程度越高，但是对于没有购买或者收看的节目，可能是由于用户不知道有该商品，或者没有途径获取该商品，我们不能确定的推测用户不喜欢该商品。ALS-WR通过置信度的权重来解决此问题，对于我们更确信用户偏好的项赋予较大的权重，对于没有反馈的项，赋予较小的权重。模型如下&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ALS-WR目标函数&lt;br&gt;`$\underset{x&lt;em&gt;{u},y&lt;/em&gt;{i}}{min} L(X,Y) = \sum&lt;em&gt;{u,i}c&lt;/em&gt;{ui}(p&lt;em&gt;{ui} - x&lt;/em&gt;{u}^{T}y&lt;em&gt;{i})^{2} + \lambda (\left | x&lt;/em&gt;{u}\right |^{2} +　\left | y&lt;em&gt;{i}\right |^{2})……(5)$&lt;br&gt;其中 $$p&lt;/em&gt;{ui} = \begin{cases} &amp;amp; \text{1 if } r&lt;em&gt;{ui} &amp;gt; 0 \ &amp;amp; \text{0 if } r&lt;/em&gt;{ui} = 0 \end{cases}$$&lt;br&gt;$c&lt;em&gt;{ui} = 1 + \alpha r&lt;/em&gt;{ui}$，$\alpha$是置信度系数&lt;/li&gt;
&lt;li&gt;通过最小二乘法求解&lt;br&gt;$$x&lt;em&gt;{u} = (Y^{T}C^{u}Y + \lambda I )^{-1}Y^{T}C^{u}r(u)……(6)$$&lt;br&gt;$$y&lt;/em&gt;{i} = (X^{T}C^{i}X + \lambda I )^{-1}X^{T}C^{i}r(i)……(7)$$&lt;br&gt;其中$C^{u}$是一$n\times n$维的个对角矩阵，$C&lt;em&gt;{ii}^{u} = c&lt;/em&gt;{ui}$; 其中$C^{u}$是一$m\times m$维的个对角矩阵，$C&lt;em&gt;{ii}^{u} = c&lt;/em&gt;{ui}$&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;与其他矩阵分解算法的比较&quot;&gt;&lt;a href=&quot;#与其他矩阵分解算法的比较&quot; class=&quot;headerlink&quot; title=&quot;与其他矩阵分解算法的比较&quot;&gt;&lt;/a&gt;与其他矩阵分解算法的比较&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;在实际应用中，由于待分解的矩阵常常是非常稀疏的，与SVD相比，ALS能有效的解决过拟合问题。&lt;/li&gt;
&lt;li&gt;基于ALS的矩阵分解的协同过滤算法的可扩展性也优于SVD。&lt;/li&gt;
&lt;li&gt;与随机梯度下降的求解方式相比，一般情况下随机梯度下降比ALS速度快；但有两种情况ALS更优于随机梯度下降：1)当系统能够并行化时，ALS的扩展性优于随机梯度下降法。2）ALS-WR能够有效的处理用户对商品的隐式反馈的数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;伪代码&quot;&gt;&lt;a href=&quot;#伪代码&quot; class=&quot;headerlink&quot; title=&quot;伪代码&quot;&gt;&lt;/a&gt;伪代码&lt;/h3&gt;&lt;figure class=&quot;highlight cos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;import numpy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;def mf_als(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;, P, &lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;K&lt;/span&gt;, steps=&lt;span class=&quot;number&quot;&gt;5000&lt;/span&gt;, alpha=&lt;span class=&quot;number&quot;&gt;0.0002&lt;/span&gt;, beta=&lt;span class=&quot;number&quot;&gt;0.02&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt;.T&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; step in xrange(steps): &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i in xrange(len(P)):                              &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            e = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i in xrange(len(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;)):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;j&lt;/span&gt; in xrange(len(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;[i])):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;[i][&lt;span class=&quot;keyword&quot;&gt;j&lt;/span&gt;] &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e = e + pow(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;[i][&lt;span class=&quot;keyword&quot;&gt;j&lt;/span&gt;] - numpy.dot(P[i,:],&lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt;[:,&lt;span class=&quot;keyword&quot;&gt;j&lt;/span&gt;]), &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;k&lt;/span&gt; in xrange(&lt;span class=&quot;keyword&quot;&gt;K&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        e = e + (beta/&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) * (pow(P[i][&lt;span class=&quot;keyword&quot;&gt;k&lt;/span&gt;],&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) + pow(&lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt;[&lt;span class=&quot;keyword&quot;&gt;k&lt;/span&gt;][&lt;span class=&quot;keyword&quot;&gt;j&lt;/span&gt;],&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; e &amp;lt; &lt;span class=&quot;number&quot;&gt;0.001&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; P, &lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt;.T&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt; = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt; = numpy.array(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    N, M, &lt;span class=&quot;keyword&quot;&gt;K&lt;/span&gt; = len(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;), len(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]), &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    P = numpy.random.rand(N,&lt;span class=&quot;keyword&quot;&gt;K&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt; = numpy.random.rand(M,&lt;span class=&quot;keyword&quot;&gt;K&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    nP, nQ = mf_als(&lt;span class=&quot;keyword&quot;&gt;R&lt;/span&gt;, P, &lt;span class=&quot;keyword&quot;&gt;Q&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;K&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; numpy.dot(nP, nQ.T)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;并行化方法&quot;&gt;&lt;a href=&quot;#并行化方法&quot; class=&quot;headerlink&quot; title=&quot;并行化方法&quot;&gt;&lt;/a&gt;并行化方法&lt;/h3&gt;&lt;p&gt;整体思路就是把矩阵拆成行向量，分别来做最小二乘参数估计。&lt;/p&gt;
&lt;p&gt;伪代码中，所有数据都被广播到了集群节点。实际代码中，只会向各节点分发其运算能用到的部分数据。&lt;/p&gt;
&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# &lt;span class=&quot;keyword&quot;&gt;M&lt;/span&gt;： item个数， &lt;span class=&quot;keyword&quot;&gt;U&lt;/span&gt;： user个数， F： 分解矩阵的秩&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 初始化评分矩阵&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;R = &lt;span class=&quot;built_in&quot;&gt;matrix&lt;/span&gt;(rand(&lt;span class=&quot;keyword&quot;&gt;M&lt;/span&gt;, F)) * &lt;span class=&quot;built_in&quot;&gt;matrix&lt;/span&gt;(rand(&lt;span class=&quot;keyword&quot;&gt;U&lt;/span&gt;, F).T)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ms = &lt;span class=&quot;built_in&quot;&gt;matrix&lt;/span&gt;(rand(&lt;span class=&quot;keyword&quot;&gt;M&lt;/span&gt; ,F))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;us&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;matrix&lt;/span&gt;(rand(&lt;span class=&quot;keyword&quot;&gt;U&lt;/span&gt;, F))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 将评分矩阵，item矩阵，user矩阵广播到所有节点&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Rb = &lt;span class=&quot;keyword&quot;&gt;sc&lt;/span&gt;.broadcast(R)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;msb = &lt;span class=&quot;keyword&quot;&gt;sc&lt;/span&gt;.broadcast(ms)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;usb = &lt;span class=&quot;keyword&quot;&gt;sc&lt;/span&gt;.broadcast(&lt;span class=&quot;keyword&quot;&gt;us&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 指定遍历次数ITERATIONS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;range&lt;/span&gt;(ITERATIONS):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 固定user矩阵，分布式求解item矩阵&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 每个节点计算&lt;span class=&quot;keyword&quot;&gt;M&lt;/span&gt;/slices个items&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ms = &lt;span class=&quot;keyword&quot;&gt;sc&lt;/span&gt;.parallelize(&lt;span class=&quot;keyword&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;M&lt;/span&gt;), slices) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           .map(lambda x: &lt;span class=&quot;keyword&quot;&gt;update&lt;/span&gt;(x, msb.value[x, :], usb.value, Rb.value)) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           .collect()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ms = &lt;span class=&quot;built_in&quot;&gt;matrix&lt;/span&gt;(np.array(ms)[:, :, 0])      # collect() returns a &lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;so&lt;/span&gt; array ends up being&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                            # a 3-&lt;span class=&quot;keyword&quot;&gt;d&lt;/span&gt; array, we take the first 2 dims &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; the &lt;span class=&quot;built_in&quot;&gt;matrix&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 广播更新后的item矩阵&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    msb = &lt;span class=&quot;keyword&quot;&gt;sc&lt;/span&gt;.broadcast(ms)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 固定item矩阵，分布式求解user矩阵&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;us&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;sc&lt;/span&gt;.parallelize(&lt;span class=&quot;keyword&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;U&lt;/span&gt;), slices) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           .map(lambda x: &lt;span class=&quot;keyword&quot;&gt;update&lt;/span&gt;(x, usb.value[x, :], msb.value, Rb.value.T)) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           .collect()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;us&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;matrix&lt;/span&gt;(np.array(&lt;span class=&quot;keyword&quot;&gt;us&lt;/span&gt;)[:, :, 0])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    usb = &lt;span class=&quot;keyword&quot;&gt;sc&lt;/span&gt;.broadcast(&lt;span class=&quot;keyword&quot;&gt;us&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 平方误差&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;error&lt;/span&gt; = rmse(R, ms, &lt;span class=&quot;keyword&quot;&gt;us&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 最小二乘更新数据&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 输入：矩阵行index，要更新的特征向量，固定的特征矩阵，评分矩阵&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;def &lt;span class=&quot;keyword&quot;&gt;update&lt;/span&gt;(i, &lt;span class=&quot;keyword&quot;&gt;vec&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;mat&lt;/span&gt;, ratings):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    uu = &lt;span class=&quot;keyword&quot;&gt;mat&lt;/span&gt;.shape[0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ff = &lt;span class=&quot;keyword&quot;&gt;mat&lt;/span&gt;.shape[1]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 变成可逆矩阵&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    XtX = &lt;span class=&quot;keyword&quot;&gt;mat&lt;/span&gt;.T * &lt;span class=&quot;keyword&quot;&gt;mat&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Xty = &lt;span class=&quot;keyword&quot;&gt;mat&lt;/span&gt;.T * ratings[i, :].T&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 正则项&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; j &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;range&lt;/span&gt;(ff):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        XtX[j,j] += LAMBDA * uu&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # XtXZ=XtY，求Z并返回&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    # 返回类型为二维数组。因为每次&lt;span class=&quot;keyword&quot;&gt;update&lt;/span&gt;只计算一个向量，所以实际只有第一维有值。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; np.linalg.solve(XtX, Xty)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;文献&quot;&gt;&lt;a href=&quot;#文献&quot; class=&quot;headerlink&quot; title=&quot;文献&quot;&gt;&lt;/a&gt;文献&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.173.2797&amp;amp;rep=rep1&amp;amp;type=pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Large-scale Parallel Collaborative Filtering for the Netfli Prize&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=4781121&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Collaborative Filtering for Implicit Feedback Datasets&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://rakaposhi.eas.asu.edu/cse494/lsi-for-collab-filtering.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MATRIX FACTORIZATION TECHNIQUES FOR RECOMMENDER SYSTEMS&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;具体实现及调用&quot;&gt;&lt;a href=&quot;#具体实现及调用&quot; class=&quot;headerlink&quot; title=&quot;具体实现及调用&quot;&gt;&lt;/a&gt;具体实现及调用&lt;/h2&gt;&lt;h3 id=&quot;模型调用&quot;&gt;&lt;a href=&quot;#模型调用&quot; class=&quot;headerlink&quot; title=&quot;模型调用&quot;&gt;&lt;/a&gt;模型调用&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;输入数据结构与说明&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Rating(UserId:Int, ItemId:Int, Rating:toDouble)&lt;/code&gt; 用户、商品id必须为整形，评分为浮点型。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;模型输出数据结构及说明&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RDD[(Id:Int, Array[feature:Double]]]&lt;/code&gt; 可以分别输出userFeatures和itemFeatures。包含id和隐含特征值。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;推荐结果输出数据结构及说明&lt;/strong&gt;：&lt;br&gt;&lt;code&gt;Rating(UserId:Int, ItemId:Int, Rating:toDouble)&lt;/code&gt; 用户、商品id与预测评分。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法调用语句示例&lt;/strong&gt;：&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;import org.apache.spark.mllib.recommendation.ALS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import org.apache.spark.mllib.recommendation.Rating&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Load&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;parse&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val &lt;span class=&quot;keyword&quot;&gt;data&lt;/span&gt; = sc.textFile(&lt;span class=&quot;string&quot;&gt;&quot;mllib/data/als/test.data&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val ratings = data.map(_.split(&lt;span class=&quot;string&quot;&gt;&#39;,&#39;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;match&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Array&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, item, rate) =&amp;gt;  Rating(user.toInt, item.toInt, rate.toDouble)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Build&lt;/span&gt; the recommendation &lt;span class=&quot;keyword&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; ALS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val numIterations = &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val &lt;span class=&quot;keyword&quot;&gt;model&lt;/span&gt; = ALS.train(ratings, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.01&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &lt;span class=&quot;keyword&quot;&gt;Evaluate&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; rating &lt;span class=&quot;keyword&quot;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val usersProducts = ratings.map&amp;#123; &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; Rating(&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, product, rate)  =&amp;gt; (&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, product)&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val predictions = model.predict(usersProducts).map&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; Rating(&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, product, rate) =&amp;gt; ((&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, product), rate)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val ratesAndPreds = ratings.map&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; Rating(&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, product, rate) =&amp;gt; ((&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, product), rate)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;.join(predictions)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val MSE = ratesAndPreds.map&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; ((&lt;span class=&quot;keyword&quot;&gt;user&lt;/span&gt;, product), (r1, r2)) =&amp;gt;  math.pow((r1- r2), &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;.reduce(_ + _)/ratesAndPreds.count&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;println(&lt;span class=&quot;string&quot;&gt;&quot;Mean Squared Error = &quot;&lt;/span&gt; + MSE)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;性能参数配置&lt;/strong&gt;：&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;val conf = new SparkConf()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  .&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;spark.serializer&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;org.apache.spark.serializer.KryoSerializer&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  .&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;spark.kryo.registrator&quot;&lt;/span&gt;,  classOf[ALSRegistrator].getName)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Whether &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; track references &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; same object when serializing data &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; Kryo, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    which &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; necessary &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; your object graphs have loops &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; useful &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; efficiency &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; they &lt;span class=&quot;keyword&quot;&gt;contain&lt;/span&gt; multiple copies &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; same object. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Can be disabled &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; improve performance &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; you know this &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; case.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  .&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;spark.kryo.referenceTracking&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;false&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  .&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;spark.kryoserializer.buffer.mb&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;8&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; milliseconds &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; wait &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;launch&lt;/span&gt; a data-&lt;span class=&quot;keyword&quot;&gt;local&lt;/span&gt; task &lt;span class=&quot;keyword&quot;&gt;before&lt;/span&gt; giving up &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; launching &lt;span class=&quot;keyword&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a less-&lt;span class=&quot;keyword&quot;&gt;local&lt;/span&gt; node. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    You should increase this setting &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; your tasks are long &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; see poor locality, &lt;span class=&quot;keyword&quot;&gt;but&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; default usually works well.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  .&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;spark.locality.wait&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;10000&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;val conf = new SparkConf()&lt;br&gt;  .set(“spark.serializer”, “org.apache.spark.serializer.KryoSerializer”)&lt;br&gt;  .set(“spark.kryo.registrator”,  classOf[ALSRegistrator].getName)&lt;br&gt;    /&lt;em&gt;&lt;br&gt;    Whether to track references to the same object when serializing data with Kryo,&lt;br&gt;    which is necessary if your object graphs have loops&lt;br&gt;    and useful for efficiency if they contain multiple copies of the same object.&lt;br&gt;    Can be disabled to improve performance if you know this is not the case.
    &lt;/em&gt;/&lt;br&gt;  .set(“spark.kryo.referenceTracking”, “false”)&lt;br&gt;  .set(“spark.kryoserializer.buffer.mb”, “8”)&lt;br&gt;    /&lt;em&gt;&lt;br&gt;    Number of milliseconds to wait to launch a data-local task before giving up and launching it on a less-local node.&lt;br&gt;    You should increase this setting if your tasks are long and see poor locality, but the default usually works well.
    &lt;/em&gt;/&lt;br&gt;  .set(“spark.locality.wait”, “10000”)&lt;/p&gt;
&lt;h2 id=&quot;案例描述&quot;&gt;&lt;a href=&quot;#案例描述&quot; class=&quot;headerlink&quot; title=&quot;案例描述&quot;&gt;&lt;/a&gt;案例描述&lt;/h2&gt;&lt;h3 id=&quot;业务问题描述及分析&quot;&gt;&lt;a href=&quot;#业务问题描述及分析&quot; class=&quot;headerlink&quot; title=&quot;业务问题描述及分析&quot;&gt;&lt;/a&gt;业务问题描述及分析&lt;/h3&gt;&lt;h4 id=&quot;问题描述-1&quot;&gt;&lt;a href=&quot;#问题描述-1&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h4&gt;&lt;p&gt;在电子商务领域中，当用户面对大量的商品时，往往无法快速找到自己喜欢的商品，或者不是非常明确的知道自己喜欢商品。和搜索引擎相比的推荐系统通过研究用户的兴趣偏好，进行个性化计算，由系统发现用户的兴趣点，从而引导用户发现自己的需求。&lt;/p&gt;
&lt;h4 id=&quot;简要分析&quot;&gt;&lt;a href=&quot;#简要分析&quot; class=&quot;headerlink&quot; title=&quot;简要分析&quot;&gt;&lt;/a&gt;简要分析&lt;/h4&gt;&lt;p&gt;矩阵分解是推荐系统中非常重要的一种算法，它通过将用户对商品的评分矩阵（或者隐含数据），分解为用户对商品隐含特征的偏好矩阵，和商品在隐含特征上的映射矩阵。如果用户所偏好特征，在商品上基本都出现，我们可以认为这个商品是用户喜欢的，进而可以将该商品推荐给用户。&lt;/p&gt;
&lt;p&gt;我们用历史的订单数据作为训练数据，来预测用户对未购买过的商品的偏好程度，将偏好程度最高topN的商品推荐给用户。&lt;/p&gt;
&lt;h3 id=&quot;数据的准备&quot;&gt;&lt;a href=&quot;#数据的准备&quot; class=&quot;headerlink&quot; title=&quot;数据的准备&quot;&gt;&lt;/a&gt;数据的准备&lt;/h3&gt;&lt;p&gt;图书品类下，2014年1月到5月的订单数据，取在1~4月和4~5月两个区间都有图书购物记录的用户。1~4月为训练数据，4~5月为测试数据。用户对商品有购买行为，则隐性反馈值为1。&lt;/p&gt;
&lt;h3 id=&quot;算法的运行及模型生成&quot;&gt;&lt;a href=&quot;#算法的运行及模型生成&quot; class=&quot;headerlink&quot; title=&quot;算法的运行及模型生成&quot;&gt;&lt;/a&gt;算法的运行及模型生成&lt;/h3&gt;&lt;h4 id=&quot;性能&quot;&gt;&lt;a href=&quot;#性能&quot; class=&quot;headerlink&quot; title=&quot;性能&quot;&gt;&lt;/a&gt;性能&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;N = User*Item&lt;/code&gt; N的最大值（理论估计+实际验证） 测试了两组数据集：&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第一组：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;训练： pair：6557620 用户：781030 商品：726490&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;测试： pair：3250426 用户：781030 商品：490257&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight mathematica&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;N&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;726490&lt;/span&gt;*&lt;span class=&quot;number&quot;&gt;781030&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;567410484700&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;稀疏度 =pair/&lt;span class=&quot;keyword&quot;&gt;N&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0.0000115571&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;worker-num,worker-mem,blocks,kryo,kryo-reference,locality-wait&lt;/code&gt; 等运行参数与数据量对一轮迭代时间的影响。&lt;/li&gt;
&lt;li&gt;运行时rdd的transform和action的运算时间与shuffle大小。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;模型&quot;&gt;&lt;a href=&quot;#模型&quot; class=&quot;headerlink&quot; title=&quot;模型&quot;&gt;&lt;/a&gt;模型&lt;/h4&gt;&lt;p&gt;数据性质：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;稀疏性（行为（评分、购买），品类）
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;参数选择：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;lambda，alpha，R，iter
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;模型的评估&quot;&gt;&lt;a href=&quot;#模型的评估&quot; class=&quot;headerlink&quot; title=&quot;模型的评估&quot;&gt;&lt;/a&gt;模型的评估&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;矩阵分解的评估&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;原始矩阵为R，预测的为$\tilde{R} = U^{T}V$，用RMSE来评估预测的效果。&lt;br&gt;$$RMSE = \sqrt{\frac{\sum (R - \tilde{R})^{2}}{N}}$$&lt;br&gt;其中N为中所有求和的项数&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;推荐效果的评估&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;对推荐预测的效果一般用准确率(precision)和召回率(recall)来衡量。R(u)是根据用户在训练集上的行为给用户推荐的列表，T(u)是用户在测试集上的行为列表。则有&lt;/p&gt;
&lt;p&gt;召回率&lt;br&gt;$$Recall = \frac{\sum&lt;em&gt;{u\in U }\left |R(u)\bigcap T(u) \right |}{\sum&lt;/em&gt;{u\in U }\left |T(u) \right |}$$&lt;/p&gt;
&lt;p&gt;准确率&lt;br&gt;$$Precise = \frac{\sum&lt;em&gt;{u\in U }\left |R(u)\bigcap T(u) \right |}{\sum&lt;/em&gt;{u\in U }\left |R(u) \right |}$$&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;与mahout的对比&quot;&gt;&lt;a href=&quot;#与mahout的对比&quot; class=&quot;headerlink&quot; title=&quot;与mahout的对比&quot;&gt;&lt;/a&gt;与mahout的对比&lt;/h2&gt;&lt;p&gt;mahout与spark性能对比&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据量 6991409行，134M&lt;/li&gt;
&lt;li&gt;集群环境：mahout与spark安装在同一集群环境&lt;/li&gt;
&lt;li&gt;影响运行时间的参数：降维后的秩 30，迭代次数 30，mahout与spark设置相同&lt;/li&gt;
&lt;li&gt;运行时间：mahout(10个reduce) 运行180 minutes，spark 运行 40 minutes&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;阿基米德项目ALS矩阵分解算法应用案例&quot;&gt;&lt;a href=&quot;#阿基米德项目ALS矩阵分解算法应用案例&quot; class=&quot;headerlink&quot; title=&quot;阿基米德项目ALS矩阵分解算法应用案例&quot;&gt;&lt;/a&gt;阿基米德项目ALS矩阵分解算法应用案例&lt;/h1&gt;&lt;p&gt;原文
    
    </summary>
    
      <category term="spasrk" scheme="http://jackalope.cn/categories/spasrk/"/>
    
    
      <category term="als spark ml" scheme="http://jackalope.cn/tags/als-spark-ml/"/>
    
  </entry>
  
  <entry>
    <title>mysql-tips</title>
    <link href="http://jackalope.cn/2016/09/23/mysql-tips/"/>
    <id>http://jackalope.cn/2016/09/23/mysql-tips/</id>
    <published>2016-09-23T00:50:52.000Z</published>
    <updated>2017-01-20T07:15:51.027Z</updated>
    
    <content type="html">&lt;p&gt;记录使用mysql的过程中一些技巧、方法、注意事项。&lt;/p&gt;
&lt;h1 id=&quot;浅谈MySQL之-Handlerread-参数&quot;&gt;&lt;a href=&quot;#浅谈MySQL之-Handlerread-参数&quot; class=&quot;headerlink&quot; title=&quot;浅谈MySQL之 Handlerread*参数&quot;&gt;&lt;/a&gt;浅谈MySQL之 Handler&lt;em&gt;read&lt;/em&gt;*参数&lt;/h1&gt;&lt;p&gt;原文：&lt;a href=&quot;http://gfsunny.blog.51cto.com/990565/1558480&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;浅谈MySQL之 Handler&lt;em&gt;read&lt;/em&gt;*参数 &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;摘要：&lt;/p&gt;
&lt;p&gt;使用步骤如下：&lt;br&gt;&lt;figure class=&quot;highlight fortran&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;FLUSH&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;STATUS&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2.&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; ...;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;3.&lt;/span&gt;SHOW SESSION &lt;span class=&quot;keyword&quot;&gt;STATUS&lt;/span&gt; LIKE &lt;span class=&quot;string&quot;&gt;&#39;Handler_read%&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;4.&lt;/span&gt;EXPLAIN &lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; ...;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Handler_read_first: first key被读取的次数，如果该值很高，则说明做了很多全索引扫描，例如：&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; col1 &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; foo, 假设列col1是索引列。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Handler_read_key: 基于索引请求数据的次数，如果该值很高，则说明查询高效地使用了索引。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Handler_read_last：&lt;span class=&quot;keyword&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;key&lt;/span&gt;被读取的次数，如果存在&lt;span class=&quot;keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;BY&lt;/span&gt;子句，服务器将会在几个&lt;span class=&quot;keyword&quot;&gt;next&lt;/span&gt;-&lt;span class=&quot;keyword&quot;&gt;key&lt;/span&gt;请求后发出一个&lt;span class=&quot;keyword&quot;&gt;first&lt;/span&gt;-&lt;span class=&quot;keyword&quot;&gt;key&lt;/span&gt;请求，然而在&lt;span class=&quot;keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DESC&lt;/span&gt;子句下，服务器将会在几个previous-&lt;span class=&quot;keyword&quot;&gt;key&lt;/span&gt;后发出一个&lt;span class=&quot;keyword&quot;&gt;last&lt;/span&gt;-&lt;span class=&quot;keyword&quot;&gt;key&lt;/span&gt;请求，该变量在MySQL &lt;span class=&quot;number&quot;&gt;5.6&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;版本加入。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Handler_read_next：按照索引从数据文件中取出数据的次数。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Handler_read_prev：按照索引倒序从数据文件中取出数据的次数，一般就是&lt;span class=&quot;keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;BY&lt;/span&gt; ... &lt;span class=&quot;keyword&quot;&gt;DESC&lt;/span&gt;。注意Handler_read_next是&lt;span class=&quot;keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;BY&lt;/span&gt; ... &lt;span class=&quot;keyword&quot;&gt;ASC&lt;/span&gt;的方式取数据。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Handler_read_rnd：基于混合位置请求数据的次数，如果该值很高，则说明做了很多要求结果排序的查询，可能查询要求全表扫描或&lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;操作未正确使用&lt;span class=&quot;keyword&quot;&gt;key&lt;/span&gt;。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Handler_read_rnd_next：在数据文件中读下一行的请求数。如果你正进行大量的表扫描，该值较高。通常说明你的表索引不正确或写入的查询没有利用索引。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;mysql索引失效的几种情况&quot;&gt;&lt;a href=&quot;#mysql索引失效的几种情况&quot; class=&quot;headerlink&quot; title=&quot;mysql索引失效的几种情况&quot;&gt;&lt;/a&gt;mysql索引失效的几种情况&lt;/h1&gt;&lt;p&gt;原文：&lt;a href=&quot;http://www.jb51.net/article/50649.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mysql索引失效的几种情况&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用mysql的过程中一些技巧、方法、注意事项。&lt;/p&gt;
&lt;h1 id=&quot;浅谈MySQL之-Handlerread-参数&quot;&gt;&lt;a href=&quot;#浅谈MySQL之-Handlerread-参数&quot; class=&quot;headerlink&quot; title=&quot;浅谈MySQL之 Han
    
    </summary>
    
      <category term="mysql" scheme="http://jackalope.cn/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://jackalope.cn/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>hbase-tips</title>
    <link href="http://jackalope.cn/2016/09/23/hbase-tips/"/>
    <id>http://jackalope.cn/2016/09/23/hbase-tips/</id>
    <published>2016-09-23T00:50:52.000Z</published>
    <updated>2017-01-20T07:32:06.569Z</updated>
    
    <content type="html">&lt;p&gt;记录使用hbase的过程中一些技巧、方法、注意事项。&lt;/p&gt;
&lt;h1 id=&quot;hbase的内存分配策略&quot;&gt;&lt;a href=&quot;#hbase的内存分配策略&quot; class=&quot;headerlink&quot; title=&quot;hbase的内存分配策略&quot;&gt;&lt;/a&gt;hbase的内存分配策略&lt;/h1&gt;&lt;p&gt;原文：&lt;a href=&quot;http://hbasefly.com/2016/06/18/hbase-practise-ram/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;hbase的内存分配策略&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用hbase的过程中一些技巧、方法、注意事项。&lt;/p&gt;
&lt;h1 id=&quot;hbase的内存分配策略&quot;&gt;&lt;a href=&quot;#hbase的内存分配策略&quot; class=&quot;headerlink&quot; title=&quot;hbase的内存分配策略&quot;&gt;&lt;/a&gt;hbase的内存分配策略&lt;/h1
    
    </summary>
    
      <category term="hbase" scheme="http://jackalope.cn/categories/hbase/"/>
    
    
      <category term="hbase" scheme="http://jackalope.cn/tags/hbase/"/>
    
  </entry>
  
  <entry>
    <title>spark-tips</title>
    <link href="http://jackalope.cn/2016/09/23/spark-tips/"/>
    <id>http://jackalope.cn/2016/09/23/spark-tips/</id>
    <published>2016-09-23T00:50:52.000Z</published>
    <updated>2017-01-20T08:27:29.826Z</updated>
    
    <content type="html">&lt;p&gt;记录使用spark的过程中一些技巧、方法、注意事项。&lt;/p&gt;
&lt;h1 id=&quot;executor-cores-executor-memory对执行效率的影响&quot;&gt;&lt;a href=&quot;#executor-cores-executor-memory对执行效率的影响&quot; class=&quot;headerlink&quot; title=&quot;executor-cores/executor-memory对执行效率的影响&quot;&gt;&lt;/a&gt;executor-cores/executor-memory对执行效率的影响&lt;/h1&gt;&lt;p&gt;环境：1 master/4 workers（12核，32G内存，其中spark可用资源为12核，16G内存）&lt;br&gt;程序说明：对约3000万行游戏数据进行ALS模型训练，并对所有用户（约600万）预测200款游戏的评分，最后取出每个用户20款评分最高的游戏进行推荐。&lt;br&gt;效率测试过程：&lt;br&gt;1.executor-cores 12, executor-memory 16g&lt;br&gt;这种配置下，一共会启用4个executor，共使用48 cores, 64G内存。&lt;br&gt;开始时间：16/09/22 16:06:32&lt;br&gt;结束时间：16/09/22 18:05:01&lt;br&gt;耗时：7109s = 118.5m&lt;br&gt;2.executor-cores 3, executor-memory 4g&lt;br&gt;这种配置下，一共会启用16个executor，共使用48 cores, 64G内存。&lt;br&gt;开始时间：2016/9/22 23:00:02&lt;br&gt;结束时间：2016/9/23 0:50:11&lt;br&gt;耗时：6609s = 110.15m&lt;br&gt;3.executor-cores 1, executor-memory 2g, total-executor-cores 16&lt;br&gt;这种配置下，一共会启用16个executor，共使用16 cores, 32G内存，可以结余出资源供其他程序使用。&lt;br&gt;开始时间：2016/9/22 18:32:17&lt;br&gt;结束时间：2016/9/22 21:21:47&lt;br&gt;耗时：10170s = 169.5m&lt;/p&gt;
&lt;p&gt;结论：&lt;br&gt;&lt;code&gt;1.使用所有资源，其效率比使用部分资源效率要高，但并不能成比例增长；&lt;/code&gt;&lt;br&gt;&lt;code&gt;2.增加executor个数可稍微提升执行效率。&lt;/code&gt;&lt;br&gt;&lt;code&gt;PS: 由于集群规模有限，所得到的信息也相对有限，因此，针对不同集群规模，需做相应的测试，不可直接套用此结论。&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;scala-MatchError-GenericRowWithSchema&quot;&gt;&lt;a href=&quot;#scala-MatchError-GenericRowWithSchema&quot; class=&quot;headerlink&quot; title=&quot;scala.MatchError, GenericRowWithSchema&quot;&gt;&lt;/a&gt;scala.MatchError, GenericRowWithSchema&lt;/h1&gt;&lt;p&gt;在评估ALS模型时，需要将predictions中的内容全部取出来计算方差和标准差，而在提取每行内容时，遇到错误如下：&lt;br&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;09&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;29&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;40&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;59&lt;/span&gt; WARN scheduler&lt;span class=&quot;selector-class&quot;&gt;.TaskSetManager&lt;/span&gt;: Lost task &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; stage &lt;span class=&quot;number&quot;&gt;103.0&lt;/span&gt; (TID &lt;span class=&quot;number&quot;&gt;492&lt;/span&gt;, bis-newdatanode-s2b-&lt;span class=&quot;number&quot;&gt;67&lt;/span&gt;): scala&lt;span class=&quot;selector-class&quot;&gt;.MatchError&lt;/span&gt;: [&lt;span class=&quot;number&quot;&gt;0.0013&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0.018407427&lt;/span&gt;] (of class org&lt;span class=&quot;selector-class&quot;&gt;.apache&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.spark&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sql&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.catalyst&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.expressions&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.GenericRowWithSchema&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;提示说明类型不匹配，查看我的代码：&lt;br&gt;&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;val predictions = model.transform(test).&lt;span class=&quot;keyword&quot;&gt;cache&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;val mse = predictions.&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;rating&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;prediction&quot;&lt;/span&gt;).rdd.flatMap &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; Row(rating: Double, prediction: Double) =&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;进一步查看transform方法：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;override &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(dataset: DataFrame)&lt;/span&gt;:&lt;/span&gt; DataFrame = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Register a UDF &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; DataFrame, &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // create a new column named map(predictionCol) by running the predict UDF.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    val predict = udf &amp;#123; (userFeatures: Seq[Float], itemFeatures: Seq[Float]) =&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (userFeatures != null &amp;amp;&amp;amp; itemFeatures != null) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        blas.sdot(rank, userFeatures.toArray, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, itemFeatures.toArray, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Float.NaN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dataset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      .join(userFactors, dataset($(userCol)) === userFactors(&lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;), &lt;span class=&quot;string&quot;&gt;&quot;left&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      .join(itemFactors, dataset($(itemCol)) === itemFactors(&lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;), &lt;span class=&quot;string&quot;&gt;&quot;left&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      .select(dataset(&lt;span class=&quot;string&quot;&gt;&quot;*&quot;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        predict(userFactors(&lt;span class=&quot;string&quot;&gt;&quot;features&quot;&lt;/span&gt;), itemFactors(&lt;span class=&quot;string&quot;&gt;&quot;features&quot;&lt;/span&gt;)).&lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt;($(predictionCol)))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;说明rating字段类型，与传入参数test中的rating字段类型一致，而prediction字段类型，是由blas.sdot()函数决定的，查看该函数：&lt;br&gt;&lt;figure class=&quot;highlight aspectj&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;sdot&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n, &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt;[] sx, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; incx, &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt;[] sy, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; incy)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;其返回值是float型，因此，将提取行数据的代码修改为：&lt;br&gt;&lt;figure class=&quot;highlight zephir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; Row(rating: &lt;span class=&quot;keyword&quot;&gt;Double&lt;/span&gt;, prediction: &lt;span class=&quot;keyword&quot;&gt;Float&lt;/span&gt;) =&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;ALS模型评估&quot;&gt;&lt;a href=&quot;#ALS模型评估&quot; class=&quot;headerlink&quot; title=&quot;ALS模型评估&quot;&gt;&lt;/a&gt;ALS模型评估&lt;/h1&gt;&lt;p&gt;为了评估各参数对ALS模型的准确性及其性能的影响，进行了100多次的训练和测试，计根据模型预测结果与真实结果比较，计算其标准差来作为判断准确性的依据。&lt;br&gt;样本条数：100万。&lt;br&gt;评估结果&lt;a href=&quot;ALS评估.xlsx&quot;&gt;(ALS评估.xlsx)&lt;/a&gt;如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;ALS评估.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;使用训练数据预测并计算RMSE：&lt;br&gt;&lt;img src=&quot;ALS评估_使用训练数据预测.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;使用测试数据预测并计算RMSE：&lt;br&gt;&lt;img src=&quot;ALS评估_使用测试数据预测.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;结论：对于相同的数据集，其rank、iteration取值越大，RMSE越小，rank大于8、iteration大于12后，RMSE变化不再明显； 对于训练数据，其lambda值取0.0001时，有较小的RMSE，而对于测试数据，lambda取值0.1具有较小的RMSE；因此，取rank=8, iteration = 12, lambda = 0.1。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意：不同数据集需做不同的评估，以得出合适的参数值。&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;scala-list-reduce与-spark-rdd-reduce比较&quot;&gt;&lt;a href=&quot;#scala-list-reduce与-spark-rdd-reduce比较&quot; class=&quot;headerlink&quot; title=&quot;scala list reduce与 spark rdd reduce比较&quot;&gt;&lt;/a&gt;scala list reduce与 spark rdd reduce比较&lt;/h1&gt;&lt;p&gt;有同事指出scala的List做减法其多次运行结果不一致，超出了我的认知范围，特做如下实验：&lt;/p&gt;
&lt;p&gt;List的reduce做减法，多次运行结果如下：&lt;/p&gt;
&lt;figure class=&quot;highlight zephir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; val &lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;=&lt;span class=&quot;keyword&quot;&gt;List&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;: &lt;span class=&quot;keyword&quot;&gt;List&lt;/span&gt;[&lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt;] = &lt;span class=&quot;keyword&quot;&gt;List&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; &lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;.reduce((a,b) =&amp;gt; a - b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res27: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; &lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;.reduce((a,b) =&amp;gt; a - b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res28: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; &lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;.reduce((a,b) =&amp;gt; a - b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res29: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; &lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;.reduce((a,b) =&amp;gt; a - b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res30: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; &lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;.reduce((a,b) =&amp;gt; a - b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res31: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;RDD的reduce做减法：&lt;br&gt;在一个分区的情况下，多次运行，其结果如下：&lt;/p&gt;
&lt;figure class=&quot;highlight zephir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; val rdd = sc.parallelize(&lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; rdd.reduce((a,b) =&amp;gt; a - b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res32: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res33: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res34: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res35: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在多（3）个分区的情况下，多次运行，其结果如下：&lt;/p&gt;
&lt;figure class=&quot;highlight zephir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; val rdd = sc.parallelize(&lt;span class=&quot;keyword&quot;&gt;list&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;gt; rdd.reduce((a,b) =&amp;gt; a - b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res36: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res37: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res38: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res39: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;-4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;res40: &lt;span class=&quot;keyword&quot;&gt;Int&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;结论：scala下reduce做减法其结果是幂等，在spark下，当rdd的分区只有一个时，reduce的结果也是幂等的，而当rdd有多个分区时，reduce做减法其结果是不一致的。&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;KMeans评估&quot;&gt;&lt;a href=&quot;#KMeans评估&quot; class=&quot;headerlink&quot; title=&quot;KMeans评估&quot;&gt;&lt;/a&gt;KMeans评估&lt;/h1&gt;&lt;p&gt;为了评估聚类个数K和迭代次数iteration对KMeans的准确性及其性能的影响，进行了如下测试，使用各个点到其中心点的总距离cost评估其准确性。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;KMeansEvaluate.xlsx&quot;&gt;评估结果&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;K评估：&lt;br&gt;&lt;img src=&quot;KMeans_evaluate_k.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;iteration评估：&lt;br&gt;&lt;img src=&quot;KMeans_evaluate_iteration.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;结论：对于此份数据，迭代次数对其影响较小。&lt;/code&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用spark的过程中一些技巧、方法、注意事项。&lt;/p&gt;
&lt;h1 id=&quot;executor-cores-executor-memory对执行效率的影响&quot;&gt;&lt;a href=&quot;#executor-cores-executor-memory对执行效率的影响&quot; class=&quot;h
    
    </summary>
    
      <category term="spark" scheme="http://jackalope.cn/categories/spark/"/>
    
    
      <category term="spark" scheme="http://jackalope.cn/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>js-trouble-shooting</title>
    <link href="http://jackalope.cn/2016/08/09/js-trouble-shooting/"/>
    <id>http://jackalope.cn/2016/08/09/js-trouble-shooting/</id>
    <published>2016-08-09T10:32:04.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html">&lt;p&gt;记录使用js时遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;chrome-display不生效&quot;&gt;&lt;a href=&quot;#chrome-display不生效&quot; class=&quot;headerlink&quot; title=&quot;chrome display不生效&quot;&gt;&lt;/a&gt;chrome display不生效&lt;/h1&gt;&lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h2&gt;&lt;p&gt;往后台请求数据时有一定的延时，为了更好的用户体验，需要在页面进行查询时，先展示一个loading的gif图片。&lt;br&gt;关键代码如下：&lt;br&gt;&lt;figure class=&quot;highlight elixir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;#id&quot;&lt;/span&gt;).css(&lt;span class=&quot;string&quot;&gt;&quot;display&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;none&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;#id&quot;&lt;/span&gt;).css(&lt;span class=&quot;string&quot;&gt;&quot;display&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;block&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在firefox下正常显示，在chrome下不能正常展示，而在chrome下进行调试时，在此处打上断点，便又可正常显示。&lt;/p&gt;
&lt;h2 id=&quot;原因&quot;&gt;&lt;a href=&quot;#原因&quot; class=&quot;headerlink&quot; title=&quot;原因&quot;&gt;&lt;/a&gt;原因&lt;/h2&gt;&lt;p&gt;在js中使用ajax向后台请求数据时，采用了同步的方式&lt;code&gt;async: false&lt;/code&gt;引起。&lt;br&gt;一点猜测：由于使用&lt;code&gt;async: false&lt;/code&gt;时，Ajax请求会将整个浏览器锁死，而在chrome下&lt;code&gt;$(&amp;quot;#id&amp;quot;).css(&amp;quot;display&amp;quot;, &amp;quot;none&amp;quot;);&lt;/code&gt;尚未渲染完成，因此无法看到加载图片。&lt;/p&gt;
&lt;h2 id=&quot;解决办法&quot;&gt;&lt;a href=&quot;#解决办法&quot; class=&quot;headerlink&quot; title=&quot;解决办法&quot;&gt;&lt;/a&gt;解决办法&lt;/h2&gt;&lt;p&gt;使用ajax请求默认的异步请求方式，注释掉&lt;code&gt;async: false&lt;/code&gt;或将其改为&lt;code&gt;async: true&lt;/code&gt;。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;记录使用js时遇到的问题、原因及解决办法。&lt;/p&gt;
&lt;h1 id=&quot;chrome-display不生效&quot;&gt;&lt;a href=&quot;#chrome-display不生效&quot; class=&quot;headerlink&quot; title=&quot;chrome display不生效&quot;&gt;&lt;/a&gt;chrome
    
    </summary>
    
      <category term="js" scheme="http://jackalope.cn/categories/js/"/>
    
    
      <category term="js" scheme="http://jackalope.cn/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>hive-params</title>
    <link href="http://jackalope.cn/2016/07/15/hive-params/"/>
    <id>http://jackalope.cn/2016/07/15/hive-params/</id>
    <published>2016-07-15T02:08:05.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html">&lt;p&gt;本文主要翻译自hive 1.2.1版本的hive-default.xml.template。&lt;/p&gt;
&lt;h1 id=&quot;hive参数配置&quot;&gt;&lt;a href=&quot;#hive参数配置&quot; class=&quot;headerlink&quot; title=&quot;hive参数配置&quot;&gt;&lt;/a&gt;hive参数配置&lt;/h1&gt;&lt;p&gt;Hive提供三种可以改变环境变量的方法，分别是：（1）、修改配置文件；（2）、命令行参数；（3）、进入cli后设置参数。&lt;/p&gt;
&lt;h2 id=&quot;修改配置文件&quot;&gt;&lt;a href=&quot;#修改配置文件&quot; class=&quot;headerlink&quot; title=&quot;修改配置文件&quot;&gt;&lt;/a&gt;修改配置文件&lt;/h2&gt;&lt;p&gt;修改Hive的配置文件：&lt;code&gt;${HIVE_HOME}/conf/hive-site.xml&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;命令行参数&quot;&gt;&lt;a href=&quot;#命令行参数&quot; class=&quot;headerlink&quot; title=&quot;命令行参数&quot;&gt;&lt;/a&gt;命令行参数&lt;/h2&gt;&lt;p&gt;在命令行添加-hiveconf param=value来设定参数&lt;br&gt;如：&lt;br&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hive --hiveconf mapreduce&lt;span class=&quot;selector-class&quot;&gt;.job&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.queuename&lt;/span&gt;=queue1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;进入cli后设置参数&quot;&gt;&lt;a href=&quot;#进入cli后设置参数&quot; class=&quot;headerlink&quot; title=&quot;进入cli后设置参数&quot;&gt;&lt;/a&gt;进入cli后设置参数&lt;/h2&gt;&lt;p&gt;可以在进入cli后，使用SET设置参数，如：&lt;/p&gt;
&lt;figure class=&quot;highlight cos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hive&amp;gt; &lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; mapreduce.&lt;span class=&quot;keyword&quot;&gt;job&lt;/span&gt;.queuename=queue1&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这种配置也是对本次启动的会话有效，下次启动需要重新配置。&lt;br&gt;在HQL中使用SET关键字还可以查看配置的值，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight cos&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hive&amp;gt; &lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; mapreduce.&lt;span class=&quot;keyword&quot;&gt;job&lt;/span&gt;.queuename&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mapreduce.&lt;span class=&quot;keyword&quot;&gt;job&lt;/span&gt;.queuename=queue1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果set后面什么都不添加，这样可以查到Hive的所有属性配置。&lt;/p&gt;
&lt;h1 id=&quot;hive参数大全&quot;&gt;&lt;a href=&quot;#hive参数大全&quot; class=&quot;headerlink&quot; title=&quot;hive参数大全&quot;&gt;&lt;/a&gt;hive参数大全&lt;/h1&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;31&lt;/td&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;本文主要翻译自hive 1.2.1版本的hive-default.xml.template。&lt;/p&gt;
&lt;h1 id=&quot;hive参数配置&quot;&gt;&lt;a href=&quot;#hive参数配置&quot; class=&quot;headerlink&quot; title=&quot;hive参数配置&quot;&gt;&lt;/a&gt;hive参数配置
    
    </summary>
    
      <category term="hive" scheme="http://jackalope.cn/categories/hive/"/>
    
    
      <category term="hive" scheme="http://jackalope.cn/tags/hive/"/>
    
  </entry>
  
  <entry>
    <title>Java总结 - 基本概念</title>
    <link href="http://jackalope.cn/2016/04/19/java-core-conception/"/>
    <id>http://jackalope.cn/2016/04/19/java-core-conception/</id>
    <published>2016-04-19T08:28:53.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html">&lt;p&gt;本文主要介绍一些Java中的基本概念，包括数据类型、变量、运算符、字符串、输入输出、控制流程、大数值、数组。&lt;/p&gt;
&lt;h1 id=&quot;数据类型&quot;&gt;&lt;a href=&quot;#数据类型&quot; class=&quot;headerlink&quot; title=&quot;数据类型&quot;&gt;&lt;/a&gt;数据类型&lt;/h1&gt;&lt;p&gt;Java是一种强类型语言，必须为每一个变量声明一种类型。Java中一共有8种基本类型，其中有4种整型、2种浮点型、1种用于表示Unicode编码的字符单元的字符型char、1种用于表示真值的boolean型。&lt;/p&gt;
&lt;h2 id=&quot;整型&quot;&gt;&lt;a href=&quot;#整型&quot; class=&quot;headerlink&quot; title=&quot;整型&quot;&gt;&lt;/a&gt;整型&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类型&lt;/th&gt;
&lt;th&gt;存储需求&lt;/th&gt;
&lt;th&gt;后缀&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;4字节&lt;/td&gt;
&lt;td&gt;无&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;short&lt;/td&gt;
&lt;td&gt;2字节&lt;/td&gt;
&lt;td&gt;无&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;long&lt;/td&gt;
&lt;td&gt;8字节&lt;/td&gt;
&lt;td&gt;L,如1000000000L&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;byte&lt;/td&gt;
&lt;td&gt;1字节&lt;/td&gt;
&lt;td&gt;无&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;前缀：16进制0x，8进制0，如100的16进制为0x64，8进制为0144，从Java7开始，加上前缀0b就可以写二进制数，&lt;code&gt;并且，从Java7开始，可以为数字中加下划线，如：int i = 1_0_0&lt;/code&gt;如下：&lt;/p&gt;
&lt;figure class=&quot;highlight maxima&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int i = 1_0_0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int i16 = &lt;span class=&quot;number&quot;&gt;0x64&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int i8 = &lt;span class=&quot;number&quot;&gt;0144&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int i2 = &lt;span class=&quot;number&quot;&gt;0b1100100&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;System.out.println(i16 == i &amp;amp;&amp;amp; i8 == i &amp;amp;&amp;amp; i2 == i);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果为true。&lt;/p&gt;
&lt;h2 id=&quot;浮点型&quot;&gt;&lt;a href=&quot;#浮点型&quot; class=&quot;headerlink&quot; title=&quot;浮点型&quot;&gt;&lt;/a&gt;浮点型&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类型&lt;/th&gt;
&lt;th&gt;存储需求&lt;/th&gt;
&lt;th&gt;后缀&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;float&lt;/td&gt;
&lt;td&gt;4字节&lt;/td&gt;
&lt;td&gt;F,如12.3F&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;double&lt;/td&gt;
&lt;td&gt;8字节&lt;/td&gt;
&lt;td&gt;D,如12345678.9D&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;三个特殊的浮点数值：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;正无穷，Float.POSITIVE_INFINITY/Double.POSITIVE_INFINITY&lt;/li&gt;
&lt;li&gt;负无穷，Float.NEGATIVE_INFINITY/Double.NEGATIVE_INFINITY&lt;/li&gt;
&lt;li&gt;NaN(非数字), Float.NaN/Double.NaN&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;注意：不能这样检测一个特定值是否等于Double.NaN
if(x == Double.NaN) // is never true
所有&amp;quot;非数值&amp;quot;的值都认为是不同的，应该使用：
if(Double.isNan(x)) // check whether x is &amp;quot;not a number&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;警告：浮点型不适用于禁止出现舍入误差的金融计算中，如果需要在数值计算中不含有任何舍入误差，应该使用BigDecimal类。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;char型&quot;&gt;&lt;a href=&quot;#char型&quot; class=&quot;headerlink&quot; title=&quot;char型&quot;&gt;&lt;/a&gt;char型&lt;/h2&gt;&lt;p&gt;char表示单个Unicode编码的字符。Unicode编码单元可以表示为16进制，其范围从\U0000到\Uffff。&lt;/p&gt;
&lt;h1 id=&quot;变量&quot;&gt;&lt;a href=&quot;#变量&quot; class=&quot;headerlink&quot; title=&quot;变量&quot;&gt;&lt;/a&gt;变量&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;在Java中，每一个变量属于一种类型。&lt;/li&gt;
&lt;li&gt;变量名必须是以字母开头的由字母或数字构成的序列，不可使用保留字。&lt;/li&gt;
&lt;li&gt;可以在一行中声明多个变量，但不提倡这样做，逐一声明每一个变量可以提高程序的可读性。&lt;/li&gt;
&lt;li&gt;使用final关键字表示常量——只能被赋值一次，一旦被赋值后，就不能够再更改了。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;运算符&quot;&gt;&lt;a href=&quot;#运算符&quot; class=&quot;headerlink&quot; title=&quot;运算符&quot;&gt;&lt;/a&gt;运算符&lt;/h1&gt;&lt;h2 id=&quot;算术运算符&quot;&gt;&lt;a href=&quot;#算术运算符&quot; class=&quot;headerlink&quot; title=&quot;算术运算符&quot;&gt;&lt;/a&gt;算术运算符&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;符号&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;加&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;减&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;*&lt;/td&gt;
&lt;td&gt;乘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;td&gt;除&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;写法：x = x + 2;&lt;/li&gt;
&lt;li&gt;简化格式：x += 2;&lt;/li&gt;
&lt;li&gt;自增/自减运算：n++（先用后加）/++n（先加后用）；自减运算：n–（先用后减）/–n（先减后用）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;使用strictfp关键字标记的方法必须使用严格的浮点计算来产生理想的结果，如果将一个类标记为strictfp，这个类中的所有方法都要使用严格的浮点计算。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;逻辑运算符&quot;&gt;&lt;a href=&quot;#逻辑运算符&quot; class=&quot;headerlink&quot; title=&quot;逻辑运算符&quot;&gt;&lt;/a&gt;逻辑运算符&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;符号&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&gt;&lt;/td&gt;
&lt;td&gt;大于&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;lt;&lt;/td&gt;
&lt;td&gt;小于&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&gt;=&lt;/td&gt;
&lt;td&gt;大于等于&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;lt;=&lt;/td&gt;
&lt;td&gt;小于等于&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;==&lt;/td&gt;
&lt;td&gt;等于&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;!=&lt;/td&gt;
&lt;td&gt;非等于&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;amp;&amp;amp;&lt;/td&gt;
&lt;td&gt;与&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;#124;&amp;#124;&lt;/td&gt;
&lt;td&gt;或&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;!&lt;/td&gt;
&lt;td&gt;非&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&quot;位运算&quot;&gt;&lt;a href=&quot;#位运算&quot; class=&quot;headerlink&quot; title=&quot;位运算&quot;&gt;&lt;/a&gt;位运算&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;符号&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&amp;amp;&lt;/td&gt;
&lt;td&gt;与&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;#124;&lt;/td&gt;
&lt;td&gt;或&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;!&lt;/td&gt;
&lt;td&gt;非&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&gt;&amp;gt;&lt;/td&gt;
&lt;td&gt;右移位，可以用来屏蔽低位，或进行2的倍数计算，如8&amp;gt;&amp;gt;3 == 1，计算过程：转化为2进制即0b1000&amp;gt;&amp;gt;3，为2进制0b0001；&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;lt;&amp;lt;&lt;/td&gt;
&lt;td&gt;左移位，可以用来屏蔽高们，或进行2的倍数计算，如1&amp;lt;&amp;lt;3 == 8，计算过程：转化为2进制即0b0001&amp;lt;&amp;lt;3，为2进制0b1000;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&gt;&amp;gt;&amp;gt;&lt;/td&gt;
&lt;td&gt;右移位，用0填充高位，与&amp;gt;&amp;gt;的区别在于：&amp;gt;&amp;gt;用符号位填充高位；没有&amp;lt;&amp;lt;&amp;lt;运算符。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;注意：对移位运算符右侧的参数需要进行模32的运算（如果左侧的操作数是long类型，则需要模64。）&lt;/p&gt;
&lt;h2 id=&quot;数学函数&quot;&gt;&lt;a href=&quot;#数学函数&quot; class=&quot;headerlink&quot; title=&quot;数学函数&quot;&gt;&lt;/a&gt;数学函数&lt;/h2&gt;&lt;p&gt;Math类中包含了各种各样的数学函数，所有的方法都使用计算机浮点单元中的例程。如果得到一个完全可预测的结果比运行速度更重要的话，需要使用&lt;code&gt;StrictMath&lt;/code&gt;类，它使用“自由发布的Math库”(fdlibm)实现算法，以确保所有平台上得到相同的结果。&lt;/p&gt;
&lt;h2 id=&quot;数值类型间的转换&quot;&gt;&lt;a href=&quot;#数值类型间的转换&quot; class=&quot;headerlink&quot; title=&quot;数值类型间的转换&quot;&gt;&lt;/a&gt;数值类型间的转换&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;conversion.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;当数值进行运算时，需要先将两个操作数转换为同一种类型，遵循如下原则：&lt;br&gt;如果存在double，则转换成double；&lt;br&gt;否则，如果存在float，则转换成float；&lt;br&gt;否则，如果存在long，则转换成long；&lt;br&gt;否则，都转换成int；&lt;/p&gt;
&lt;h2 id=&quot;强制类型转换&quot;&gt;&lt;a href=&quot;#强制类型转换&quot; class=&quot;headerlink&quot; title=&quot;强制类型转换&quot;&gt;&lt;/a&gt;强制类型转换&lt;/h2&gt;&lt;p&gt;如：double d = 1.234; int i = (int)d; i的值为1；强制类型转换通过截断小数部分将浮点值转换为整型。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意：如果将一个数值强制转换成另一个类型，而又超出了目标类型的表示范围，结果会截断成一个完全不同的值。如：(byte)300 == 44。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;括号与运算符级别&quot;&gt;&lt;a href=&quot;#括号与运算符级别&quot; class=&quot;headerlink&quot; title=&quot;括号与运算符级别&quot;&gt;&lt;/a&gt;括号与运算符级别&lt;/h2&gt;&lt;p&gt;括号优先，无括号的按照优先级次序进行计算。同一个级别的运算符按照从左到右的次序进行计算（右结合运算符按照从右到左进行计算。）。&lt;/p&gt;
&lt;h2 id=&quot;枚举型&quot;&gt;&lt;a href=&quot;#枚举型&quot; class=&quot;headerlink&quot; title=&quot;枚举型&quot;&gt;&lt;/a&gt;枚举型&lt;/h2&gt;&lt;p&gt;变量的取值只在一个有限的集合内，如enum Size {SMALL, MEDIUM, LARGE, EXTRA_LARGE};&lt;/p&gt;
&lt;h1 id=&quot;字符串&quot;&gt;&lt;a href=&quot;#字符串&quot; class=&quot;headerlink&quot; title=&quot;字符串&quot;&gt;&lt;/a&gt;字符串&lt;/h1&gt;&lt;p&gt;Java字符串就是Unicode的字符序列。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;赋值：String string = “string”;&lt;/li&gt;
&lt;li&gt;子串：String subStr = string.substring(0,3);从0开始，截取长度为3的字符串；&lt;/li&gt;
&lt;li&gt;拼接：使用+号将两个字符串拼接；&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;==判断两个String对象是否放在同一个位置上。
equals判断两个String对象的值是否相等。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;“”与null是不相同的概念，null表示空对象，””表示字符串为空值。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意，尽量不使用char型，原因是：在使用辅助字符时，由于辅助字符会占用两个代码单元，所以会导致charAt()方法得不到想要的结果。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;深入理解&quot;&gt;&lt;a href=&quot;#深入理解&quot; class=&quot;headerlink&quot; title=&quot;深入理解&quot;&gt;&lt;/a&gt;深入理解&lt;/h2&gt;&lt;p&gt;&lt;code&gt;对String对象的任何改变都会生成新的对象。&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;String &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;str1 &lt;/span&gt;= &lt;span class=&quot;string&quot;&gt;&quot;string&quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;String &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;str2 &lt;/span&gt;= &lt;span class=&quot;string&quot;&gt;&quot;string&quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;String &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;str3 &lt;/span&gt;= new &lt;span class=&quot;keyword&quot;&gt;String(&quot;string&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;String &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;str4 &lt;/span&gt;= new &lt;span class=&quot;keyword&quot;&gt;String(&quot;string&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;System.out.println&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;str1 &lt;/span&gt;== &lt;span class=&quot;keyword&quot;&gt;str2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;System.out.println&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;str2 &lt;/span&gt;== &lt;span class=&quot;keyword&quot;&gt;str3);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;System.out.println&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;str3 &lt;/span&gt;== &lt;span class=&quot;keyword&quot;&gt;str4);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上代码的输出结果是：&lt;br&gt;true&lt;br&gt;false&lt;br&gt;false&lt;/p&gt;
&lt;p&gt;这是因为JVM引擎会先在运行时常量池查找是否存在相同的字面常量，如果存在，则直接指向已经存在的字面常量；否则，开辟一个空间来存储该字面常量，并指向该指面常量。所以str1 == str2返回为true。&lt;br&gt;而使用new关键字来创建的对象都是在堆区进行的，不会去检测对象是否已经存在。因此，通过new创建的对象，一定是不相同的。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;String、StringBuilder、StringBuffer都是final类，这意味着它们不能被继承，也它们的所有方法都是final方法，即方法不能被覆盖。在需要进行大量的字符串拼接操作时，使用StringBuilder与StringBuffer的效率比String类要高，StringBuilder类非线程安全，StringBuffer类线程安全。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;直接使用String类进行拼接：&lt;br&gt;&lt;figure class=&quot;highlight axapta&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;StringStudy&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; main(String args[]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String &lt;span class=&quot;keyword&quot;&gt;str&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&quot;str&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;str&lt;/span&gt; += &lt;span class=&quot;string&quot;&gt;&quot;ing&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;StringBuilder与StringBuffer都继承自AbstractStringBuilder，拼接操作都调用的是AbstractStringBuilder类中的append方法，所以这里只使用StringBuilder来与String进行比较：&lt;br&gt;&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;StringBuilderStudy&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;String args[]&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        StringBuilder sb = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StringBuilder(&lt;span class=&quot;string&quot;&gt;&quot;str&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sb.append(&lt;span class=&quot;string&quot;&gt;&quot;ing&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;使用javap -c查看两段代码的字节码分别如下：&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Compiled from &lt;span class=&quot;string&quot;&gt;&quot;StringStudy.java&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; org.jackalope.study.lang.StringStudy &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; org.jackalope.study.lang.StringStudy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Code:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;: aload_0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;: invokespecial &lt;span class=&quot;meta&quot;&gt;#1                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/Object.&quot;&amp;lt;init&amp;gt;&quot;:()V&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; main(java.lang.&lt;span class=&quot;keyword&quot;&gt;String&lt;/span&gt;[]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Code:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;: ldc           &lt;span class=&quot;meta&quot;&gt;#2                  &lt;span class=&quot;comment&quot;&gt;// String str&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;: astore_1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;: new           &lt;span class=&quot;meta&quot;&gt;#3                  &lt;span class=&quot;comment&quot;&gt;// class java/lang/StringBuilder&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;: dup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;: invokespecial &lt;span class=&quot;meta&quot;&gt;#4                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/StringBuilder.&quot;&amp;lt;init&amp;gt;&quot;:()V&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;: aload_1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;: invokevirtual &lt;span class=&quot;meta&quot;&gt;#5                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;: ldc           &lt;span class=&quot;meta&quot;&gt;#6                  &lt;span class=&quot;comment&quot;&gt;// String ing&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;: invokevirtual &lt;span class=&quot;meta&quot;&gt;#5                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;: invokevirtual &lt;span class=&quot;meta&quot;&gt;#7                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/StringBuilder.toString:()Ljava/lang/String;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;: astore_1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Compiled from &lt;span class=&quot;string&quot;&gt;&quot;StringBuilderStudy.java&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; org.jackalope.study.lang.StringBuilderStudy &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; org.jackalope.study.lang.StringBuilderStudy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Code:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;: aload_0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;: invokespecial &lt;span class=&quot;meta&quot;&gt;#1                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/Object.&quot;&amp;lt;init&amp;gt;&quot;:()V&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; main(java.lang.&lt;span class=&quot;keyword&quot;&gt;String&lt;/span&gt;[]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Code:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;: new           &lt;span class=&quot;meta&quot;&gt;#2                  &lt;span class=&quot;comment&quot;&gt;// class java/lang/StringBuilder&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;: dup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;: ldc           &lt;span class=&quot;meta&quot;&gt;#3                  &lt;span class=&quot;comment&quot;&gt;// String str&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;: invokespecial &lt;span class=&quot;meta&quot;&gt;#4                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/StringBuilder.&quot;&amp;lt;init&amp;gt;&quot;:(Ljava/lang/String;)V&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;: astore_1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;: aload_1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;: ldc           &lt;span class=&quot;meta&quot;&gt;#5                  &lt;span class=&quot;comment&quot;&gt;// String ing&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;: invokevirtual &lt;span class=&quot;meta&quot;&gt;#6                  &lt;span class=&quot;comment&quot;&gt;// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;: pop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;number&quot;&gt;17&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看出，String的拼接操作是创建一个StringBuilder对象，并调用append方法来实现的，所以效率上一定比不上直接使用StringBuilder。&lt;/p&gt;
&lt;h1 id=&quot;输入输出&quot;&gt;&lt;a href=&quot;#输入输出&quot; class=&quot;headerlink&quot; title=&quot;输入输出&quot;&gt;&lt;/a&gt;输入输出&lt;/h1&gt;&lt;p&gt;简单介绍一下，详情请见&lt;a href=&quot;java-core-io&quot;&gt;Java总结 - IO&lt;/a&gt;与&lt;a href=&quot;java-core-nio&quot;&gt;Java总结 - NIO&lt;/a&gt;&lt;br&gt;System.in输入流&lt;br&gt;System.out输出流&lt;br&gt;Java 6引入了Console类实现从控制台读取密码，用法如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Console console = System.console();
String username = console.readLine(&amp;quot;User name:&amp;quot;);
char[] passwd = console.readPassword(&amp;quot;Password:&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;格式化输出&quot;&gt;&lt;a href=&quot;#格式化输出&quot; class=&quot;headerlink&quot; title=&quot;格式化输出&quot;&gt;&lt;/a&gt;格式化输出&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;转称符&lt;/th&gt;
&lt;th&gt;类型&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;%d&lt;/td&gt;
&lt;td&gt;十进制整数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%x&lt;/td&gt;
&lt;td&gt;十六进制整数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%o&lt;/td&gt;
&lt;td&gt;八进制整数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%f&lt;/td&gt;
&lt;td&gt;定点浮点数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%e&lt;/td&gt;
&lt;td&gt;指数浮点数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%g&lt;/td&gt;
&lt;td&gt;通用浮点数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%a&lt;/td&gt;
&lt;td&gt;十六进制浮点数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%s&lt;/td&gt;
&lt;td&gt;字符串&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%c&lt;/td&gt;
&lt;td&gt;字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%b&lt;/td&gt;
&lt;td&gt;布尔型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%h&lt;/td&gt;
&lt;td&gt;散列码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%tx&lt;/td&gt;
&lt;td&gt;日期时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%%&lt;/td&gt;
&lt;td&gt;百分号&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%n&lt;/td&gt;
&lt;td&gt;行分隔符&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&quot;控制流程&quot;&gt;&lt;a href=&quot;#控制流程&quot; class=&quot;headerlink&quot; title=&quot;控制流程&quot;&gt;&lt;/a&gt;控制流程&lt;/h1&gt;&lt;h2 id=&quot;块作用域&quot;&gt;&lt;a href=&quot;#块作用域&quot; class=&quot;headerlink&quot; title=&quot;块作用域&quot;&gt;&lt;/a&gt;块作用域&lt;/h2&gt;&lt;p&gt;以一对花括号{}括起来的若干条Java语句称为块，一个块可以嵌套在另一个块中，不能在嵌套的两个块中声明同名的变量。&lt;/p&gt;
&lt;h2 id=&quot;条件语句&quot;&gt;&lt;a href=&quot;#条件语句&quot; class=&quot;headerlink&quot; title=&quot;条件语句&quot;&gt;&lt;/a&gt;条件语句&lt;/h2&gt;&lt;p&gt;格式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;if(condition) statement&lt;/li&gt;
&lt;li&gt;if(condition) statement1 else statement2&lt;/li&gt;
&lt;li&gt;if(condition1) statement1 else if(condition2) statement2 else statement3&lt;/li&gt;
&lt;li&gt;switch    //多重选择&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;循环语句&quot;&gt;&lt;a href=&quot;#循环语句&quot; class=&quot;headerlink&quot; title=&quot;循环语句&quot;&gt;&lt;/a&gt;循环语句&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;while(condition) statement&lt;/li&gt;
&lt;li&gt;do statement while(condition) // 先执行一次再判断条件进行循环&lt;/li&gt;
&lt;li&gt;for(define; condition; statement) statement&lt;/li&gt;
&lt;li&gt;for(variable : collection) statement // for each&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;中断控制流程语句&quot;&gt;&lt;a href=&quot;#中断控制流程语句&quot; class=&quot;headerlink&quot; title=&quot;中断控制流程语句&quot;&gt;&lt;/a&gt;中断控制流程语句&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;break：跳出并退出循环&lt;/li&gt;
&lt;li&gt;带标签的break：用于跳出多重嵌套的循环，标签必须放在希望跳出的最外层循环之前，并且必须紧跟一个冒号，如下：&lt;br&gt;label:&lt;br&gt;while(…){&lt;br&gt;…&lt;br&gt;whille(…){&lt;br&gt;…&lt;br&gt;break label;&lt;br&gt;}&lt;br&gt;}&lt;/li&gt;
&lt;li&gt;continue : 跳出并继续循环&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;大数值&quot;&gt;&lt;a href=&quot;#大数值&quot; class=&quot;headerlink&quot; title=&quot;大数值&quot;&gt;&lt;/a&gt;大数值&lt;/h1&gt;&lt;p&gt;BigInteger和BigDecimal可以处理包含任意长度数字序列的数值。BigInteger实现了任意精度的整数运算，BigDecimal实现了任意精度的浮点数运算。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;方法&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;add&lt;/td&gt;
&lt;td&gt;加&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;subtract&lt;/td&gt;
&lt;td&gt;减&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;multiply&lt;/td&gt;
&lt;td&gt;乘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;divide&lt;/td&gt;
&lt;td&gt;除&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mod&lt;/td&gt;
&lt;td&gt;取模&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&quot;数组&quot;&gt;&lt;a href=&quot;#数组&quot; class=&quot;headerlink&quot; title=&quot;数组&quot;&gt;&lt;/a&gt;数组&lt;/h1&gt;&lt;p&gt;数组是一种数据结构，用来存储同一类型值的集合。通过一个整形下标可以访问数组中的每一个值，数组下标从0开始。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;声明数组：int[] a;&lt;/li&gt;
&lt;li&gt;定义数组：int[] a = new int[100];所有元素初始化为0；&lt;br&gt;String[] sa = new String[100];所有元素初始化为null；&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一旦创建了数组，就不能再改变它的大小 ，如果需要在运行过程中扩展数组的大小，就应该使用另一种数据结构 —— array list。&lt;/p&gt;
&lt;h2 id=&quot;Arrays类&quot;&gt;&lt;a href=&quot;#Arrays类&quot; class=&quot;headerlink&quot; title=&quot;Arrays类&quot;&gt;&lt;/a&gt;Arrays类&lt;/h2&gt;&lt;p&gt;Arrays类是JDK提供的一个工具类，方便对数组进行操作（比如排序和搜索），还包含一个允许将数组作为列表来查看的静态工厂。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;asList(T… a):返回一个受指定数组支持的固定大小的列表。&lt;/li&gt;
&lt;li&gt;binarySearch:一系列查找的方法，以byte型为例(其他类型类推)；&lt;br&gt;binarySearch(byte[] a, byte key):使用二分搜索法来搜索指定的 byte 型数组，以获得指定的值。&lt;br&gt;binarySearch(byte[] a, int fromIndex, int toIndex, byte key):使用二分搜索法来搜索指定的 byte 型数组的范围，以获得指定的值。&lt;br&gt;copyOf:一系列拷贝的方法，以byte型为例(其他类型类推)；&lt;br&gt;copyOf(byte[] original, int newLength):复制指定的数组，截取或用 0 填充（如有必要），以使副本具有指定的长度。&lt;/li&gt;
&lt;li&gt;copyOfRange:一系列指定范围的拷贝方法，以byte型为例(其他类型类推)；&lt;br&gt;copyOfRange(byte[] original, int from, int to):将指定数组的指定范围复制到一个新数组。&lt;/li&gt;
&lt;li&gt;deepEquals(Object[] a1, Object[] a2) :如果两个指定数组彼此是深层相等的，则返回true。&lt;/li&gt;
&lt;li&gt;deepHashCode(Object[] a) :基于指定数组的“深层内容”返回哈希码。&lt;/li&gt;
&lt;li&gt;deepToString(Object[] a) :返回指定数组“深层内容”的字符串表示形式。&lt;/li&gt;
&lt;li&gt;equals:一系列判断数组是否相等的方法，以byte型为例（其他类型类推）；&lt;br&gt;equals(byte[] a, byte[] a2):如果两个指定的 byte 型数组彼此相等，则返回 true。&lt;/li&gt;
&lt;li&gt;fill:一系列填充数组的方法，以byte型为例（其他类型类推）；&lt;br&gt;fill(byte[] a, byte val):将指定的 byte 值分配给指定 byte 节型数组的每个元素。&lt;br&gt;fill(byte[] a, int fromIndex, int toIndex, byte val):将指定的 byte 值分配给指定 byte 型数组指定范围中的每个元素。&lt;/li&gt;
&lt;li&gt;hashCode:一系列返回指定数组哈希码的方法，以byte型为例（其他类型类推）;hashCode(byte[] a) &lt;/li&gt;
&lt;li&gt;sort:一系列对指定数组排序的方法，以byte型为例（其他类型类推）;&lt;br&gt;sort(byte[] a):对指定的 byte 型数组按数字升序进行排序。&lt;br&gt;sort(byte[] a, int fromIndex, int toIndex):对指定 byte 型数组的指定范围按数字升序进行排序。&lt;/li&gt;
&lt;li&gt;toString:一系列得到指定数组内容的字符串表示形式的方法，以byte型为例（其他类型类推）;toString(byte[] a) 。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;多维数组&quot;&gt;&lt;a href=&quot;#多维数组&quot; class=&quot;headerlink&quot; title=&quot;多维数组&quot;&gt;&lt;/a&gt;多维数组&lt;/h2&gt;&lt;p&gt;即数组的数组，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight xquery&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int[][] a = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;span class=&quot;number&quot;&gt;31&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;33&lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;本文主要介绍一些Java中的基本概念，包括数据类型、变量、运算符、字符串、输入输出、控制流程、大数值、数组。&lt;/p&gt;
&lt;h1 id=&quot;数据类型&quot;&gt;&lt;a href=&quot;#数据类型&quot; class=&quot;headerlink&quot; title=&quot;数据类型&quot;&gt;&lt;/a&gt;数据类型&lt;/h1&gt;&lt;p&gt;
    
    </summary>
    
      <category term="Java总结" scheme="http://jackalope.cn/categories/Java%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Java" scheme="http://jackalope.cn/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>集合总结</title>
    <link href="http://jackalope.cn/2016/04/19/java-core-collections/"/>
    <id>http://jackalope.cn/2016/04/19/java-core-collections/</id>
    <published>2016-04-19T07:50:37.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html">&lt;p&gt;在实现方法时，选择不同的数据结构会导致其实现风格以及性能存存着很大差异，JDK帮我们实现了传统的数据结构，我们称之为collection(集合)。&lt;br&gt;collection（集合）表示一组对象，这些对象也称为collection的元素。一些collection允许有重复的元素，而另一些而不允许。一些collection是有序的，而另一些则是无序的。&lt;/p&gt;
&lt;h1 id=&quot;接口&quot;&gt;&lt;a href=&quot;#接口&quot; class=&quot;headerlink&quot; title=&quot;接口&quot;&gt;&lt;/a&gt;接口&lt;/h1&gt;&lt;h2 id=&quot;Collection接口&quot;&gt;&lt;a href=&quot;#Collection接口&quot; class=&quot;headerlink&quot; title=&quot;Collection接口&quot;&gt;&lt;/a&gt;Collection接口&lt;/h2&gt;&lt;p&gt;Collection接口是Java集合的根接口，JDK不提供此接口的任何直接实现：它提供更具体的子接口（如Set和List）实现。&lt;br&gt;Collection接口扩展了Iterable接口，因此，对于标准类库中的任何集合都可以使用”for each”循环。&lt;/p&gt;
&lt;h2 id=&quot;Iterator接口&quot;&gt;&lt;a href=&quot;#Iterator接口&quot; class=&quot;headerlink&quot; title=&quot;Iterator接口&quot;&gt;&lt;/a&gt;Iterator接口&lt;/h2&gt;&lt;p&gt;Iterator接口包含如下方法：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Iterator&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;E&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;hasNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;E &lt;span class=&quot;title&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; UnsupportedOperationException(&lt;span class=&quot;string&quot;&gt;&quot;remove&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;forEachRemaining&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Consumer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; E&amp;gt; action)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Objects.requireNonNull(action);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (hasNext())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            action.accept(next());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;通过反复调用next()方法，可以逐个访问集合中的每个元素，但是如果到了集合的末尾，next()方法将抛出一个NoSuchElementException。因为在调用next之前需要调用hasNext()方法。&lt;/li&gt;
&lt;li&gt;元素被访问的顺序取决于集合类型。如果对ArrayList进行迭代，迭代器将从索引0开始，每迭代一次，索引值加1。然而如果访问HashSet中的元素，每个元素会按照某种随机的次序出现。虽然可以确定在迭代过程中能够遍历到集合中的所有元素，但却无法预知元素被访问的次序。&lt;/li&gt;
&lt;li&gt;remove()方法将删除上次调用next()方法时返回的值。如果调用remove()之前没有调用next()将会抛出IllegalStateException异常。如果想删除相邻的两个元素，不能直接这样调用：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;it&lt;span class=&quot;selector-class&quot;&gt;.remove&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;it&lt;span class=&quot;selector-class&quot;&gt;.remove&lt;/span&gt;(); &lt;span class=&quot;comment&quot;&gt;// Error!&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;而应该是：&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;it&lt;span class=&quot;selector-class&quot;&gt;.remove&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;it&lt;span class=&quot;selector-class&quot;&gt;.next&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;it&lt;span class=&quot;selector-class&quot;&gt;.remove&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;具体的集合&quot;&gt;&lt;a href=&quot;#具体的集合&quot; class=&quot;headerlink&quot; title=&quot;具体的集合&quot;&gt;&lt;/a&gt;具体的集合&lt;/h1&gt;&lt;p&gt;Java库中的具体集合如下表所示：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;集合类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ArrayList&lt;/td&gt;
&lt;td&gt;一种可以动态增长和缩减的索引序列&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LinkedList&lt;/td&gt;
&lt;td&gt;一种可以在任何位置进行高效地插入和删除操作的有序序列&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ArrayDeque&lt;/td&gt;
&lt;td&gt;一种用循环数组实现的双端队列&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HashSet&lt;/td&gt;
&lt;td&gt;一种没有重复元素的无序集合&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TreeSet&lt;/td&gt;
&lt;td&gt;一种有序集&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EnumSet&lt;/td&gt;
&lt;td&gt;一种包含枚举类型的集合&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LinkedHashSet&lt;/td&gt;
&lt;td&gt;一种可以记住元素插入次序的集合&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PriorityQueue&lt;/td&gt;
&lt;td&gt;一种允许高效删除最小元素的集合&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HashMap&lt;/td&gt;
&lt;td&gt;一种存储键/值关联的数据结构&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TreeMap&lt;/td&gt;
&lt;td&gt;一种键值有序排队的映射表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EnumMap&lt;/td&gt;
&lt;td&gt;一种键值属于枚举类型的映射表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LinkedHashMap&lt;/td&gt;
&lt;td&gt;一种可以记住键/值项添加次序的映射表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WeakHashMap&lt;/td&gt;
&lt;td&gt;一种其值无用武之地后可以被垃圾回收的映射表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IdentityHashMap&lt;/td&gt;
&lt;td&gt;一种用==而不是用equals比较键值的映射表&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&quot;数组列表&quot;&gt;&lt;a href=&quot;#数组列表&quot; class=&quot;headerlink&quot; title=&quot;数组列表&quot;&gt;&lt;/a&gt;数组列表&lt;/h2&gt;&lt;p&gt;ArrayList封装了一个动态再分配的对象数组。主要适用于查询多、修改少的场景。&lt;br&gt;ArrayList不是线程安全的，只能用在单线程环境下，多线程环境下可以使用如下几种办法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Collections.synchronizedList(List l);&lt;/li&gt;
&lt;li&gt;使用concurrent包下的CopyOnWriteArrayList类；&lt;/li&gt;
&lt;li&gt;使用Vector类；&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ArrayList实现了List接口、底层使用数组保存所有元素，其操作基本上是对数组的操作。&lt;br&gt;ensureCapacity()方法在容量不够时，默认增加50%+1，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; newCapacity = (oldCapacity * &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)/&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;与之相比，Vector默认是增加一倍。&lt;/p&gt;
&lt;h2 id=&quot;链表&quot;&gt;&lt;a href=&quot;#链表&quot; class=&quot;headerlink&quot; title=&quot;链表&quot;&gt;&lt;/a&gt;链表&lt;/h2&gt;&lt;p&gt;LinkedList适用于查询少、修改多的场景。&lt;br&gt;在Java中，所有的链表都是双向链表，即每个结点都保存了它的前驱与后继，从中插入或删除一个元素非常容易，只需要更新附近元素的前驱与后继即可。&lt;br&gt;链表是一个有序集合，每个对象的位置十分重要。&lt;/p&gt;
&lt;h2 id=&quot;散列集&quot;&gt;&lt;a href=&quot;#散列集&quot; class=&quot;headerlink&quot; title=&quot;散列集&quot;&gt;&lt;/a&gt;散列集&lt;/h2&gt;&lt;h3 id=&quot;HashSet&quot;&gt;&lt;a href=&quot;#HashSet&quot; class=&quot;headerlink&quot; title=&quot;HashSet&quot;&gt;&lt;/a&gt;HashSet&lt;/h3&gt;&lt;h3 id=&quot;HashMap&quot;&gt;&lt;a href=&quot;#HashMap&quot; class=&quot;headerlink&quot; title=&quot;HashMap&quot;&gt;&lt;/a&gt;HashMap&lt;/h3&gt;&lt;p&gt;HashMap可以快速地查找所需要的对象。HashMap为每个对象计算一个整数，即hash code，如果是自定义类，就要负责实现这个类的hashCode方法。&lt;/p&gt;
&lt;h2 id=&quot;树集&quot;&gt;&lt;a href=&quot;#树集&quot; class=&quot;headerlink&quot; title=&quot;树集&quot;&gt;&lt;/a&gt;树集&lt;/h2&gt;&lt;h2 id=&quot;映射表&quot;&gt;&lt;a href=&quot;#映射表&quot; class=&quot;headerlink&quot; title=&quot;映射表&quot;&gt;&lt;/a&gt;映射表&lt;/h2&gt;&lt;p&gt;### &lt;/p&gt;
&lt;h2 id=&quot;队列&quot;&gt;&lt;a href=&quot;#队列&quot; class=&quot;headerlink&quot; title=&quot;队列&quot;&gt;&lt;/a&gt;队列&lt;/h2&gt;&lt;h3 id=&quot;双端队列&quot;&gt;&lt;a href=&quot;#双端队列&quot; class=&quot;headerlink&quot; title=&quot;双端队列&quot;&gt;&lt;/a&gt;双端队列&lt;/h3&gt;&lt;h3 id=&quot;优先级队列&quot;&gt;&lt;a href=&quot;#优先级队列&quot; class=&quot;headerlink&quot; title=&quot;优先级队列&quot;&gt;&lt;/a&gt;优先级队列&lt;/h3&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;在实现方法时，选择不同的数据结构会导致其实现风格以及性能存存着很大差异，JDK帮我们实现了传统的数据结构，我们称之为collection(集合)。&lt;br&gt;collection（集合）表示一组对象，这些对象也称为collection的元素。一些collection允许有重复的
    
    </summary>
    
      <category term="Java基础" scheme="http://jackalope.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="Java" scheme="http://jackalope.cn/tags/Java/"/>
    
      <category term="集合" scheme="http://jackalope.cn/tags/%E9%9B%86%E5%90%88/"/>
    
  </entry>
  
  <entry>
    <title>NIO总结</title>
    <link href="http://jackalope.cn/2016/04/19/java-core-nio/"/>
    <id>http://jackalope.cn/2016/04/19/java-core-nio/</id>
    <published>2016-04-19T07:48:43.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html"></content>
    
    <summary type="html">
    
    </summary>
    
      <category term="Java基础" scheme="http://jackalope.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="Java" scheme="http://jackalope.cn/tags/Java/"/>
    
      <category term="nio" scheme="http://jackalope.cn/tags/nio/"/>
    
  </entry>
  
  <entry>
    <title>IO总结</title>
    <link href="http://jackalope.cn/2016/04/19/java-core-io/"/>
    <id>http://jackalope.cn/2016/04/19/java-core-io/</id>
    <published>2016-04-19T07:48:35.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html"></content>
    
    <summary type="html">
    
    </summary>
    
      <category term="Java基础" scheme="http://jackalope.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="Java" scheme="http://jackalope.cn/tags/Java/"/>
    
      <category term="io" scheme="http://jackalope.cn/tags/io/"/>
    
  </entry>
  
  <entry>
    <title>多线程总结</title>
    <link href="http://jackalope.cn/2016/04/19/java-core-thread/"/>
    <id>http://jackalope.cn/2016/04/19/java-core-thread/</id>
    <published>2016-04-19T07:48:26.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html">&lt;p&gt;线程是程序执行流的最小单元，多线程程序在较低层次上扩展了多任务的概念：一个程序同时执行多个任务。通常每一个任务称为一个线程(thread)，它是线程控制的简称。可以同时运行一个以上线程的程序称为多线程程序(multithreaded)。&lt;/p&gt;
&lt;h1 id=&quot;线程的状态&quot;&gt;&lt;a href=&quot;#线程的状态&quot; class=&quot;headerlink&quot; title=&quot;线程的状态&quot;&gt;&lt;/a&gt;线程的状态&lt;/h1&gt;&lt;p&gt;Java的线程如下有6种状态：&lt;br&gt;NEW（新建）&lt;br&gt;RUNNABLE（就绪，可运行）&lt;br&gt;BLOCKED（被阻塞）&lt;br&gt;WAITING（等待）&lt;br&gt;TIMED_WAITING（计时等待）&lt;br&gt;TERMINATED（被终止）&lt;/p&gt;
&lt;p&gt;可以使用Thread.getState()方法获取线程的当前状态。在Thread类中线程状态由一个整型变量threadStatus表示，getState()方法调用VM类的toThreadState()方法，根据threadStatus某个位置上是否为1来判断线程状态，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight erlang-repl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(var0 &amp;amp; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;?State.RUNNABLE:((var0 &amp;amp; &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;?State.BLOCKED:((var0 &amp;amp; &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;?State.WAITING:((var0 &amp;amp; &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;?State.TIMED_WAITING:((var0 &amp;amp; &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;?State.TERMINATED:((var0 &amp;amp; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;?State.NEW:State.RUNNABLE)))));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;NEW&quot;&gt;&lt;a href=&quot;#NEW&quot; class=&quot;headerlink&quot; title=&quot;NEW&quot;&gt;&lt;/a&gt;NEW&lt;/h2&gt;&lt;p&gt;当用new操作符创建一个新线程时，如new Thread()，该线程还没有运行，此时线程状态是NEW。&lt;/p&gt;
&lt;h2 id=&quot;RUNNABLE&quot;&gt;&lt;a href=&quot;#RUNNABLE&quot; class=&quot;headerlink&quot; title=&quot;RUNNABLE&quot;&gt;&lt;/a&gt;RUNNABLE&lt;/h2&gt;&lt;p&gt;一旦调用start()方法，线程处于RUNNABLE状态。&lt;br&gt;&lt;code&gt;一个RUNNABLE状态的线程可能正在运行也可能没有运行，这取决于操作系统给线程提供运行的时间&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;BLOCKED&quot;&gt;&lt;a href=&quot;#BLOCKED&quot; class=&quot;headerlink&quot; title=&quot;BLOCKED&quot;&gt;&lt;/a&gt;BLOCKED&lt;/h2&gt;&lt;p&gt;当一个线程试图获取一个内部对象锁，而该锁被其他线程持有，则该线程进入BLOCKED状态。&lt;/p&gt;
&lt;h2 id=&quot;WAITING&quot;&gt;&lt;a href=&quot;#WAITING&quot; class=&quot;headerlink&quot; title=&quot;WAITING&quot;&gt;&lt;/a&gt;WAITING&lt;/h2&gt;&lt;p&gt;当一个线程等待另一个线程通知调度器一个条件时，进入WAITING状态，如调用：Object.wait(), Thread.join(), Lock.lock(), Condition.await()时。&lt;/p&gt;
&lt;h2 id=&quot;TIMED-WAITING&quot;&gt;&lt;a href=&quot;#TIMED-WAITING&quot; class=&quot;headerlink&quot; title=&quot;TIMED_WAITING&quot;&gt;&lt;/a&gt;TIMED_WAITING&lt;/h2&gt;&lt;p&gt;有几个方法有超时参数，调用它们将导致线程进入TIMED_WAITING状态，如调用：Thread.sleep(long millis), Object.wait(long timeout), Lock.tryLock(), Condition.await(long time, TimeUnit unit)时。&lt;/p&gt;
&lt;h2 id=&quot;TERMINATED&quot;&gt;&lt;a href=&quot;#TERMINATED&quot; class=&quot;headerlink&quot; title=&quot;TERMINATED&quot;&gt;&lt;/a&gt;TERMINATED&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;因为run方法正常退出而自然终止。&lt;/li&gt;
&lt;li&gt;因为一个没有捕获的异常而终止。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;stop()、suspend()、resume()已过时，不要使用。&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;线程属性&quot;&gt;&lt;a href=&quot;#线程属性&quot; class=&quot;headerlink&quot; title=&quot;线程属性&quot;&gt;&lt;/a&gt;线程属性&lt;/h1&gt;&lt;p&gt;线程属性包括：线程优先级、守护线程、线程组以及处理未捕获异常的处理器。&lt;/p&gt;
&lt;h2 id=&quot;线程优先级&quot;&gt;&lt;a href=&quot;#线程优先级&quot; class=&quot;headerlink&quot; title=&quot;线程优先级&quot;&gt;&lt;/a&gt;线程优先级&lt;/h2&gt;&lt;p&gt;在Java中每一个线程都有一个优先级，使用setPriority()方法可以设置线程的优先级，可以将优先级置为在MIN_PRIORITY(在Thread类中定义为0)和MAX_PRIORITY（在Thread类中定义为10）之间的任何值。NORM_PRIORITY被定义为5。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意：线程优先级高度依赖于系统，Windows有7个优先级，Sun为Linux提供的Java虚拟机，线程的优先级被忽略——所有的线程具有相同的优先级。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;守护线程&quot;&gt;&lt;a href=&quot;#守护线程&quot; class=&quot;headerlink&quot; title=&quot;守护线程&quot;&gt;&lt;/a&gt;守护线程&lt;/h2&gt;&lt;p&gt;通过调用方法setDaemon(true)来将线程设置为守护线程，守护线程的唯一作用是为其他线程提供服务。当只剩下守护线程时，虚拟机就退出了，所以守护线程中永远不应该去访问固有资源，如文件、数据库，因为它会在任何时候甚至在一个操作的中间发生中断。&lt;/p&gt;
&lt;h2 id=&quot;未捕获异常处理器&quot;&gt;&lt;a href=&quot;#未捕获异常处理器&quot; class=&quot;headerlink&quot; title=&quot;未捕获异常处理器&quot;&gt;&lt;/a&gt;未捕获异常处理器&lt;/h2&gt;&lt;p&gt;该处理器必须实现Thead.UncaughtExceptionHandler接口，该接口只有一个方法：void uncaughtException(Thread t, Throwable e)。&lt;br&gt;使用setUncaughtExceptionHandler()方法为线程安装一个处理器，也可以使用静态方法Thread.setUncaughtExceptionHandler()为所有线程安装一个默认的处理器。&lt;/p&gt;
&lt;h1 id=&quot;线程的创建&quot;&gt;&lt;a href=&quot;#线程的创建&quot; class=&quot;headerlink&quot; title=&quot;线程的创建&quot;&gt;&lt;/a&gt;线程的创建&lt;/h1&gt;&lt;p&gt;创建线程有三种方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;继承Thread类&lt;/li&gt;
&lt;li&gt;实现Runnable接口&lt;/li&gt;
&lt;li&gt;实现Callable接口&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;继承Thread类&quot;&gt;&lt;a href=&quot;#继承Thread类&quot; class=&quot;headerlink&quot; title=&quot;继承Thread类&quot;&gt;&lt;/a&gt;继承Thread类&lt;/h2&gt;&lt;p&gt;步骤如下&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;继承Thread类，重写run方法&lt;/li&gt;
&lt;li&gt;创建线程对象&lt;/li&gt;
&lt;li&gt;执行start方法&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ExtendsThread&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Thread.sleep(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String args[])&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ExtendsThread subThread1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ExtendsThread();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread1.setName(&lt;span class=&quot;string&quot;&gt;&quot;subThread1&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ExtendsThread subThread2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ExtendsThread();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread2.setName(&lt;span class=&quot;string&quot;&gt;&quot;subThread2&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread1.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread2.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输出结果(不固定)：&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;注意：不要调用Thread类或Runnable对象的run方法，直接调用run方法，只会执行同一个线程中的任务，而不会启动新线程。应该调用Thread.start方法，这个方法将创建一个执行run方法的新线程。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;实现Runnable接口&quot;&gt;&lt;a href=&quot;#实现Runnable接口&quot; class=&quot;headerlink&quot; title=&quot;实现Runnable接口&quot;&gt;&lt;/a&gt;实现Runnable接口&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;创建Runnable的实现类，重写run方法&lt;/li&gt;
&lt;li&gt;创建该Runnable实现类的对象，并以该对象为参数创建Thread实例&lt;/li&gt;
&lt;li&gt;执行start方法&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ImplRunnable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String args[])&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MyRunnable myRunnable = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MyRunnable();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Thread subThread1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(myRunnable, &lt;span class=&quot;string&quot;&gt;&quot;subThread1&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Thread subThread2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(myRunnable, &lt;span class=&quot;string&quot;&gt;&quot;subThread2&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread1.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread2.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyRunnable&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Runnable&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.out.println(Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Thread.sleep(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输出结果（不固定）：&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;subThread1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;实现Callable接口&quot;&gt;&lt;a href=&quot;#实现Callable接口&quot; class=&quot;headerlink&quot; title=&quot;实现Callable接口&quot;&gt;&lt;/a&gt;实现Callable接口&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;创建Callable的实现类，重写call()方法&lt;/li&gt;
&lt;li&gt;创建该Callable实现类的对象，并以该对象为参数创建FutureTask对象&lt;/li&gt;
&lt;li&gt;以该FutureTask对象为参数，创建Thread实例&lt;/li&gt;
&lt;li&gt;执行start方法，并可调用FutureTask对象的方法获取线程执行的状态及返回结果。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ImplCallable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; ExecutionException, InterruptedException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MyCallable myCallable1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MyCallable(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MyCallable myCallable2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MyCallable(&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        FutureTask&amp;lt;Integer&amp;gt; futureTask1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; FutureTask(myCallable1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        FutureTask&amp;lt;Integer&amp;gt; futureTask2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; FutureTask(myCallable2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Thread subThread1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(futureTask1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Thread subThread2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(futureTask2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread1.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subThread2.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(futureTask1.get());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(futureTask2.get());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyCallable&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Callable&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;Integer&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; num;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyCallable&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; num)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.num = num;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getNum&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; num;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setNum&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; num)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.num = num;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Integer &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; num; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.out.println(Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Thread.sleep(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; num;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输出结果（不固定）：&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;三种方式的比较&quot;&gt;&lt;a href=&quot;#三种方式的比较&quot; class=&quot;headerlink&quot; title=&quot;三种方式的比较&quot;&gt;&lt;/a&gt;三种方式的比较&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Java中没有多重继承，因此在使用继承Thread类的方式创建线程时，不能再继承其他类；使用Runnable、Callable接口创建多线程时，还可以继承其他类，在这种方式下，多个线程可以共享同一个target对象，所以非常适合多个相同线程来处理同一份资源的情况； &lt;/li&gt;
&lt;li&gt;使用Callable接口可以从线程中获取返回值。&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;线程同步&quot;&gt;&lt;a href=&quot;#线程同步&quot; class=&quot;headerlink&quot; title=&quot;线程同步&quot;&gt;&lt;/a&gt;线程同步&lt;/h1&gt;&lt;h2 id=&quot;synchronized关键字&quot;&gt;&lt;a href=&quot;#synchronized关键字&quot; class=&quot;headerlink&quot; title=&quot;synchronized关键字&quot;&gt;&lt;/a&gt;synchronized关键字&lt;/h2&gt;&lt;p&gt;从1.0版本开始，Java中的每一个对象都有一个内部锁，如果一个方法使用synchronized关键字声明，线程将获得对象的内部锁。&lt;br&gt;synchronized有两种方式：锁方法、锁对象。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;锁方法，即用synchronized关键字修饰方法：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight oxygene&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 获得的是对象的内部锁&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; synchronized void &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	method body&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight d&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 获得的是类锁，由于一个class不论被实例化多少次，其中的静态方法和静态变量在内存中都只由一份。所以，一旦一个静态的方法被申明为synchronized。此类所有的实例化对象在调用此方法，共用同一把锁。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	method &lt;span class=&quot;keyword&quot;&gt;body&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;锁对象：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight oxygene&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; void &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// 获得的是对象的内部锁&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	synchronized(this)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		code block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight oxygene&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Object obj = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Object();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; void &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// 获得的是obj的内部锁&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	synchronized(obj)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		code block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight oxygene&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; void &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// 获得的是类锁&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	synchronized(xxx.class)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		code block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight oxygene&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; void &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// 获得的是类锁&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	synchronized(Class.forName(&quot;xxx&quot;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		code block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Lock&quot;&gt;&lt;a href=&quot;#Lock&quot; class=&quot;headerlink&quot; title=&quot;Lock&quot;&gt;&lt;/a&gt;Lock&lt;/h2&gt;&lt;p&gt;Lock(锁对象)允许把锁的实现作为Java类，而不是作为语言的特性来实现，这就为Lock的多种实现留下了空间，各种实现可能有不同的调度算法、性能特性或者锁定语义。&lt;/p&gt;
&lt;h3 id=&quot;方法摘要&quot;&gt;&lt;a href=&quot;#方法摘要&quot; class=&quot;headerlink&quot; title=&quot;方法摘要&quot;&gt;&lt;/a&gt;方法摘要&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;返回值&lt;/th&gt;
&lt;th&gt;方法&lt;/th&gt;
&lt;th&gt;解释&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;void&lt;/td&gt;
&lt;td&gt;lock()&lt;/td&gt;
&lt;td&gt;获取锁。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;void&lt;/td&gt;
&lt;td&gt;lockInterruptibly()&lt;/td&gt;
&lt;td&gt;如果当前线程未被中断，则获取锁。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Condition&lt;/td&gt;
&lt;td&gt;newCondition()&lt;/td&gt;
&lt;td&gt;返回绑定到此 Lock 实例的新 Condition 实例。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;boolean&lt;/td&gt;
&lt;td&gt;tryLock()&lt;/td&gt;
&lt;td&gt;仅在调用时锁为空闲状态才获取该锁。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;boolean&lt;/td&gt;
&lt;td&gt;tryLock(long time, TimeUnit unit)&lt;/td&gt;
&lt;td&gt;如果锁在给定的等待时间内空闲，并且当前线程未被中断，则获取锁。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;void&lt;/td&gt;
&lt;td&gt;unlock()&lt;/td&gt;
&lt;td&gt;释放锁。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&quot;ReentrantLock&quot;&gt;&lt;a href=&quot;#ReentrantLock&quot; class=&quot;headerlink&quot; title=&quot;ReentrantLock&quot;&gt;&lt;/a&gt;ReentrantLock&lt;/h3&gt;&lt;p&gt;ReentrantLock类是Lock的一个实现，使用ReentrantLock的代码块结构如下：&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;myLock&lt;span class=&quot;selector-class&quot;&gt;.lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;try&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;selector-tag&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	myLock&lt;span class=&quot;selector-class&quot;&gt;.unlock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;ReentrantLock(true)可以构造一个带有公平策略的锁，听起来公平锁更合理一些，但是使用公平锁比使用常规锁要慢很多。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;ReadWriteLock&quot;&gt;&lt;a href=&quot;#ReadWriteLock&quot; class=&quot;headerlink&quot; title=&quot;ReadWriteLock&quot;&gt;&lt;/a&gt;ReadWriteLock&lt;/h2&gt;&lt;p&gt;ReadWriteLock 维护了一对相关的锁，一个用于只读操作，另一个用于写入操作。只要没有 writer，读取锁可以由多个 reader 线程同时保持。写入锁是独占的。&lt;br&gt;与互斥锁相比，读-写锁允许对共享数据进行更高级别的并发访问。虽然一次只有一个线程（writer 线程）可以修改共享数据，但在许多情况下，任何数量的线程可以同时读取共享数据（reader 线程），读-写锁利用了这一点。从理论上讲，与互斥锁相比，使用读-写锁所允许的并发性增强将带来更大的性能提高。在实践中，只有在多处理器上并且只在访问模式适用于共享数据时，才能完全实现并发性增强。&lt;/p&gt;
&lt;h3 id=&quot;方法摘要-1&quot;&gt;&lt;a href=&quot;#方法摘要-1&quot; class=&quot;headerlink&quot; title=&quot;方法摘要&quot;&gt;&lt;/a&gt;方法摘要&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;返回值&lt;/th&gt;
&lt;th&gt;方法&lt;/th&gt;
&lt;th&gt;解释&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Lock&lt;/td&gt;
&lt;td&gt;readLock()&lt;/td&gt;
&lt;td&gt;返回用于读取操作的锁。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Lock&lt;/td&gt;
&lt;td&gt;writeLock()&lt;/td&gt;
&lt;td&gt;返回用于写入操作的锁。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&quot;ReentrantReadWriteLock&quot;&gt;&lt;a href=&quot;#ReentrantReadWriteLock&quot; class=&quot;headerlink&quot; title=&quot;ReentrantReadWriteLock&quot;&gt;&lt;/a&gt;ReentrantReadWriteLock&lt;/h3&gt;&lt;p&gt;ReentrantReadWriteLock是ReadWriteLock的实现类，其使用方式如下：&lt;/p&gt;
&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ReentrantReadWriteLock &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ReentrantReadWriteLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.readLock().&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();		&lt;span class=&quot;comment&quot;&gt;// 获得读锁&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.readLock().unLock();	&lt;span class=&quot;comment&quot;&gt;// 释放读锁&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.writeLock().&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();	&lt;span class=&quot;comment&quot;&gt;// 获得写锁&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.writeLock().unLock();	&lt;span class=&quot;comment&quot;&gt;// 释放写锁&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面来看一个实际的例子，使用读写锁来实现查询、存钱、取钱：&lt;br&gt;例：&lt;/p&gt;
&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReadWriteLockStudy&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Account&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; balance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; ReadWriteLock &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ReentrantReadWriteLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Lock readLock = &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.readLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Lock writeLock = &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.writeLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;show&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            readLock.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得readLock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;显示余额:&quot;&lt;/span&gt; + balance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                readLock.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;释放readLock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;put&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; money&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            writeLock.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得writeLock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                balance += money;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;存入:&quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;,余额:&quot;&lt;/span&gt; + balance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                writeLock.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;释放writeLock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;take&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; money&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            writeLock.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得writeLock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (balance &amp;lt; money)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;余额不足, 需取: &quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;; 余额: &quot;&lt;/span&gt; + balance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    balance -= money;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;取出:&quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;,余额:&quot;&lt;/span&gt; + balance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                writeLock.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;释放writeLock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PutThread&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PutThread&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Account account&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Random random = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Random();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; money = random.nextInt(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    account.put(money);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TakeThread&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TakeThread&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Account account&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Random random = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Random();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; money = random.nextInt(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    account.take(money);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ShowThread&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ShowThread&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Account account&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                account.show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sleep(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;String args[]&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Account account = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Account();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        PutThread putThread = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PutThread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        putThread.setName(&lt;span class=&quot;string&quot;&gt;&quot;putThread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TakeThread takeThread = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TakeThread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        takeThread.setName(&lt;span class=&quot;string&quot;&gt;&quot;takeThread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ShowThread showThread1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ShowThread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        showThread1.setName(&lt;span class=&quot;string&quot;&gt;&quot;showThread1&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ShowThread showThread2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ShowThread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        showThread2.setName(&lt;span class=&quot;string&quot;&gt;&quot;showThread2&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        putThread.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        takeThread.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        showThread1.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        showThread2.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输出结果（不固定）：&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;获得writeLock &lt;span class=&quot;comment&quot;&gt;-- putThread&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;存入:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;,余额:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;释放writeLock &lt;span class=&quot;comment&quot;&gt;-- putThread&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;获得writeLock &lt;span class=&quot;comment&quot;&gt;-- takeThread&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;余额不足, 需取: &lt;span class=&quot;number&quot;&gt;95&lt;/span&gt;; 余额: &lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;释放writeLock &lt;span class=&quot;comment&quot;&gt;-- takeThread&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;获得readLock &lt;span class=&quot;comment&quot;&gt;-- showThread1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;显示余额:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;释放readLock &lt;span class=&quot;comment&quot;&gt;-- showThread1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;获得readLock &lt;span class=&quot;comment&quot;&gt;-- showThread2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;显示余额:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;释放readLock &lt;span class=&quot;comment&quot;&gt;-- showThread2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;获得readLock &lt;span class=&quot;comment&quot;&gt;-- showThread2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;获得readLock &lt;span class=&quot;comment&quot;&gt;-- showThread1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;显示余额:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;显示余额:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;释放readLock &lt;span class=&quot;comment&quot;&gt;-- showThread1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;释放readLock &lt;span class=&quot;comment&quot;&gt;-- showThread2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到读-读不互斥，读-写互斥，写-写互斥。&lt;/p&gt;
&lt;h3 id=&quot;Condition&quot;&gt;&lt;a href=&quot;#Condition&quot; class=&quot;headerlink&quot; title=&quot;Condition&quot;&gt;&lt;/a&gt;Condition&lt;/h3&gt;&lt;p&gt;条件（也称为条件队列 或条件变量）为线程提供了一个含义，以便在某个状态条件现在可能为 true 的另一个线程通知它之前，一直挂起该线程（即让其“等待”）。因为访问此共享状态信息发生在不同的线程中，所以它必须受保护，因此要将某种形式的锁与该条件相关联。等待提供一个条件的主要属性是：以原子方式 释放相关的锁，并挂起当前线程，就像 Object.wait 做的那样。&lt;br&gt;Condition可以替代传统的线程间通信，用await()替换wait()，用signal()替换notify()，用signalAll()替换notifyAll()。&lt;br&gt;&lt;code&gt;不直接使用wait(), notify(), notifyAll()是因为 这几个方法是final方法。&lt;/code&gt;&lt;br&gt;可以为多个线程间建立不同的Condition。&lt;/p&gt;
&lt;p&gt;将上面的例子修改一下，增加两个功能：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;当余额少于100时，马上存入100；&lt;/li&gt;
&lt;li&gt;当余额大于200时，马上取出100；&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ConditionStudy&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Account&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; balance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Lock &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ReentrantLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Condition condition100 = &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.newCondition();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Condition condition200 = &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.newCondition();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;put&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; money&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                balance += money;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;存入:&quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;,余额:&quot;&lt;/span&gt; + balance + &lt;span class=&quot;string&quot;&gt;&quot; -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                condition200.signal();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;释放lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;take&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; money&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (balance &amp;lt; money)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;余额不足, 需取: &quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;; 余额: &quot;&lt;/span&gt; + balance + &lt;span class=&quot;string&quot;&gt;&quot; -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    balance -= money;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;取出:&quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;,余额:&quot;&lt;/span&gt; + balance + &lt;span class=&quot;string&quot;&gt;&quot; -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    condition100.signal();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;释放lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;put100&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (balance &amp;gt;= &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;余额大于等于100, 等待, 释放锁&quot;&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&quot; -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    condition100.await();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                balance += &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;存入100, 余额:&quot;&lt;/span&gt; + balance + &lt;span class=&quot;string&quot;&gt;&quot; -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;释放lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;take100&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (balance &amp;lt; &lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;余额小于200, 等待, 释放锁&quot;&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&quot; -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    condition200.await();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                balance -= &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;取出100, 余额:&quot;&lt;/span&gt; + balance + &lt;span class=&quot;string&quot;&gt;&quot; -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;释放lock -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PutThread&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PutThread&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Account account&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Random random = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Random();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; money = random.nextInt(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    account.put(money);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TakeThread&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TakeThread&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Account account&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Random random = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Random();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (i++ &amp;lt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; money = random.nextInt(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    account.take(money);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Put100Thread&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Put100Thread&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Account account&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    account.put100();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Take100Thread&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Take100Thread&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Account account&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    account.take100();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;String args[]&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Account account = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Account();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        PutThread putThread = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PutThread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        putThread.setName(&lt;span class=&quot;string&quot;&gt;&quot;putThread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TakeThread takeThread = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TakeThread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        takeThread.setName(&lt;span class=&quot;string&quot;&gt;&quot;takeThread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Put100Thread put100Thread = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Put100Thread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        put100Thread.setName(&lt;span class=&quot;string&quot;&gt;&quot;put100Thread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Take100Thread take100Thread = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Take100Thread(account);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        take100Thread.setName(&lt;span class=&quot;string&quot;&gt;&quot;take100Thread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        putThread.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        takeThread.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        put100Thread.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        take100Thread.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;volatile&quot;&gt;&lt;a href=&quot;#volatile&quot; class=&quot;headerlink&quot; title=&quot;volatile&quot;&gt;&lt;/a&gt;volatile&lt;/h2&gt;&lt;p&gt;volatile可以保证每次都从主内存中读取数据，且每次数据修改都写回主内存。如果一个变量声明为volatile，那么编译器和虚拟机就知道该域是可能被另一个线程并发更新的。&lt;/p&gt;
&lt;h2 id=&quot;死锁&quot;&gt;&lt;a href=&quot;#死锁&quot; class=&quot;headerlink&quot; title=&quot;死锁&quot;&gt;&lt;/a&gt;死锁&lt;/h2&gt;&lt;p&gt;死锁是指多个线程相互等待它方占有的资源而导致的每个线程都无法执行下去的情况。&lt;br&gt;下面是一个简单的死锁例子：&lt;/p&gt;
&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DeadLock&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MemStore&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Lock lock1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ReentrantLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Lock lock2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ReentrantLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;method1&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            lock1.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock1 -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Thread.sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                lock2.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock2 -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    lock2.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                lock1.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;method2&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            lock2.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock2 -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Thread.sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                lock1.&lt;span class=&quot;keyword&quot;&gt;lock&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;获得lock1 -- &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    lock1.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                lock2.unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread1&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; MemStore memStore;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread1&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;MemStore memStore&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.memStore = memStore;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            memStore.method1();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread2&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; MemStore memStore;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread2&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;MemStore memStore&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.memStore = memStore;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            memStore.method2();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;String args[]&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MemStore memStore = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MemStore();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Thread1 thread1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread1(memStore);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        thread1.setName(&lt;span class=&quot;string&quot;&gt;&quot;thread1&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Thread2 thread2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread2(memStore);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        thread2.setName(&lt;span class=&quot;string&quot;&gt;&quot;thread2&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        thread1.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        thread2.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输出结果：&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;获得lock1 &lt;span class=&quot;comment&quot;&gt;-- thread1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;获得lock2 &lt;span class=&quot;comment&quot;&gt;-- thread2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到thread1获得了lock1，等待获得lock2，而thread2获得了lock2，等待获得lock1，从而死锁。&lt;/p&gt;
&lt;h1 id=&quot;线程池&quot;&gt;&lt;a href=&quot;#线程池&quot; class=&quot;headerlink&quot; title=&quot;线程池&quot;&gt;&lt;/a&gt;线程池&lt;/h1&gt;&lt;p&gt;多线程技术主要解决处理器单元内多个线程执行的问题，它可以显著减少处理器单元的闲置时间，增加处理器单元的吞吐能力。&lt;/p&gt;
&lt;h2 id=&quot;线程池原理&quot;&gt;&lt;a href=&quot;#线程池原理&quot; class=&quot;headerlink&quot; title=&quot;线程池原理&quot;&gt;&lt;/a&gt;线程池原理&lt;/h2&gt;&lt;p&gt;假设一个服务器完成一项任务所需时间为：T1 创建线程时间，T2 在线程中执行任务的时间，T3 销毁线程时间。如果：T1 + T3 远大于 T2，则可以采用线程池，以提高服务器性能。&lt;/p&gt;
&lt;p&gt;一个线程池包括以下四个基本组成部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;线程池管理器（ThreadPool）：用于创建并管理线程池，包括 创建线程池，销毁线程池，添加新任务；&lt;/li&gt;
&lt;li&gt;工作线程（PoolWorker）：线程池中线程，在没有任务时处于等待状态，可以循环的执行任务；&lt;/li&gt;
&lt;li&gt;任务接口（Task）：每个任务必须实现的接口，以供工作线程调度任务的执行，它主要规定了任务的入口，任务执行完后的收尾工作，任务的执行状态等；&lt;/li&gt;
&lt;li&gt;任务队列（taskQueue）：用于存放没有处理的任务。提供一种缓冲机制。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;线程池技术正是关注如何缩短或调整T1,T3时间的技术，从而提高服务器程序性能的。它把T1，T3分别安排在服务器程序的启动和结束的时间段或者一些空闲的时间段，这样在服务器程序处理客户请求时，不会有T1，T3的开销了。&lt;/p&gt;
&lt;h2 id=&quot;简单线程池的实现&quot;&gt;&lt;a href=&quot;#简单线程池的实现&quot; class=&quot;headerlink&quot; title=&quot;简单线程池的实现&quot;&gt;&lt;/a&gt;简单线程池的实现&lt;/h2&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SimpleThreadPool&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 线程数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; threadNum = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 工作线程&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; WorkThread[] workThreads;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 任务队列, 待执行的线程&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; BlockingQueue&amp;lt;Runnable&amp;gt; taskQueue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SimpleThreadPool&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; threadNum)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (threadNum &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.threadNum = threadNum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 初始化任务队列&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        taskQueue = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinkedBlockingDeque&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 初始化工作线程&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        workThreads = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; WorkThread[&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.threadNum];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (i &amp;lt; threadNum) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            workThreads[i] = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; WorkThread();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            workThreads[i].setName(&lt;span class=&quot;string&quot;&gt;&quot;workThread-&quot;&lt;/span&gt; + i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 启动工作线程&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            workThreads[i].start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            i++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Runnable runnable)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        taskQueue.add(runnable);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Runnable[] runnableList)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Runnable runnable : runnableList)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            execute(runnable);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;destroy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(WorkThread workThread: workThreads)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            workThread.stopRun();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;WorkThread&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; runFlag = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (runFlag)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Runnable task = taskQueue.take();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    task.run();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;stopRun&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            runFlag = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Runnable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.name = name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(name + &lt;span class=&quot;string&quot;&gt;&quot; run.&quot;&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&quot;current thread: &quot;&lt;/span&gt; + Thread.currentThread().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String args[])&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; InterruptedException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SimpleThreadPool simpleThreadPool = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SimpleThreadPool(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        simpleThreadPool.execute(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task0&quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        simpleThreadPool.execute(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable[]&amp;#123;&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task1&quot;&lt;/span&gt;), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task2&quot;&lt;/span&gt;), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task3&quot;&lt;/span&gt;), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task4&quot;&lt;/span&gt;)&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        simpleThreadPool.execute(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable[]&amp;#123;&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task4&quot;&lt;/span&gt;), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task5&quot;&lt;/span&gt;), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Task(&lt;span class=&quot;string&quot;&gt;&quot;task6&quot;&lt;/span&gt;)&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Thread.sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        simpleThreadPool.destroy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输出结果（不固定）：&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;task0 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;task2 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;task1 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;task3 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;task4 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;task4 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;task5 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;task6 run&lt;span class=&quot;selector-class&quot;&gt;.current&lt;/span&gt; thread: workThread-&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;concurrent包&quot;&gt;&lt;a href=&quot;#concurrent包&quot; class=&quot;headerlink&quot; title=&quot;concurrent包&quot;&gt;&lt;/a&gt;concurrent包&lt;/h1&gt;&lt;p&gt;java.util.concurrent包是在并发编程中很常用的实用工具包。此包包括了几个小的、已标准化的可扩展框架，以及一些提供有用功能的类，没有这些类，这些功能会很难实现或实现起来冗长乏味。下面简要描述主要的组件。&lt;/p&gt;
&lt;h2 id=&quot;执行器&quot;&gt;&lt;a href=&quot;#执行器&quot; class=&quot;headerlink&quot; title=&quot;执行器&quot;&gt;&lt;/a&gt;执行器&lt;/h2&gt;&lt;p&gt;接口。Executor是一个简单的标准化接口，用于定义类似于线程的自定义子系统，包括线程池、异步IO和轻量级任务框架。根据所使用的具体Executor类的不同，可能在新创建的线程中，现有的任务执行线程中，或者调用execute()的线程中执行任务，并且可能顺序或并发执行。ExecutorService 提供了多个完整的异步任务执行框架。ExecutorService 管理任务的排队和安排，并允许受控制的关闭。ScheduledExecutorService 子接口及相关的接口添加了对延迟的和定期任务执行的支持。ExecutorService 提供了安排异步执行的方法，可执行由 Callable 表示的任何函数，结果类似于 Runnable。Future 返回函数的结果，允许确定执行是否完成，并提供取消执行的方法。RunnableFuture 是拥有 run 方法的 Future，run 方法执行时将设置其结果。&lt;/p&gt;
&lt;p&gt;实现。类 ThreadPoolExecutor 和 ScheduledThreadPoolExecutor 提供可调的、灵活的线程池。Executors 类提供大多数 Executor 的常见类型和配置的工厂方法，以及使用它们的几种实用工具方法。其他基于 Executor 的实用工具包括具体类 FutureTask，它提供 Future 的常见可扩展实现，以及 ExecutorCompletionService，它有助于协调对异步任务组的处理。&lt;/p&gt;
&lt;h2 id=&quot;队列&quot;&gt;&lt;a href=&quot;#队列&quot; class=&quot;headerlink&quot; title=&quot;队列&quot;&gt;&lt;/a&gt;队列&lt;/h2&gt;&lt;p&gt;java.util.concurrent.ConcurrentLinkedQueue类提供了高效的、可伸缩的、线程安全的非阻塞 FIFO 队列。java.util.concurrent 中的五个实现都支持扩展的 BlockingQueue 接口，该接口定义了 put 和 take 的阻塞版本：LinkedBlockingQueue、ArrayBlockingQueue、SynchronousQueue、PriorityBlockingQueue 和 DelayQueue。这些不同的类覆盖了生产者-使用者、消息传递、并行任务执行和相关并发设计的大多数常见使用的上下文。BlockingDeque 接口扩展 BlockingQueue，以支持 FIFO 和 LIFO（基于堆栈）操作。LinkedBlockingDeque 类提供一个实现。&lt;/p&gt;
&lt;h2 id=&quot;计时&quot;&gt;&lt;a href=&quot;#计时&quot; class=&quot;headerlink&quot; title=&quot;计时&quot;&gt;&lt;/a&gt;计时&lt;/h2&gt;&lt;p&gt;TimeUnit 类为指定和控制基于超时的操作提供了多重粒度（包括纳秒级）。该包中的大多数类除了包含不确定的等待之外，还包含基于超时的操作。在使用超时的所有情况中，超时指定了在表明已超时前该方法应该等待的最少时间。在超时发生后，实现会“尽力”检测超时。但是，在检测超时与超时之后再次实际执行线程之间可能要经过不确定的时间。接受超时期参数的所有方法将小于等于 0 的值视为根本不会等待。要“永远”等待，可以使用 Long.MAX_VALUE 值。&lt;/p&gt;
&lt;h2 id=&quot;同步器&quot;&gt;&lt;a href=&quot;#同步器&quot; class=&quot;headerlink&quot; title=&quot;同步器&quot;&gt;&lt;/a&gt;同步器&lt;/h2&gt;&lt;p&gt;四个类可协助实现常见的专用同步语句。Semaphore 是一个经典的并发工具。CountDownLatch 是一个极其简单但又极其常用的实用工具，用于在保持给定数目的信号、事件或条件前阻塞执行。CyclicBarrier 是一个可重置的多路同步点，在某些并行编程风格中很有用。Exchanger 允许两个线程在 collection 点交换对象，它在多流水线设计中是有用的。&lt;/p&gt;
&lt;h2 id=&quot;并发-Collection&quot;&gt;&lt;a href=&quot;#并发-Collection&quot; class=&quot;headerlink&quot; title=&quot;并发 Collection&quot;&gt;&lt;/a&gt;并发 Collection&lt;/h2&gt;&lt;p&gt;除队列外，此包还提供了设计用于多线程上下文中的 Collection 实现：ConcurrentHashMap、ConcurrentSkipListMap、ConcurrentSkipListSet、CopyOnWriteArrayList 和 CopyOnWriteArraySet。当期望许多线程访问一个给定 collection 时，ConcurrentHashMap 通常优于同步的 HashMap，ConcurrentSkipListMap 通常优于同步的 TreeMap。当期望的读数和遍历远远大于列表的更新数时，CopyOnWriteArrayList 优于同步的 ArrayList。&lt;br&gt;此包中与某些类一起使用的“Concurrent&amp;amp;rdquo前缀;是一种简写，表明与类似的“同步”类有所不同。例如，java.util.Hashtable 和 Collections.synchronizedMap(new HashMap()) 是同步的，但 ConcurrentHashMap 则是“并发的”。并发 collection 是线程安全的，但是不受单个排他锁的管理。在 ConcurrentHashMap 这一特定情况下，它可以安全地允许进行任意数目的并发读取，以及数目可调的并发写入。需要通过单个锁不允许对 collection 的所有访问时，“同步”类是很有用的，其代价是较差的可伸缩性。在期望多个线程访问公共 collection 的其他情况中，通常“并发”版本要更好一些。当 collection 是未共享的，或者仅保持其他锁时 collection 是可访问的情况下，非同步 collection 则要更好一些。&lt;/p&gt;
&lt;p&gt;大多数并发 Collection 实现（包括大多数 Queue）与常规的 java.util 约定也不同，因为它们的迭代器提供了弱一致的，而不是快速失败的遍历。弱一致的迭代器是线程安全的，但是在迭代时没有必要冻结 collection，所以它不一定反映自迭代器创建以来的所有更新。&lt;/p&gt;
&lt;h2 id=&quot;内存一致性属性&quot;&gt;&lt;a href=&quot;#内存一致性属性&quot; class=&quot;headerlink&quot; title=&quot;内存一致性属性&quot;&gt;&lt;/a&gt;内存一致性属性&lt;/h2&gt;&lt;p&gt;只有写入操作 happen-before 读取操作时，才保证一个线程写入的结果对另一个线程的读取是可视的。synchronized 和 volatile 构造 happen-before 关系，Thread.start() 和 Thread.join() 方法形成 happen-before 关系。尤其是：&lt;br&gt;线程中的每个操作 happen-before 稍后按程序顺序传入的该线程中的每个操作。&lt;br&gt;一个解除锁监视器的（synchronized 阻塞或方法退出）happen-before 相同监视器的每个后续锁（synchronized 阻塞或方法进入）。并且因为 happen-before 关系是可传递的，所以解除锁定之前的线程的所有操作 happen-before 锁定该监视器的任何线程后续的所有操作。&lt;br&gt;写入 volatile 字段 happen-before 每个后续读取相同字段。volatile 字段的读取和写入与进入和退出监视器具有相似的内存一致性效果，但不 需要互斥锁。&lt;br&gt;在线程上调用 start happen-before 已启动的线程中的任何线程。&lt;br&gt;线程中的所有操作 happen-before 从该线程上的 join 成功返回的任何其他线程。&lt;br&gt;java.util.concurrent 中所有类的方法及其子包扩展了这些对更高级别同步的保证。尤其是：&lt;br&gt;线程中将一个对象放入任何并发 collection 之前的操作 happen-before 从另一线程中的 collection 访问或移除该元素的后续操作。&lt;br&gt;线程中向 Executor 提交 Runnable 之前的操作 happen-before 其执行开始。同样适用于向 ExecutorService 提交 Callables。&lt;br&gt;异步计算（由 Future 表示）所采取的操作 happen-before 通过另一线程中 Future.get() 获取结果后续的操作。&lt;br&gt;“释放”同步储存方法（如 Lock.unlock、Semaphore.release 和 CountDownLatch.countDown）之前的操作 happen-before 另一线程中相同同步储存对象成功“获取”方法（如 Lock.lock、Semaphore.acquire、Condition.await 和 CountDownLatch.await）的后续操作。&lt;br&gt;对于通过 Exchanger 成功交换对象的每个线程对，每个线程中 exchange() 之前的操作 happen-before 另一线程中对应 exchange() 后续的操作。&lt;br&gt;调用 CyclicBarrier.await 之前的操作 happen-before 屏障操作所执行的操作，屏障操作所执行的操作 happen-before 从另一线程中对应 await 成功返回的后续操作。&lt;/p&gt;
&lt;h1 id=&quot;关于线程个数&quot;&gt;&lt;a href=&quot;#关于线程个数&quot; class=&quot;headerlink&quot; title=&quot;关于线程个数&quot;&gt;&lt;/a&gt;关于线程个数&lt;/h1&gt;&lt;p&gt;我们的应用程序应该创建多少个线程会使得性能得到比较好的提升呢？以下代码可以计算一个合适的线程个数：&lt;/p&gt;
&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PoolSizeCalculator&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * The sample queue size to calculate the size of a single &amp;#123;@link Runnable&amp;#125; element.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; final &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; SAMPLE_QUEUE_SIZE = &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Accuracy of test run. It must finish within 20ms of the testTime otherwise we retry the test. This could be&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * configurable.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; final &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; EPSYLON = &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Control variable for the CPU time investigation.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; boolean expired;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Time (millis) of the test run in the CPU time calculation.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; final &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; testtime = &lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Calculates the boundaries of a thread pool for a given &amp;#123;@link Runnable&amp;#125;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @param targetUtilization    the desired utilization of the CPUs (0 &amp;lt;= targetUtilization &amp;lt;= 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @param targetQueueSizeBytes the desired maximum work queue size of the thread pool (bytes)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;calculateBoundaries&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;BigDecimal targetUtilization, BigDecimal targetQueueSizeBytes&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        calculateOptimalCapacity(targetQueueSizeBytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Runnable task = createTask();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        start(task);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        start(task); &lt;span class=&quot;comment&quot;&gt;// warm up phase&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; cputime = getCurrentThreadCPUTime();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        start(task); &lt;span class=&quot;comment&quot;&gt;// test intervall&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cputime = getCurrentThreadCPUTime() - cputime;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; waittime = (testtime * &lt;span class=&quot;number&quot;&gt;1000000&lt;/span&gt;) - cputime;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        calculateOptimalThreadCount(cputime, waittime, targetUtilization);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;calculateOptimalCapacity&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;BigDecimal targetQueueSizeBytes&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; mem = calculateMemoryUsage();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BigDecimal queueCapacity = targetQueueSizeBytes.divide(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BigDecimal(mem), RoundingMode.HALF_UP);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Target queue memory usage (bytes): &quot;&lt;/span&gt; + targetQueueSizeBytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;createTask() produced &quot;&lt;/span&gt; + createTask().getClass().getName() + &lt;span class=&quot;string&quot;&gt;&quot; which took &quot;&lt;/span&gt; + mem&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                + &lt;span class=&quot;string&quot;&gt;&quot; bytes in a queue&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Formula: &quot;&lt;/span&gt; + targetQueueSizeBytes + &lt;span class=&quot;string&quot;&gt;&quot; / &quot;&lt;/span&gt; + mem);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;* Recommended queue capacity (bytes): &quot;&lt;/span&gt; + queueCapacity);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Brian Goetz&#39; optimal thread count formula, see &#39;Java Concurrency in Practice&#39; (chapter 8.2)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @param cpu               cpu time consumed by considered task&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @param wait              wait time of considered task&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @param targetUtilization target utilization of the system&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;calculateOptimalThreadCount&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; cpu, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; wait, BigDecimal targetUtilization&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BigDecimal waitTime = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BigDecimal(wait);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BigDecimal computeTime = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BigDecimal(cpu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BigDecimal numberOfCPU = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BigDecimal(Runtime.getRuntime().availableProcessors());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BigDecimal optimalthreadcount = numberOfCPU.multiply(targetUtilization).multiply(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;).add(waitTime.divide(computeTime, RoundingMode.HALF_UP)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Number of CPU: &quot;&lt;/span&gt; + numberOfCPU);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Target utilization: &quot;&lt;/span&gt; + targetUtilization);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Elapsed time (nanos): &quot;&lt;/span&gt; + (testtime * &lt;span class=&quot;number&quot;&gt;1000000&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Compute time (nanos): &quot;&lt;/span&gt; + cpu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Wait time (nanos): &quot;&lt;/span&gt; + wait);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Formula: &quot;&lt;/span&gt; + numberOfCPU + &lt;span class=&quot;string&quot;&gt;&quot; * &quot;&lt;/span&gt; + targetUtilization + &lt;span class=&quot;string&quot;&gt;&quot; * (1 + &quot;&lt;/span&gt; + waitTime + &lt;span class=&quot;string&quot;&gt;&quot; / &quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                + computeTime + &lt;span class=&quot;string&quot;&gt;&quot;)&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;* Optimal thread count: &quot;&lt;/span&gt; + optimalthreadcount);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Runs the &amp;#123;@link Runnable&amp;#125; over a period defined in &amp;#123;@link #testtime&amp;#125;. Based on Heinz Kabbutz&#39; ideas&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * (http://www.javaspecialists.eu/archive/Issue124.html).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @param task the runnable under investigation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;start&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;Runnable task&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; start = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; runs = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (++runs &amp;gt; &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;string&quot;&gt;&quot;Test not accurate&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            expired = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            start = System.currentTimeMillis();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Timer timer = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Timer();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            timer.schedule(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TimerTask() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    expired = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;, testtime);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (!expired) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                task.run();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            start = System.currentTimeMillis() - start;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            timer.cancel();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (Math.abs(start - testtime) &amp;gt; EPSYLON);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        collectGarbage(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;collectGarbage&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; times&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; times; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.gc();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Thread.sleep(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Thread.currentThread().interrupt();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Calculates the memory usage of a single element in a work queue. Based on Heinz Kabbutz&#39; ideas&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * (http://www.javaspecialists.eu/archive/Issue029.html).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @return memory usage of a single &amp;#123;@link Runnable&amp;#125; element in the thread pools work queue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;calculateMemoryUsage&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BlockingQueue&amp;lt;Runnable&amp;gt; queue = createWorkQueue();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; SAMPLE_QUEUE_SIZE; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            queue.add(createTask());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; mem0 = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; mem1 = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        queue = &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        collectGarbage(&lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mem0 = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        queue = createWorkQueue();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; SAMPLE_QUEUE_SIZE; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            queue.add(createTask());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        collectGarbage(&lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mem1 = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (mem1 - mem0) / SAMPLE_QUEUE_SIZE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Create your runnable task here.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @return an instance of your runnable task under investigation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; Runnable &lt;span class=&quot;title&quot;&gt;createTask&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Return an instance of the queue used in the thread pool.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @return queue instance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; BlockingQueue&amp;lt;Runnable&amp;gt; &lt;span class=&quot;title&quot;&gt;createWorkQueue&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Calculate current cpu time. Various frameworks may be used here, depending on the operating system in use. (e.g.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * http://www.hyperic.com/products/sigar). The more accurate the CPU time measurement, the more accurate the results&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * for thread count boundaries.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * @return current cpu time of current thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getCurrentThreadCPUTime&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyPoolSizeCalculator&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PoolSizeCalculator&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; InterruptedException,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            InstantiationException,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            IllegalAccessException,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ClassNotFoundException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MyPoolSizeCalculator calculator = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MyPoolSizeCalculator();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        calculator.calculateBoundaries(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;number&quot;&gt;100000&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getCurrentThreadCPUTime&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ManagementFactory.getThreadMXBean().getCurrentThreadCpuTime();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; Runnable &lt;span class=&quot;title&quot;&gt;createTask&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;10000&lt;/span&gt;; i++)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.out.println(i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; BlockingQueue&amp;lt;Runnable&amp;gt; &lt;span class=&quot;title&quot;&gt;createWorkQueue&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinkedBlockingQueue&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;createTask的方法根据自己的实际需要进行修改。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;得到类似如下结果 ：&lt;/p&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Number &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; CPU: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Target utilization: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Elapsed &lt;span class=&quot;built_in&quot;&gt;time&lt;/span&gt; (nanos): &lt;span class=&quot;number&quot;&gt;3000000000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Compute &lt;span class=&quot;built_in&quot;&gt;time&lt;/span&gt; (nanos): &lt;span class=&quot;number&quot;&gt;2017495000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Wait &lt;span class=&quot;built_in&quot;&gt;time&lt;/span&gt; (nanos): &lt;span class=&quot;number&quot;&gt;982505000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Formula: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; * (&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;982505000&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;2017495000&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* Optimal thread &lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;由此可知，在上述场景中，创建4个线程比较合适。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;线程是程序执行流的最小单元，多线程程序在较低层次上扩展了多任务的概念：一个程序同时执行多个任务。通常每一个任务称为一个线程(thread)，它是线程控制的简称。可以同时运行一个以上线程的程序称为多线程程序(multithreaded)。&lt;/p&gt;
&lt;h1 id=&quot;线程的状态&quot;
    
    </summary>
    
      <category term="Java基础" scheme="http://jackalope.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="Java" scheme="http://jackalope.cn/tags/Java/"/>
    
      <category term="多线程" scheme="http://jackalope.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Object类详解</title>
    <link href="http://jackalope.cn/2016/04/14/java-core-object/"/>
    <id>http://jackalope.cn/2016/04/14/java-core-object/</id>
    <published>2016-04-14T07:18:01.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html">&lt;p&gt;Object类是Java中所有类的祖先，在Java中每个类都是由它扩展而来的。如果没有明确地指出超类，Object类就被认为是这个类的超类。&lt;br&gt;可以使用Object类型的变量引用任何类型的对象：&lt;br&gt;&lt;code&gt;Object obj = new MyObject();&lt;/code&gt;&lt;br&gt;但是，要想对其中的内容进行具体的操作，还需要清楚对象的原始类型，并进行相应的转化：&lt;br&gt;&lt;code&gt;MyObject mObj = (MyObject) obj;&lt;/code&gt;&lt;br&gt;在Java中只有基本类型不是对象，例如：数值、字符和布尔型的值都不是对象。所有的数组类型，不管是对象数组还是基本类型数组都扩展于Object类。&lt;/p&gt;
&lt;h1 id=&quot;方法&quot;&gt;&lt;a href=&quot;#方法&quot; class=&quot;headerlink&quot; title=&quot;方法&quot;&gt;&lt;/a&gt;方法&lt;/h1&gt;&lt;h2 id=&quot;public-Object&quot;&gt;&lt;a href=&quot;#public-Object&quot; class=&quot;headerlink&quot; title=&quot;public Object();&quot;&gt;&lt;/a&gt;public Object();&lt;/h2&gt;&lt;p&gt;Java中规定：在类定义过程中，对于未定义构造函数的类，默认会有一个无参数的构造函数，作为所有类的祖先，Object类自然要反映出此特性，在源代码中，未给出Object类构造函数定义，但实际上，此构造函数是存存的。&lt;/p&gt;
&lt;h2 id=&quot;private-static-native-void-registerNatives-；&quot;&gt;&lt;a href=&quot;#private-static-native-void-registerNatives-；&quot; class=&quot;headerlink&quot; title=&quot;private static native void registerNatives()；&quot;&gt;&lt;/a&gt;private static native void registerNatives()；&lt;/h2&gt;&lt;p&gt;将本地函数向VM进行登记，将C/C++中的方法映射到Java中的native方法，实现方法命名的解耦。&lt;br&gt;此方法由其后紧跟的静态代码调用：&lt;br&gt;&lt;figure class=&quot;highlight actionscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    registerNatives();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;public-final-native-Class-lt-gt-getClass-；&quot;&gt;&lt;a href=&quot;#public-final-native-Class-lt-gt-getClass-；&quot; class=&quot;headerlink&quot; title=&quot;public final native Class&amp;lt;?&amp;gt; getClass()；&quot;&gt;&lt;/a&gt;public final native Class&amp;lt;?&amp;gt; getClass()；&lt;/h2&gt;&lt;p&gt;getClass()是一个native方法，返回这个对象的运行时类对象，效果与Object.class相同。&lt;br&gt;首先解释下”类对象”的概念：在Java中，类是是对具有一组相同特征或行为的实例的抽象并进行描述，对象则是此类所描述的特征或行为的具体实例。作为概念层次的类，其本身也具有某些共同的特性，如都具有类名称、由类加载器去加载，都具有包，具有父类，属性和方法等。于是，Java中有专门定义了一个类，Class，去描述其他类所具有的这些特性，因此，从此角度去看，类本身也都是属于Class类的对象。为与经常意义上的对象相区分，在此称之为”类对象”。&lt;/p&gt;
&lt;h2 id=&quot;public-native-int-hashCode&quot;&gt;&lt;a href=&quot;#public-native-int-hashCode&quot; class=&quot;headerlink&quot; title=&quot;public native int hashCode()&quot;&gt;&lt;/a&gt;public native int hashCode()&lt;/h2&gt;&lt;p&gt;hashCode()是一个native方法，返回一个整形数值，表示该对象的哈希码值。&lt;br&gt;hashCode()具有如下约定：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在Java应用程序执行期间，对于同一个对象多次调用hashCode()方法时，其返回的哈希码是相同的，前提是将对象进行equals比较时所用的信息未做修改。在某一应用程序的一次执行到同一应用程序的另一次执行，该整形数值无需保持一致。&lt;/li&gt;
&lt;li&gt;如果根据equals（object）方法，两个对象是相等的，则hashcode必须相同。&lt;/li&gt;
&lt;li&gt;如果两个对象的hashcode相同，这两个对象不一定相等。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;需要注意的是：为不相等的对象生成不同的hashcode可以提高哈希表的性能。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;public-boolean-equals-Object-obj&quot;&gt;&lt;a href=&quot;#public-boolean-equals-Object-obj&quot; class=&quot;headerlink&quot; title=&quot;public boolean equals(Object obj)&quot;&gt;&lt;/a&gt;public boolean equals(Object obj)&lt;/h2&gt;&lt;p&gt;equals()方法判断两个对象是否相等，在Object类中，equals表示的是同一个对象。&lt;br&gt;代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight aspectj&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object obj)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt; == obj);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;注意：重写了equals方法后需要重写hashCode方法。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;protected-native-Object-clone-throws-CloneNotSupportedException&quot;&gt;&lt;a href=&quot;#protected-native-Object-clone-throws-CloneNotSupportedException&quot; class=&quot;headerlink&quot; title=&quot;protected native Object clone() throws CloneNotSupportedException&quot;&gt;&lt;/a&gt;protected native Object clone() throws CloneNotSupportedException&lt;/h2&gt;&lt;p&gt;clone()是一个native方法，其作用是创建并返回此对象的副本，返回的是一个引用，指向的是新clone出来的对象，此对象与原对象分别占用不同的堆空间。此方法执行的是对象的浅拷贝而不是深拷贝。&lt;/p&gt;
&lt;p&gt;`&lt;br&gt;注意：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;不可在子类中创建Object对象，并直接clone，原因如下：clone()方法是protected的，protected关键字的含义是：在同一个包内或者不同包的子类可以访问，当两个类不在同一个包中的时候，在子类内部且子类的引用才可以访问父类的protected成员；在子类内部，父类的引用并不能访问protected成员。&lt;br&gt;例：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt; obj = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt; cloneObj = obj.clone();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;报错为：”The method clone() from the type Object is not visible”&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用clone()方法的子类需要实现Cloneable接口，否则会抛出异常：java.lang.CloneNotSupportedException&lt;br&gt;例：&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CloneTest&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Cloneable&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String args[])&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; CloneNotSupportedException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CloneTest obj = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; CloneTest();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CloneTest cloneObj = (CloneTest) obj.clone();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;`&lt;/p&gt;
&lt;h2 id=&quot;public-String-toString&quot;&gt;&lt;a href=&quot;#public-String-toString&quot; class=&quot;headerlink&quot; title=&quot;public String toString()&quot;&gt;&lt;/a&gt;public String toString()&lt;/h2&gt;&lt;p&gt;toString()方法返回该对象的字符串表示。代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt; toString() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; getClass().getName() + &lt;span class=&quot;string&quot;&gt;&quot;@&quot;&lt;/span&gt; + &lt;span class=&quot;built_in&quot;&gt;Integer&lt;/span&gt;.toHexString(hashCode());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;public-final-native-void-notify&quot;&gt;&lt;a href=&quot;#public-final-native-void-notify&quot; class=&quot;headerlink&quot; title=&quot;public final native void notify()&quot;&gt;&lt;/a&gt;public final native void notify()&lt;/h2&gt;&lt;p&gt;唤醒在此对象监视器上等待的单个线程。如果所有线程都在此对象上等待，则会选择唤醒其中一个线程。选择是任意性的，并在对实现做出决定时发生。线程通过调用其中一个wait方法，在对象的监视器上等待。&lt;/p&gt;
&lt;h2 id=&quot;public-final-native-void-notifyAll&quot;&gt;&lt;a href=&quot;#public-final-native-void-notifyAll&quot; class=&quot;headerlink&quot; title=&quot;public final native void notifyAll()&quot;&gt;&lt;/a&gt;public final native void notifyAll()&lt;/h2&gt;&lt;p&gt;唤醒在此对象监视器上等待的所有线程。线程通过调用其中一个wait方法，在对象的监视器上等待。&lt;/p&gt;
&lt;h2 id=&quot;public-final-native-void-wait-long-timeout-throws-InterruptedException&quot;&gt;&lt;a href=&quot;#public-final-native-void-wait-long-timeout-throws-InterruptedException&quot; class=&quot;headerlink&quot; title=&quot;public final native void wait(long timeout) throws InterruptedException&quot;&gt;&lt;/a&gt;public final native void wait(long timeout) throws InterruptedException&lt;/h2&gt;&lt;p&gt;在其他线程调用此对象的notify()方法或notifyAll()方法，或者超过指定的时间量前，导致当前线程等待。&lt;br&gt;&lt;code&gt;timeout单位为毫秒。&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;public-final-void-wait-long-timeout-int-nanos-throws-InterruptedException&quot;&gt;&lt;a href=&quot;#public-final-void-wait-long-timeout-int-nanos-throws-InterruptedException&quot; class=&quot;headerlink&quot; title=&quot;public final void wait(long timeout, int nanos) throws InterruptedException&quot;&gt;&lt;/a&gt;public final void wait(long timeout, int nanos) throws InterruptedException&lt;/h2&gt;&lt;p&gt;在其他线程调用此对象的notify()方法或notifyAll()方法，或者其他某个线程中断当前线程，或者已超过某个实际时间量前，导致当前线程等待。&lt;br&gt;此方法类似于一个参数的wait方法，但它允许更好地控制 在放弃之前等待通过的时间量。用毫微秒度量的实际时间量可以通过以下公式计算出来：&lt;br&gt;&lt;code&gt;1000000 * timeout + nanos&lt;/code&gt;&lt;br&gt;在其他所有方面，此方法执行的操作与带有一个参数的wait(long)方法相同，需要特别指出的是，wait(0,0)与wait(0)相同。&lt;/p&gt;
&lt;h2 id=&quot;简单的生产消费模型&quot;&gt;&lt;a href=&quot;#简单的生产消费模型&quot; class=&quot;headerlink&quot; title=&quot;简单的生产消费模型&quot;&gt;&lt;/a&gt;简单的生产消费模型&lt;/h2&gt;&lt;p&gt;一段简单的存钱/取钱代码，用来体现一下wait/notify的作用。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Account&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; balance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; money)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; InterruptedException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (balance &amp;lt; money) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(&lt;span class=&quot;string&quot;&gt;&quot;余额不足, 需取: &quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;; 余额: &quot;&lt;/span&gt; + balance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            wait();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        balance -= money;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(&lt;span class=&quot;string&quot;&gt;&quot;取出: &quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;; 余额: &quot;&lt;/span&gt; + balance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; money)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; InterruptedException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        balance += money;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(&lt;span class=&quot;string&quot;&gt;&quot;存入: &quot;&lt;/span&gt; + money + &lt;span class=&quot;string&quot;&gt;&quot;; 余额: &quot;&lt;/span&gt; + balance);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        notifyAll();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TakeThread&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TakeThread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Account account)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Random random = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Random();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; money = random.nextInt(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                account.take(money);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PutThread&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Account account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PutThread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Account account)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.account = account;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Random random = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Random();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; money = random.nextInt(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                account.put(money);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;public-final-void-wait-throws-InterruptedException&quot;&gt;&lt;a href=&quot;#public-final-void-wait-throws-InterruptedException&quot; class=&quot;headerlink&quot; title=&quot;public final void wait() throws InterruptedException&quot;&gt;&lt;/a&gt;public final void wait() throws InterruptedException&lt;/h2&gt;&lt;p&gt;= wait(0)&lt;/p&gt;
&lt;h2 id=&quot;protected-void-finalize-throws-Throwable&quot;&gt;&lt;a href=&quot;#protected-void-finalize-throws-Throwable&quot; class=&quot;headerlink&quot; title=&quot;protected void finalize() throws Throwable&quot;&gt;&lt;/a&gt;protected void finalize() throws Throwable&lt;/h2&gt;&lt;p&gt;当垃圾回收器确定不存在对该对象的更多引用时，由对象的垃圾加收器调用此方法。子类重写finalize方法，以配置系统资源或执行其他清除。&lt;/p&gt;
&lt;h1 id=&quot;参考资料&quot;&gt;&lt;a href=&quot;#参考资料&quot; class=&quot;headerlink&quot; title=&quot;参考资料&quot;&gt;&lt;/a&gt;参考资料&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/lwbqqyumidi/p/3693015.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Java总结篇系列：java.lang.Object&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;jdk api&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Object类是Java中所有类的祖先，在Java中每个类都是由它扩展而来的。如果没有明确地指出超类，Object类就被认为是这个类的超类。&lt;br&gt;可以使用Object类型的变量引用任何类型的对象：&lt;br&gt;&lt;code&gt;Object obj = new MyObject();
    
    </summary>
    
      <category term="Java基础" scheme="http://jackalope.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="Java" scheme="http://jackalope.cn/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>JNI（Java Native Interface）原理与使用</title>
    <link href="http://jackalope.cn/2016/04/13/java-core-jni/"/>
    <id>http://jackalope.cn/2016/04/13/java-core-jni/</id>
    <published>2016-04-13T08:44:39.000Z</published>
    <updated>2016-08-20T23:41:36.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;p&gt;Java本地接口（Java Native Interface(JNI)）允许运行在Java虚拟机(Java Virtual Machine(JVM))上的代码调用本地程序和类库，或者被它们调用，这些程序和类库可以是其他语言编写的，比如：C、C++或汇编语言。&lt;br&gt;很多基本类库都依赖JNI来为开发者和用户提供服务，比如文件的输入/输出和音频功能。在基本类库中包含的对于性能和平台敏感的API可以允许所有的Java程序以安全和平台无关的方式来使用这些功能。&lt;/p&gt;
&lt;h1 id=&quot;知识图&quot;&gt;&lt;a href=&quot;#知识图&quot; class=&quot;headerlink&quot; title=&quot;知识图&quot;&gt;&lt;/a&gt;知识图&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;jni.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;一些宏定义&quot;&gt;&lt;a href=&quot;#一些宏定义&quot; class=&quot;headerlink&quot; title=&quot;一些宏定义&quot;&gt;&lt;/a&gt;一些宏定义&lt;/h1&gt;&lt;p&gt;windows宏定义的代码位置：&lt;br&gt;&lt;code&gt;./jdk/src/windows/javavm/export/jni_md.h&lt;/code&gt;）；&lt;br&gt;非windows宏定义代码位置（以MAC为例）：&lt;br&gt;&lt;code&gt;./jdk/src/macosx/javavm/export/jni_md.h&lt;/code&gt;）&lt;/p&gt;
&lt;h2 id=&quot;JNIEXPORT&quot;&gt;&lt;a href=&quot;#JNIEXPORT&quot; class=&quot;headerlink&quot; title=&quot;JNIEXPORT&quot;&gt;&lt;/a&gt;JNIEXPORT&lt;/h2&gt;&lt;p&gt;windows:&lt;br&gt;&lt;code&gt;#define JNIEXPORT __declspec(dllexport)&lt;/code&gt;&lt;br&gt;非windows:&lt;br&gt;&lt;code&gt;#define JNIEXPORT&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;JNIIMPORT&quot;&gt;&lt;a href=&quot;#JNIIMPORT&quot; class=&quot;headerlink&quot; title=&quot;JNIIMPORT&quot;&gt;&lt;/a&gt;JNIIMPORT&lt;/h2&gt;&lt;p&gt;windows:&lt;br&gt;&lt;code&gt;#define JNIIMPORT __declspec(dllimport)&lt;/code&gt;&lt;br&gt;非windows:&lt;br&gt;&lt;code&gt;#define JNIIMPORT&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;JNICALL&quot;&gt;&lt;a href=&quot;#JNICALL&quot; class=&quot;headerlink&quot; title=&quot;JNICALL&quot;&gt;&lt;/a&gt;JNICALL&lt;/h2&gt;&lt;p&gt;windows:&lt;br&gt;&lt;code&gt;#define JNICALL __stdcall&lt;/code&gt;&lt;br&gt;非windows:&lt;br&gt;&lt;code&gt;#define JNICALL&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;实例&quot;&gt;&lt;a href=&quot;#实例&quot; class=&quot;headerlink&quot; title=&quot;实例&quot;&gt;&lt;/a&gt;实例&lt;/h1&gt;&lt;h2 id=&quot;使用javah&quot;&gt;&lt;a href=&quot;#使用javah&quot; class=&quot;headerlink&quot; title=&quot;使用javah&quot;&gt;&lt;/a&gt;使用javah&lt;/h2&gt;&lt;h3 id=&quot;java代码&quot;&gt;&lt;a href=&quot;#java代码&quot; class=&quot;headerlink&quot; title=&quot;java代码&quot;&gt;&lt;/a&gt;java代码&lt;/h3&gt;&lt;p&gt;编写java代码，并生成C/C++头文件；&lt;/p&gt;
&lt;p&gt;程序清单1: &lt;code&gt;HelloJni.java&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;package&lt;/span&gt; org.jackalope.study.jni;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HelloJni&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.loadLibrary(&lt;span class=&quot;string&quot;&gt;&quot;HelloJni&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;native&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DisplayHello&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HelloJni().DisplayHello();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;进入src目录下，编译该JAVA类：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;javac HelloJni.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;生成头文件：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;javah org.jackalope.study.jni.HelloJni&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;得到头文件 org_jackalope_study_jni_HelloJni.h，此文件供C、C++程序来引用并实现其中的函数&lt;/p&gt;
&lt;p&gt;程序清单2: &lt;code&gt;org_jackalope_study_jni_HelloJni.h&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;* DO NOT EDIT THIS FILE - it is machine generated */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;jni.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* Header for class org_jackalope_study_jni_HelloJni */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifndef&lt;/span&gt; _Included_org_jackalope_study_jni_HelloJni&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; _Included_org_jackalope_study_jni_HelloJni&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __cplusplus&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;C&quot;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Class:     org_jackalope_study_jni_HelloJni&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Method:    DisplayHello&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Signature: ()V&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;JNIEXPORT &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; JNICALL &lt;span class=&quot;title&quot;&gt;Java_org_jackalope_study_jni_HelloJni_DisplayHello&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;params&quot;&gt;(JNIEnv *, jobject)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; __cplusplus&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;C-代码&quot;&gt;&lt;a href=&quot;#C-代码&quot; class=&quot;headerlink&quot; title=&quot;C++代码&quot;&gt;&lt;/a&gt;C++代码&lt;/h3&gt;&lt;p&gt;编写C++代码，实现函数功能 ———— 打印”HelloJni”。&lt;/p&gt;
&lt;p&gt;程序清单3：jni_helloworldImpl.cpp&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;jni.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; org_jackalope_study_jni_HelloJni.h&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;JNIEXPORT &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; JNICALL &lt;span class=&quot;title&quot;&gt;Java_org_jackalope_study_jni_HelloJni_DisplayHello&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(JNIEnv *env, jobject obj)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;From org_jackalope_study_jni_HelloJni.cpp :&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;Hello world ! \n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此C++文件实现了上述头文件中的函数，注意方法函数名要保持一致。&lt;br&gt;编译生成动态库libHelloJni.jnilib:&lt;br&gt;&lt;code&gt;g++ -shared -I /Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/include/ org_jackalope_study_jni_HelloJni.cpp -o libHelloJni.jnilib&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;注意：在mac下后缀名应当写为jnilib，这是由&lt;br&gt;./jdk/src/macosx/classes/java/lang/ClassLoaderHelper.java中的mapAlternativeName方法引起的，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight axapta&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// For mac, this replaces the final .dylib suffix with .jnilib&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;index&lt;/span&gt; = name.toLowerCase().lastIndexOf(&lt;span class=&quot;string&quot;&gt;&quot;.dylib&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;index&lt;/span&gt; &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(name.substring(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;index&lt;/span&gt;) + &lt;span class=&quot;string&quot;&gt;&quot;.jnilib&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意：&lt;br&gt;    mac下会提示找不到jni_md.h，创建一个软链接即可解决：&lt;br&gt;    &lt;code&gt;sudo ln -s darwin/jni_md.h jni_md.h&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;成功后，便会在当前目录下生成动态链接库libHelloJni.jnilib文件。&lt;br&gt;有了具体实现的动态库后，就可以运行JAVA调用JNI程序类的native方法了:&lt;br&gt;&lt;code&gt;java -Djava.library.path=../c++/  org.jackalope.study.jni.HelloJni&lt;/code&gt;&lt;br&gt;输出：&lt;br&gt;From org_jackalope_study_jni_HelloJni.cpp :Hello world !&lt;/p&gt;
&lt;h2 id=&quot;使用RegisterNatives&quot;&gt;&lt;a href=&quot;#使用RegisterNatives&quot; class=&quot;headerlink&quot; title=&quot;使用RegisterNatives&quot;&gt;&lt;/a&gt;使用RegisterNatives&lt;/h2&gt;&lt;h3 id=&quot;优点&quot;&gt;&lt;a href=&quot;#优点&quot; class=&quot;headerlink&quot; title=&quot;优点&quot;&gt;&lt;/a&gt;优点&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;C＋＋中函数命名自由，不必像javah自动生成的函数声明那样，拘泥特定的命名方式；&lt;/li&gt;
&lt;li&gt;效率高。传统方式下，Java类call本地函数时，通常是依靠VM去动态寻找.so中的本地函数(因此它们才需要特定规则的命名格式)，而使用RegisterNatives将本地函数向VM进行登记，可以让其更有效率的找到函数；&lt;/li&gt;
&lt;li&gt;运行时动态调整本地函数与Java函数值之间的映射关系，只需要多次call RegisterNatives()方法，并传入不同的映射表参数即可。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;为了使用RegisterNatives，我们需要了解JNI_OnLoad和JNI_OnUnload函数。JNI_OnLoad()函数在VM执行System.loadLibrary(xxx)函数时被调用，它有两个重要的作用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;指定JNI版本：告诉VM该组件使用那一个JNI版本(若未提供JNI_OnLoad()函数，VM会默认该使用最老的JNI 1.1版)，如果要使用新版本的JNI，例如JNI 1.4版，则必须由JNI_OnLoad()函数返回常量JNI_VERSION_1_4(该常量定义在jni.h中) 来告知VM。&lt;/li&gt;
&lt;li&gt;初始化设定，当VM执行到System.loadLibrary()函数时，会立即先呼叫JNI_OnLoad()方法，因此在该方法中进行各种资源的初始化操作最为恰当，RegisterNatives也在这里进行。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;JNI_OnUnload()当VM释放该组件时被调用，JNI_OnUnload()函数的作用与JNI_OnLoad()对应，因此在该方法中进行善后清理，资源释放的动作最为合适。&lt;/p&gt;
&lt;h3 id=&quot;Java代码&quot;&gt;&lt;a href=&quot;#Java代码&quot; class=&quot;headerlink&quot; title=&quot;Java代码&quot;&gt;&lt;/a&gt;Java代码&lt;/h3&gt;&lt;p&gt;Java代码和使用哪种方式实现JNI无关，如下所示：&lt;br&gt;&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyJavaClass&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; iValue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Squa&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;iValue = iValue*iValue;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RegisterNativesTest&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  System.load(&lt;span class=&quot;string&quot;&gt;&quot;/home/zmh/workspace/RegisterNativesTest/lib/libCallClass.so&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;String[] args&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RegisterNativesTest app = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RegisterNativesTest();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  MyJavaClass obj = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MyJavaClass();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  obj.iValue = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;Before callCustomClass: &quot;&lt;/span&gt; + obj.iValue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  app.callCustomClass(obj);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  System.&lt;span class=&quot;keyword&quot;&gt;out&lt;/span&gt;.println(&lt;span class=&quot;string&quot;&gt;&quot;After callCustomClass: &quot;&lt;/span&gt; + obj.iValue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; native &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;callCustomClass&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;MyJavaClass obj&lt;/span&gt;)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;C-代码-1&quot;&gt;&lt;a href=&quot;#C-代码-1&quot; class=&quot;headerlink&quot; title=&quot;C++代码&quot;&gt;&lt;/a&gt;C++代码&lt;/h3&gt;&lt;p&gt;C＋＋的代码可以分为两部分：实现callCustomClass方法和注册callCustomClass。&lt;br&gt;实现callCustomClass方法的代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void callCustomClass(&lt;span class=&quot;keyword&quot;&gt;JNIEnv* &lt;/span&gt;env, &lt;span class=&quot;keyword&quot;&gt;jobject, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;jobject &lt;/span&gt;obj)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;jclass &lt;/span&gt;cls = env-&amp;gt;GetObjectClass(obj)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;jfieldID &lt;/span&gt;fid = env-&amp;gt;GetFieldID(cls, &lt;span class=&quot;string&quot;&gt;&quot;iValue&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;I&quot;&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;jmethodID &lt;/span&gt;mid = env-&amp;gt;GetMethodID(cls, &lt;span class=&quot;string&quot;&gt;&quot;Squa&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;()V&quot;&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; int value = env-&amp;gt;GetIntField(obj, fid)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; printf(&lt;span class=&quot;string&quot;&gt;&quot;Native: %d\n&quot;&lt;/span&gt;, value)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; env-&amp;gt;SetIntField(obj, fid, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; env-&amp;gt;CallVoidMethod(obj, mid)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; value = env-&amp;gt;GetIntField(obj, fid)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; printf(&lt;span class=&quot;string&quot;&gt;&quot;Native:%d\n&quot;&lt;/span&gt;, value)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;C＋＋函数内忽略this指针，他所接收的jobject是“Java程序代码传递过来的Java object reference“在原生端的形式，在C＋＋中对jobject的改变在java中也是有效的。如果想要访问Java数据成员和函数，得先使用GetFieldID或GetMethodID分别获取数据成员和函数的识别码，这两个函数的参数依次为1）class object；2）包含元素名称的字符串；3）表示类型的字符串。&lt;br&gt;注册callCustomClass在JNI_OnLoad中进行，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; JNINativeMethod s_methods[] = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;callCustomClass&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;(LMyJavaClass;)V&quot;&lt;/span&gt;, (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;*)callCustomClass&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; JNI_OnLoad(JavaVM* vm, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;* reserved)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; JNIEnv* env = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (vm-&amp;gt;GetEnv((&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;**) &amp;amp;env, JNI_VERSION_1_4) != JNI_OK)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; JNI_ERR;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; jclass cls = env-&amp;gt;FindClass(&lt;span class=&quot;string&quot;&gt;&quot;LRegisterNativesTest;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (cls == &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; JNI_ERR;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; len = &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(s_methods) / &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(s_methods[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (env-&amp;gt;RegisterNatives(cls, s_methods, len) &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; JNI_ERR;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; JNI_VERSION_1_4;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在C＋＋和Java中创建关联的是JNINativeMethod，它在jni.h中定义：&lt;/p&gt;
&lt;figure class=&quot;highlight ocaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * used &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;RegisterNatives&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; describe native &lt;span class=&quot;keyword&quot;&gt;method&lt;/span&gt; name, signature,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; pointer.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;typedef &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;char&lt;/span&gt; *name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;char&lt;/span&gt; *signature;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    void *fnPtr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;type&quot;&gt;JNINativeMethod&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;name是java中定义的native函数的名字，fnPtr是函数指针，也就是C＋＋中java native函数的实现。signature是java native函数的签名，可以认为是参数和返回值。比如(LMyJavaClass;)V，表示函数的参数是LMyJavaClass，返回值是void。对于基本类型，对应关系如下：&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;字符     Java类型     C/C++类型&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;V           &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;         &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Z         jboolean      &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;I            jint           &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;J           jlong         &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;D         jdouble       &lt;span class=&quot;keyword&quot;&gt;double&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;F          jfloat         &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;B          jbyte         &lt;span class=&quot;keyword&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;C          jchar          &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;S          jshort        &lt;span class=&quot;keyword&quot;&gt;short&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;数组则以”[“开始，用两个字符表示，比如int数组表示为［I，以此类推。&lt;br&gt;如果参数是Java类，则以”L”开头，以”;”结尾，中间是用”/“隔开包及类名，例如Ljava/lang/String;，而其对应的C＋＋函数的参数为jobject，一个例外是String类，它对应C＋＋类型jstring。&lt;/p&gt;
&lt;h1 id=&quot;参考链接&quot;&gt;&lt;a href=&quot;#参考链接&quot; class=&quot;headerlink&quot; title=&quot;参考链接&quot;&gt;&lt;/a&gt;参考链接&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/mandroid/archive/2011/06/15/2081093.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;JAVA基础之理解JNI原理&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/qiuxiaolong007/article/details/7860610&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;JNI：使用RegisterNatives方法传递和使用Java自定义类&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;p&gt;Java本地接口（Java Native Interface(JNI)）允许运行在Java虚拟机(Java Virtual Machine(
    
    </summary>
    
      <category term="java基础" scheme="http://jackalope.cn/categories/java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="java" scheme="http://jackalope.cn/tags/java/"/>
    
      <category term="jni" scheme="http://jackalope.cn/tags/jni/"/>
    
  </entry>
  
</feed>
